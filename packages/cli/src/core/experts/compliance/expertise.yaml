# Compliance Expert - Domain Knowledge
# This file is the agent's "mental model" of the compliance domain
# AUTO-UPDATED by self-improve.md after completing work

domain: compliance
last_updated: 2025-12-21
version: 1.1

files:
  policies:
    - path: docs/compliance/
      purpose: "Compliance documentation"
      conventions: "One document per regulation"
    - path: docs/compliance/gdpr.md
      purpose: "GDPR compliance documentation"
    - path: docs/compliance/privacy-policy.md
      purpose: "Privacy policy document"
    - path: docs/compliance/data-retention.md
      purpose: "Data retention policies"

  audit:
    - path: src/audit/
      purpose: "Audit trail implementation"
      conventions: "Immutable audit logs"
    - path: src/audit/logger.ts
      purpose: "Audit event logging"
    - path: docs/compliance/audit-events.md
      purpose: "Documented audit events"

  consent:
    - path: src/consent/
      purpose: "Consent management implementation"
      conventions: "GDPR-compliant consent flows"
    - path: docs/compliance/consent-matrix.md
      purpose: "What data requires what consent"

  security:
    - path: docs/compliance/security-controls.md
      purpose: "Security control documentation"

relationships:
  - parent: regulations
    child: policies
    type: implements
    notes: "Policies implement regulatory requirements"
  - parent: audit_events
    child: audit_logs
    type: produces
    notes: "Events produce immutable audit logs"
  - parent: consent
    child: data_processing
    type: gates
    notes: "Consent gates data processing activities"

patterns:
  - name: Audit Trail Pattern
    description: "Immutable log of all data access and changes"
    location: src/audit/
    example: |
      {
        event: "user_data_accessed",
        actor: "user-123",
        target: "user-456",
        timestamp: "2025-12-16T10:00:00Z"
      }

  - name: Consent Management
    description: "Explicit opt-in consent with withdrawal capability"
    location: src/consent/
    example: "hasConsent('analytics') ? track(event) : skip()"

  - name: Data Retention
    description: "Automated deletion after retention period"
    location: docs/compliance/data-retention.md
    example: "User data: 2 years, Audit logs: 7 years"

  - name: Right to Be Forgotten
    description: "Complete user data deletion on request"
    location: src/consent/
    example: "DELETE FROM users WHERE id = ? cascade"

conventions:
  - "All PII access must be audit logged"
  - "Explicit consent required before data processing"
  - "Data retention periods must be documented"
  - "Right to access and deletion must be supported"
  - "Breach notification procedures documented"
  - "Compliance cannot be compromised for convenience"
  - "Annual compliance audits required"

# Regulations: GDPR, CCPA, HIPAA, SOC2, PCI-DSS (models know details - omitted)

# Learnings (trimmed - keep 2 most actionable)
learnings:
  - date: 2025-12-21
    context: "Commit and secrets policy"
    insight: "NO AI attribution in commits (clean conventional format). Secrets: .npmrc, CLAUDE.md gitignored. NPM_TOKEN in GitHub Secrets only."

  - date: 2025-12-21
    context: "Audit trail and retention"
    insight: "ADRs in docs/03-decisions/, story tracking in status.json. Auto-archival moves completed stories >7 days to archive/YYYY-MM.json."
