# Analytics Expert - Domain Knowledge
# This file is the agent's "mental model" of the analytics domain
# AUTO-UPDATED by self-improve.md after completing work

domain: analytics
last_updated: 2025-12-21
version: 1.1

files:
  tracking:
    - path: src/analytics/
      purpose: "Analytics tracking implementation"
      key_exports: [track, identify, page]
      conventions: "Single analytics facade for all tracking"
    - path: src/analytics/events/
      purpose: "Event definitions and schemas"
      conventions: "One file per event category"
    - path: src/analytics/providers/
      purpose: "Analytics provider integrations (Segment, Amplitude)"
      conventions: "Named *Provider.ts"

  schemas:
    - path: src/analytics/schemas/
      purpose: "Event schema definitions for validation"
      conventions: "JSON Schema or Zod schemas"
    - path: src/analytics/events/catalog.ts
      purpose: "Master event catalog with all tracked events"
      conventions: "Exported EVENT_CATALOG constant"

  dashboards:
    - path: docs/analytics/
      purpose: "Dashboard specifications and metric definitions"
      conventions: "Markdown documentation"
    - path: docs/analytics/events.md
      purpose: "Event tracking documentation"
    - path: docs/analytics/metrics.md
      purpose: "Key business metrics definitions"

  privacy:
    - path: src/analytics/consent.ts
      purpose: "GDPR consent management"
      conventions: "Check consent before tracking"
    - path: src/analytics/privacy.ts
      purpose: "PII filtering and anonymization"
      conventions: "Strip PII before sending events"

relationships:
  - parent: tracking_facade
    child: providers
    type: routes_to
    notes: "Facade routes events to configured providers"
  - parent: events
    child: schemas
    type: validated_by
    notes: "Events validated against schemas before sending"
  - parent: ui_components
    child: tracking
    type: calls
    notes: "UI components call tracking facade"
  - parent: api_endpoints
    child: tracking
    type: calls
    notes: "Backend also tracks server-side events"

patterns:
  - name: Event Tracking Facade
    description: "Single interface for all analytics tracking"
    location: src/analytics/
    example: |
      analytics.track('button_clicked', { button_name: 'signup' });
      analytics.identify(userId, { plan: 'pro' });
      analytics.page('landing');

  - name: Event Schema Validation
    description: "Validate events against schema before sending"
    location: src/analytics/schemas/
    example: |
      const schema = z.object({
        event_name: z.string(),
        properties: z.object({ ... })
      });

  - name: Consent-First Tracking
    description: "Check GDPR consent before any tracking"
    location: src/analytics/consent.ts
    example: |
      if (hasConsent('analytics')) {
        analytics.track(event);
      }

  - name: Event Naming Convention
    description: "object_action format in snake_case"
    location: src/analytics/events/
    example: "button_clicked, form_submitted, page_viewed"

  - name: Anonymous User Tracking
    description: "Track anonymous users with session ID, not PII"
    location: src/analytics/
    example: "Use anonymous_id until user identifies"

conventions:
  - "NEVER track PII (email, name, phone) in event properties"
  - "ALWAYS check consent before tracking (GDPR/CCPA)"
  - "Use object_action naming: button_clicked, form_submitted"
  - "Use snake_case for event names and properties"
  - "Validate events against schema before sending"
  - "Include timestamp, session_id, anonymous_id with every event"
  - "Document all events in event catalog"
  - "Test tracking in development before production"

# Learnings (trimmed - keep 2 most actionable)
learnings:
  - date: 2025-12-21
    context: "Expertise metrics"
    insight: "scripts/expertise-metrics.sh analyzes expertise.yaml files for health: total experts, learnings count, staleness distribution"

  - date: 2025-12-21
    context: "Story metrics from status.json"
    insight: "Parse status.json for: completion %, stories by status/epic, WIP count, average story age"
