flowchart TB
    subgraph Pipeline["obtain-context.js Pipeline"]
        OC[obtain-context.js] -->|"prefetched data"| SD
    end

    subgraph SD["smart-detect.js (Orchestrator)"]
        direction TB
        EX["extractSignals()"] --> LD["detectLifecyclePhase()"]
        EX --> RD["runDetectorsForPhases()"]
        LD -->|"relevant phases"| RD
        RD -->|"raw recommendations"| FR["filterRecommendations()"]
        EX --> AM["detectAutoModes()"]
    end

    subgraph LD_Detail["lifecycle-detector.js"]
        direction TB
        P1["pre-story"]
        P2["planning"]
        P3["implementation"]
        P4["post-impl"]
        P5["pre-pr"]
        P1 -.-> P2 -.-> P3 -.-> P4 -.-> P5
    end

    subgraph RD_Detail["signal-detectors.js"]
        direction TB
        D1["10 pre-story detectors"]
        D2["7 planning detectors"]
        D3["11 implementation detectors"]
        D4["9 post-impl detectors"]
        D5["2 pre-pr detectors"]
    end

    subgraph Signals["Signal Sources"]
        S1["status.json"]
        S2["Git state"]
        S3["session-state.json"]
        S4["package.json"]
        S5["File system"]
        S6["metadata.json"]
    end

    subgraph Output["Output"]
        JSON[(smart-detect.json)]
        IMM["Immediate recommendations"]
        AVL["Available recommendations"]
        AUTO["Auto-enabled modes"]
        JSON --> IMM
        JSON --> AVL
        JSON --> AUTO
    end

    Signals -->|"gathered by pipeline"| EX
    LD --> LD_Detail
    RD --> RD_Detail
    FR --> JSON
    AM --> JSON
    JSON -->|"babysit reads"| BS["/babysit acts on recommendations"]
