---
title: /configuration-déploiement
description: Configurer un pipeline de déploiement automatisé
---
# /setup-déploiement

Détectez automatiquement votre type de projet et configurez un pipeline de déploiement complet avec des configurations spécifiques à la plate-forme, des flux de travail CI/CD et une gestion de l'environnement.

## Démarrage rapide

```bash
/agileflow:setup-deployment PLATFORM=auto ENV=both AUTO_DEPLOY=no
```

## Objectif

Cette commande configure intelligemment l'infrastructure de déploiement en :
- Détection automatique de votre type de projet (statique, full-stack, sans serveur, mobile, conteneurs)
- Recommander la plateforme de déploiement optimale
- Génération de fichiers de configuration spécifiques à la plateforme
- Création de workflows de déploiement GitHub Actions
- Mise en place de modèles de variables d'environnement et gestion des secrets
- Fournir des prochaines étapes claires pour le déploiement

## Paramètres

| Paramètre | Obligatoire | Par défaut | Descriptif |
|-----------|----------|---------|-------------|
| `PLATFORM` | Non | `auto` | `auto`, `vercel`, `netlify`, `heroku`, `aws`, `gcp`, `docker`, `eas` |
| `ENV` | Non |`both` | `staging`, `production` ou `both` |
| `AUTO_DEPLOY` | Non | `no` | `yes` ou `no` - déclenche automatiquement le déploiement lors du push |

## Exemples

### Détecter automatiquement tout

```bash
/agileflow:setup-deployment
```

Détecte le type de projet et recommande automatiquement la meilleure plateforme.

### Spécifier explicitement la plate-forme

```bash
/agileflow:setup-deployment PLATFORM=vercel ENV=both
```

Configure le déploiement de Vercel pour la préparation et la production.

### Déploiement de Docker sur Fly.io

```bash
/agileflow:setup-deployment PLATFORM=docker ENV=production
```

Configure le déploiement basé sur Docker (fonctionne avec Fly.io, AWS, GCP).

### Application mobile avec EAS

```bash
/agileflow:setup-deployment PLATFORM=eas ENV=production
```

Configure les services d'application Expo pour le déploiement de React Native/Expo.

## Détection de projet

La commande analyse votre projet pour recommander des plateformes :

### Sites statiques
**Détecté par** : HTML/CSS/JS, React/Vue/Angular SPA (pas de backend)
- Recommandé : Vercel ou Netlify
- Idéal pour : Sites marketing, SPA, documentation

### Applications Web Full-Stack
**Détecté par** : serveur Node.js, ERoutes API xpress/Fastify/Next.js
- Recommandé : Vercel (Next.js) ou Railway
- Idéal pour : applications Web avec logique backend

### Applications mobiles (React Native / Expo)
**Détecté par** : configuration `expo`, dépendance `react-native`
- Recommandé : EAS (Expo Application Services)
- Idéal pour : les applications mobiles iOS/Android

### Applications basées sur des conteneurs
**Détecté par** : `Dockerfile` présent
- Recommandé : Fly.io
- Idéal pour : les déploiements Docker personnalisés, les microservices

### Fonctions sans serveur
**Détecté par** : fonctions Lambda, configuration API Gateway
- Recommandé : Fonctions AWS Lambda ou Vercel
- Idéal pour : les charges de travail basées sur les événements et payées à l'exécution

## Fichiers de sortie

La commande crée plusieurs fichiers de configuration :

### Configuration de la plateforme
- **Vercel** : `vercel.json`
- **Netlify** : `netlify.toml`
- **Héroku** : `Procfile`, `app.json`
- **Docker** : `Dockerfile`, `.dockerignore`, `fly.toml`
- **EAS** : `eas.json`
- **AWS Lambda** : `serverless.yml`

### Flux de travail CI/CD
- `.github/workflows/deploy.yml` - Workflow de déploiement automatisé
- Prend en charge la mise en scène → promotion de la production
- Fonctionne en mode push vers les branches intermédiaires/principales

### Gestion de l'environnement
- `.env.example` - Modèle pour les variables d'environnement (validation sûre)
- `docs/02-practices/secrets-management.md` - Guide de gestion des secrets
- `docs/02-practices/deployment.md` - Documentation de déploiement

## Plateformes

### Vercel (Recommandé pour Next.js/React)
Idéal pour : les déploiements Next.js, React et SPA
- Constructions automatiques sur git push
- CDN mondial
- Fonctions sans serveur intégrées
- Interface utilisateur de gestion de l'environnement
- Prévisualiser les déploiements sur les PR

**Prochaines étapes** :
```bash
vercel link              # Connect your GitHub repo
vercel env add DATABASE_URL production
git push origin main     # Trigger deployment
```

### Netlify (recommandé pour les sites statiques)
Idéal pour : sites statiques, JAMstack, SPA généraux
- Constructions automatiques à partir de git
- Analyses et formulaires intégrés
- Fonctions sans serveur
- Intégration du CMS Netlify
- Gestion de domaine personnalisé

### Heroku (serveurs Node.js/Python)
Idéal pour : les applications serveur traditionnelles
- Déploiement simple basé sur slug
- PostgreSQL, modules complémentaires Redis
- Variable d'environnementgestion responsable
- Fonctionnalités de collaboration en équipe

**Prochaines étapes** :
```bash
heroku login
heroku create my-app
heroku addons:create heroku-postgresql:hobby-dev
git push heroku main
```

### Fly.io (déploiement Docker)
Idéal pour : conteneurs Docker, microservices, environnements d'exécution personnalisés
- Déploiement global avec routage anycast
- Prise en charge d'IPv6
- Mise à l'échelle automatique
- Volumes persistants
- PostgreSQL inclus

**Prochaines étapes** :
```bash
fly auth login
fly launch
fly deploy
```

### AWS (Lambda/ECS/Elastic Beanstalk)
Idéal pour : applications évolutives, microservices
- Plusieurs options de déploiement (Lambda, ECS, Beanstalk)
- Rentable à grande échelle
- Intégration avec l'écosystème AWS
- Contrôle d'accès précis

### EAS (Expo/React Natif)
Idéal pour : applications mobiles (iOS/Android)
- Builds natives dans le cloud
- Soumissions App Store/Play Store
- Mises à jour OTA
- Constructions de clients de développement

## Flux de travail

La configuration suit un processus cohérent :

1. **Détecter le type de projet** - Analyse les dépendances et les fichiers
2. **Plateforme recommandée** - Suggère un hébergement optimal
3. **Générer la configuration** - Crée des fichiers spécifiques à la plate-forme
4. **Créer un workflow** – Configure GitHub Acconditions de déploiement
5. **Configuration de l'environnement** – Crée `.env.example` et des documents
6. **Afficher l'aperçu** - Affiche tous les fichiers à examiner
7. **Créer des fichiers** - Écrit sur le disque après confirmation OUI/NON
8. **Afficher les étapes suivantes** - Guide la fin de la configuration

## Gestion de l'environnement

### Mise en scène vs production

La commande peut configurer l'un ou les deux environnements :

```yaml
# Example: Two-branch deployment
Staging:
  - Branch: staging
  - URL: staging.example.com
  - Environment: development-like

Production:
  - Branch: main
  - URL: example.com
  - Environment: live
```

### Gestion des secrets

**Ne confiez jamais de secrets à git**. Au lieu de cela :

1. Utilisez `.env.example` comme modèle
2. Stockez les secrets réels dans la plateforme (Vercel, Heroku, etc.)
3. GitHub Actions fournit `${{ secrets.NAME }}`
4. Lisez `docs/02-practices/secrets-management.md` pour plus de détails

**Secrets communs** :
- Chaînes de connexion à la base de données
- Clés API (Stripe, SendGrid, etc.)
- Informations d'identification AWS
- Jetons de service tiers

## Exemples par plateforme

### Déploiement Vercel

```bash
/agileflow:setup-deployment PLATFORM=vercel
```

Crée :
- `vercel.json` avec la configuration de build
- `.github/workflows/deploy.yml` pour le déploiement automatique
- `.env.example` avec les noms de variables Vercel
- Documents de déploiement

### Heroku avec PostgreSQL

```bash
/agileflow:setup-deployment PLATFORM=heroku ENV=production
```

Crée :
- `Procfile` (web : npm start)
- `app.json` avec la configuration du buildpack
- Documentation d'installation de PostgreSQL
- Flux de travail de déploiement

### Docker vers Fly.io

```bash
/agileflow:setup-deployment PLATFORM=docker
```

Crée :
- `Dockerfile` avec construction en plusieurs étapes
- `.dockerignore` pour une image nette
- `fly.toml` avec configuration de région et de volume
- Flux de travail de déploiement

## Option de déploiement automatique

Par défaut, les déploiements nécessitent un déclenchement manuel. Pour activer le déploiement automatique à chaque push :

```bash
/agileflow:setup-deployment AUTO_DEPLOY=yes
```

**Important** : À utiliser avec prudence en production. Considérez :
- Exigez toujours que CI réussisse en premier
- Utiliser la mise en scène → processus de promotion principal
- Implémenter des indicateurs de fonctionnalités pour des déploiements progressifs
- Surveiller le suivi des erreurs après les déploiements

## Prochaines étapes après l'installation

1. **Ajouter une connexion à la plateforme**
   ```bash
   vercel link
   # or
   fly auth login
   fly launch
   ```

2. **Configurer les secrets**
   ```bash
   vercel env add DATABASE_URL production
   # or
   fly secrets set DATABASE_URL=postgresql://...
   ```

3. **Test de déploiement**
   ```bash
   git push origin staging
   # Check deployment logs on platform dashboard
   ```

4. **Définir un domaine personnalisé** (facultatif)
   ```bash
   vercel domains add example.com
   # Follow platform-specific DNS setup
   ```

5. **Activer le déploiement automatique** (Optional)
   - Après avoir testé la mise en scène, activez le déploiement automatique en production
   - Configurer les règles de protection des branches

## Commandes associées

- [`/ci-setup`](/commands/ci) - Configurer les tests et les contrôles CI/CD
- [`/setup-tests`](/commands/tests) - Configurer le cadre de test
- [`/generate-changelog`](/commands/changelog) - Créer des notes de version