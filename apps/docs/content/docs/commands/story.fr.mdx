---
title: /histoire
description: Créer une user story avec des critères d'acceptation
---

# /histoire

Créez une nouvelle user story avec des critères d'acceptation, des talons de test et un suivi du statut.

## Démarrage rapide

```bash
/agileflow:story EPIC=<EP-ID> STORY=<US-ID> TITLE=<text> OWNER=<id>
```

## Paramètres

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `EPIC` | Yes | - | Parent epic ID (e.g., EP-0001) |
| `STORY` | Yes | - | Story identifier (e.g., US-0001) |
| `TITLE` | Yes | - | Story title describing the feature |
| `OWNER` | Yes | - | Owner name or agent ID (e.g., AG-UI, AG-API) |
| `ESTIMATE` | No | `0.5d` | Time estimate (e.g., `0.5d`, `1d`, `2d`) |
| `AC` | No | - | Acceptance criteria in Given/When/Then format |
| `DEPENDENCIES` | No | - | Comma-separated list of dependent story IDs (e.g., `US-0001,US-0002`) |
| `TDD` | No | Smart default | Enable TDD mode to generate test stubs from acceptance criteria |

## Exemples

### Création d'histoire de base

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0001 TITLE="User registration form" OWNER=AG-UI
```

Crée un fichier d'histoire à `docs/06-stories/EP-0010/US-0001-user-registration-form.md` avec estimation par défaut (0,5d) et statut (prêt).

### Histoire avec critères d'acceptation

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0002 TITLE="Validate email address" OWNER=AG-API ESTIMATE=1d AC="Given a valid email, When form submitted, Then confirmation email sent"
```

Crée l'histoire avec des critères d'acceptation spécifiques qui guident le développement et les tests.

### Histoire avec dépendances

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0003 TITLE="Password reset flow" OWNER=AG-API ESTIMATE=1d DEPENDENCIES=US-0001,US-0002
```

Crée l'histoire et la marque comme dépendante des histoires précédentes. Ces dépendances sont visualisées dans `/deps` commande.

### Histoire avec le mode TDD

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0004 TITLE="User login" OWNER=AG-API AC="Given user on login page, When valid credentials entered, Then dashboard shown"
```

Pour les propriétaires de code comme AG-API, le mode TDD est automatiquement activé. Cela génère un fichier de test à `__tests__/US-0004.test.ts` avec des tests en attente dérivés des critères d’acceptation.

## Mode TDD

Le mode TDD (Test-Driven Development) génère des talons de test spécifiques au framework à partir de vos critères d'acceptation. Des tests sont créés **before** mise en œuvre, suivant le principe selon lequel les tests doivent **specify** comportement, pas seulement le vérifier.

### Paramètres par défaut intelligents

Le mode TDD utilise des valeurs par défaut intelligentes basées sur le propriétaire de l'histoire :

| Owner Type | TDD Default | Rationale |
|------------|-------------|-----------|
| AG-API, AG-UI, AG-DATABASE | `true` | Code-focused, tests critical |
| AG-TESTING, AG-SECURITY, AG-PERFORMANCE | `true` | Quality-focused |
| AG-DOCUMENTATION, AG-RESEARCH, AG-PRODUCT | `false` | Non-code work |
| AG-DEVOPS, AG-CI | `false` | Infrastructure, config |

Vous pouvez toujours remplacer la valeur par défaut :
- `TDD=true` - Forcer l'activation du mode TDD
- `TDD=false` - Forcer la désactivation du mode TDD

### Structure de test générée

Pour Jest/Vitest (TypeScript) :
```typescript
describe('US-0004: User login', () => {
  // AC1: valid login shows dashboard
  describe('valid login shows dashboard', () => {
    it.skip('should dashboard shown', () => {
      // Given: user on login page
      // When: valid credentials entered
      // Then: dashboard shown
      expect(true).toBe(true); // TODO: Implement
    });
  });
});
```

### Flux de travail TDD

1. **Create story with TDD** - Les tests sont générés à partir de critères d'acceptation
2. **Clear context** - Commencer une nouvelle séance Claude
3. **Implement to pass tests** - Dites à l'agent : "Faites tous les tests dans `__tests__/US-0004.test.ts` passer"
4. **Agent implements blindly** - Sans savoir comment les tests ont été générés
5. **Tests validate behavior** - La mise en œuvre répond réellement aux exigences

Cette séparation garantit que les tests spécifient réellement le comportement plutôt que de simplement vérifier ce qui a été écrit.

## Sortir

La commande crée :

1. **Story file** (`docs/06-stories/EP-XXXX/US-XXXX-<slug>.md`)
   - Métadonnées de l'histoire (ID, épopée, propriétaire, estimation, statut)
   - Description et critères d'acceptation
   - Contexte d'architecture (rempli pendant le développement)
   - Stratégie de test
   - Badge TDD (si mode TDD activé)

2. **Test stub** (`docs/07-testing/test-cases/US-XXXX.md`)
   - Structure de test alignée sur les critères d'acceptation
   - Espace réservé pour la mise en œuvre des tests
   - Liens vers l'histoire pour le contexte

3. **TDD test file** (si le mode TDD est activé)
   - Blague/Vitest : `__tests__/US-XXXX.test.ts`
   - test py : `tests/test_US-XXXX.py`
   - Aller: `<package>/US-XXXX_test.go`

4. **Status tracking** (`docs/09-agents/status.json`)
   - Entrée d'histoire avec propriétaire, estimation et statut
   - Liens de dépendance vers d'autres histoires
   - Mission épique
   - Indicateur de mode TDD et chemin du fichier de test (si TDD activé)

5. **Agent communication** (`docs/09-agents/bus/log.jsonl`)
   - Message d'affectation montrant l'histoire créée et attribuée

## Flux de travail

1. **Create the story** - Courir `/story` avec épopée, identifiant, titre et propriétaire
2. **Add acceptance criteria** - Utiliser `/story-validate` pour affiner et tester AC
3. **Validate completeness** - Courir `/story-validate STORY=<US-ID>` avant le développement
4. **Develop the story** - Le propriétaire met en œuvre selon les critères d'acceptation
5. **Run tests** - Utiliser `/verify` exécuter des tests automatisés
6. **Request review** - Mettre à jour le statut vers `in-review` quand je suis prêt

## Format des critères d'acceptation

Utilisez le format Given/When/Then pour des critères clairs et testables :

```markdown
- **Given** a user on the registration page
  **When** they enter valid email and password
  **Then** an account is created and confirmation email sent

- **Given** they submit an invalid email
  **When** they click submit
  **Then** form shows "Invalid email" error
```

Les critères d'acceptation doivent être :
- **Specific**: Référencer les champs et les valeurs réels
- **Testable**: Peut être vérifié avec des tests automatisés ou manuels
- **Independent**: Chaque critère teste une chose
- **Complete**: Couvrir le chemin heureux et les cas extrêmes majeurs

## Estimations de l'histoire

Utilisez ces estimations standards :

| Estimate | When to Use |
|----------|------------|
| `0.5d` | Simple CRUD, basic UI component, quick fix |
| `1d` | Standard feature with validation and basic tests |
| `1.5d` | Complex logic, multiple validations, or integration |
| `2d` | Significant refactoring or major feature component |
| `>2d` | Break into smaller stories |

## Intégration avec d'autres commandes

- **After story creation**: Utiliser `/story-validate` pour assurer la préparation
- **Before development**: Utiliser `/babysit` pour une aide interactive à la mise en œuvre
- **During development**: Utiliser `/verify` faire des tests
- **For code review**: Utiliser `/review` pour des suggestions basées sur l'IA
- **For pull requests**: Utiliser `/pr` pour générer automatiquement une description PR

## Meilleures pratiques

- **One story = one feature** - Gardez les histoires ciblées et livrables de manière indépendante
- **Write clear acceptance criteria** - Ceux-ci guident le développement et les tests
- **Use TDD for code stories** - Laisser les tests spécifier le comportement avant la mise en œuvre
- **Clear context before implementing TDD tests** - Repartir à zéro pour que l'agent ne « connaisse » pas les tests
- **Estimate realistically** - Tenir compte de la complexité et de l'expérience de l'équipe
- **Link dependencies explicitly** - Aide à la planification du sprint et à l'évaluation des risques
- **Validate before development** - Utiliser `/story-validate` détecter les problèmes le plus tôt possible

## Commandes associées

- [`/épique`](/commands/epic) - Créer l'épopée parent
- [`/story-validate`](/commands/story-validate) - Valider l'exhaustivité de l'histoire avant le développement
- [`/sprint`](/commands/sprint) - Sélectionnez des histoires pour la planification du sprint
- [`/auto`](/commands/auto) - Générer automatiquement des histoires à partir de PRD ou de spécifications
- [`/garde d'enfants`](/commands/babysit) - Obtenez une aide interactive pendant la mise en œuvre
- [`/vérifier`](/commands/verify) - Exécuter des tests et mettre à jour le statut des tests
- [`/tests`](/commands/tests) - Mettre en place l'infrastructure de test pour le workflow TDD
