---
title: /comprimir
description: Comprima status.json eliminando campos detallados y manteniendo solo los metadatos de seguimiento
---
# /comprimir

Reduzca el tamaÃ±o del archivo status.json eliminando los campos de historia detallados y al mismo tiempo conservando todos los metadatos de seguimiento crÃ­ticos y manteniendo los detalles completos de la historia en archivos de rebajas.

## Inicio rÃ¡pido

```bash
/agileflow:compress
```

## PropÃ³sito

Este comando resuelve un problema comÃºn: cuando `status.json` crece (especialmente en proyectos grandes con mÃ¡s de 100 pisos), puede exceder los lÃ­mites de token y ralentizar el procesamiento del agente. El comando de compresiÃ³n:
- Elimina campos detallados (descripciones, aire acondicionado, contexto arquitectÃ³nico, etc.)
- Mantiene solo los metadatos de seguimiento esenciales (ID de la historia, estado, propietario, marcas de tiempo)
- Reduce el tamaÃ±o del archivo normalmente entre un 80 y un 90 %.
- Conserva el contenido completo de la historia en archivos de rebajas.
- Mantiene el historial completo del proyecto.
- Garantiza que los agentes puedan leer status.json de manera eficiente

## ParÃ¡metros

Este comando no tiene parÃ¡metros; opera directamente en `docs/09-agents/status.json`.

## Uso

Simplemente ejecuta:

```bash
/agileflow:compress
```

El comando:
1. Validar status.json existe y es JSON vÃ¡lido
2. Mostrar antes de las estadÃ­sticas (tamaÃ±o, lÃ­neas, historiant)
3. Crea una copia de seguridad automÃ¡tica
4. Eliminar campos detallados
5. Escribe la versiÃ³n comprimida.
6. Mostrar despuÃ©s de estadÃ­sticas y ahorros.

## QuÃ© se elimina

Estos campos detallados se eliminan de status.json:

```text
- description          # Story description and context
- acceptanceCriteria   # AC bullet points
- architectureContext  # Architecture details
- technicalNotes       # Implementation hints
- testingStrategy      # Test approach
- devAgentRecord       # Implementation notes
- previousStoryInsights # Lessons from previous story
- (all other large text fields)
```

En su lugar, estos se conservan de forma segura en archivos de rebajas `docs/06-stories/`.

## Lo que se conserva

Solo los metadatos de seguimiento esenciales permanecen en status.json:

```text
- story_id            # Story identifier
- epic                # Parent epic
- title               # Story title
- owner               # Assigned agent
- status              # Current status (ready/in-progress/blocked/done)
- estimate            # Time estimate
- created             # Creation timestamp
- updated             # Last update timestamp
- completed_at        # Completion timestamp
- dependencies        # Dependent story IDs
- branch              # Git branch name
- summary             # Short summary
- last_update         # Last modification message
- assigned_at         # Assignment timestamp
```

## Salida de ejemplo

```text
ğŸ—œï¸  AgileFlow Status Compression
   Purpose: Strip verbose fields from status.json
   Target: Keep only essential tracking metadata

ğŸ’¾ Backup created: docs/09-agents/status.json.backup

ğŸ“Š Before Compression:
   Stories: 145
   Size: 384KB
   Lines: 12,847

âœ… Compression complete!

ğŸ“Š After Compression:
   Stories: 145 (unchanged)
   Size: 384KB â†’ 42KB
   Lines: 12,847 â†’ 1,203
   Saved: 89% (342KB)

âœ… Estimated tokens: ~10,500 (safely under 25000 limit)

ğŸ“‹ Status Summary:
   ready: 23 stories
   in-progress: 8 stories
   blocked: 2 stories
   done: 112 stories

ğŸ’¾ To restore original: cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

## CuÃ¡ndo utilizar

### Utilice compresiÃ³n cuando:

1. **status.json supera los 25.000 tokens**
   - Los agentes fallan con "el contenido del archivo excede el mÃ¡ximo de tokens permitidos"

2. **El archivo tarda en procesarse**
   - Demasiado grande para ventanas contextuales
   - Causa problemas de tiempo de espera

3. **DespuÃ©s de una gran finalizaciÃ³n Ã©pica**
   - Muchas historias completadas con registros detallados.
   - El proyecto ha crecido significativamente.

4. **Mantenimiento trimestral**
   - Limpieza regular para mantener un seguimiento eficiente

### Alternativa: combinar con archivo

Para obtener resultados aÃºn mejores, combine la compresiÃ³n con el archivo:

```bash
# Step 1: Archive completed stories older than 3 days
bash .agileflow/scripts/archive-completed-stories.sh 3

# Step 2: Compress remaining stories
/agileflow:compress
```

Este proceso de dos pasosss logra la mÃ¡xima reducciÃ³n manteniendo el historial.

## Seguridad y copias de seguridad

### Copia de seguridad automÃ¡tica

Antes de la compresiÃ³n, el comando crea una copia de seguridad:
```text
docs/09-agents/status.json.backup
```

### Sin pÃ©rdida de datos

- El contenido completo de la historia permanece en `docs/06-stories/` archivos de rebajas
- Los archivos de rebajas de historias NO se modifican
- SÃ³lo se comprime el Ã­ndice status.json
- Siempre se puede restaurar desde la copia de seguridad

### Restaurar si es necesario

```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

La copia de seguridad contiene el archivo original completo.

## Â¿Por quÃ© esta arquitectura?

### SeparaciÃ³n de preocupaciones

**status.json** = Ã­ndice de seguimiento ligero
- "Â¿QuÃ© historias existen?"
- "Â¿A quiÃ©n pertenece cada historia?"
- "Â¿CuÃ¡l es el estado actual?"
- "Â¿CuÃ¡ndo se actualizÃ³?"

**docs/06-stories/** = contenido completo de la historia
- Descripciones completas
- Criterios de aceptaciÃ³n
- Decisiones de arquitectura
- Notas de implementaciÃ³n
- Estrategias de prueba

**docs/09-agents/archive/** = datos histÃ³ricos
- Historias completadas anteriores al umbral.
- OrganizaciÃ³n mensual
- Capacidad de recuperaciÃ³n total

### Beneficios

1. **IndizaciÃ³n rÃ¡pida** - Agentes lee status.json rÃ¡pidamente
2. **Contenido completo** - Detalles completos en la rebaja de la historia
3. **Con capacidad de bÃºsqueda**: puede buscar contenido en archivos de historias
4. **Versionable**: todos los archivos tienen seguimiento de git
5. **Archivable**: las historias antiguas no aumentan el Ã­ndice de seguimiento

## EstimaciÃ³n de tokens

El comando estima el uso del token:

```text
Token estimation formula: tokens â‰ˆ bytes / 4

Before: 384KB Ã— 1024 bytes/KB Ã· 4 = 98,304 tokens
After: 42KB Ã— 1024 bytes/KB Ã· 4 = 10,752 tokens

Saved: 87,552 tokens!
```

Objetivo: mantener status.json por debajo de 25Â 000 tokens (100 KB comprimidos).

## IntegraciÃ³n del flujo de trabajo

### Con el autobÃºs del agente

La compresiÃ³n status.json no afecta:
- Bus de mensajes del agente (`docs/09-agents/bus/log.jsonl`)
- ComunicaciÃ³n y coordinaciÃ³n de agentes.
- Seguimiento del estado de la historia

### Con CI/CD

Se puede agregar compresiÃ³n a la automatizaciÃ³n de CI:

```yaml
name: Maintenance
on:
  schedule:
    - cron: '0 2 * * 0'  # Sunday 2am UTC

jobs:
  compress:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Archive and compress
        run: |
          bash .agileflow/scripts/archive-completed-stories.sh 3
          /agileflow:compress
      - name: Commit if changed
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add docs/09-agents/
          git diff --quiet && git diff --staged --quiet || \
          git commit -m "chore(maintenance): archive and compress status"
          git push
```

## Escenarios comunes

### Escenario 1: Proyecto creciendo

**Problema**: status.json tiene 250 KB y 150 historias.
**SoluciÃ³n**:
```bash
/agileflow:compress
```
**Resultado**: Se reduce a 30 KB, fÃ¡cilmente por debajo de los lÃ­mites de token

### Escenario 2: Muchas historias completadas

**Problema**: 120 historias completadas, 30 activas; status.json hinchado
**SoluciÃ³n**:
```bash
# Archive stories completed >7 days ago
bash .agileflow/scripts/archive-completed-stories.sh 7

# Then compress
/agileflow:compress
```
**Resultado**: Mueve historias antiguas al archivo y comprime las restantes.

### Escenario 3: Mantenimiento regular

**Problema**: Quiere mantener status.json lean automÃ¡ticamente
**SoluciÃ³n**: Agregar al programa de CI (compresiÃ³n mensual)
**Resultado**: Siempre por debajo de los lÃ­mites de tokens, procesamiento rÃ¡pido del agente

## SoluciÃ³n de problemas

### "status.json sigue siendo demasiado grande despuÃ©s de la compresiÃ³n"

Pruebe un archivo mÃ¡s agresivo:
```bash
# Archive stories >3 days old instead of default 7
bash .agileflow/scripts/archive-completed-stories.sh 3

/agileflow:compress
```

### "Se perdiÃ³ informaciÃ³n crÃ­tica despuÃ©s de la compresiÃ³n"

Restaurar desde copia de seguridad:
```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

Compruebe si los archivos de rebajas de historias tienen los detalles en `docs/06-stories/`.

### "No puedo encontrar detalles de la historia"

El contenido de la historia estÃ¡ en archivos de rebajas:
```bash
find docs/06-stories/ -name "US-*.md" | xargs grep "your search term"
```

## Mejores prÃ¡cticas

1. **CompresiÃ³n regular**: ejecuciÃ³n mensual o trimestral
2. **Archivar agresivamente**: mueva primero las historias antiguas completadas
3. **Hacer copia de seguridad antes**: la compresiÃ³n crea una copia de seguridad automÃ¡ticamente
4. **Verificar despuÃ©s**: verifique la estimaciÃ³n del token en la salida
5. **Confirmar cambios**: agregar estado comprimido a git
6. **PolÃ­tica de documentos**: registre cuÃ¡ndo y por quÃ© se compilÃ³ejecuciones de resion
7. **Probar restauraciÃ³n**: verifique que la copia de seguridad funcione si es necesario

## Comandos relacionados

- [`/agileflow:status`](/commands/status) - Ver estados actuales de las historias
- [`/agileflow:validate`](/commands/validate) - Verificar el estado del sistema AgileFlow
- GuiÃ³n de archivo: `bash .agileflow/scripts/archive-completed-stories.sh` - Mover historias completadas al archivo

## Detalles tÃ©cnicos

### Archivos involucrados

| Archivo | PropÃ³sito |
|------|---------|
| `docs/09-agents/status.json` | Ãndice de seguimiento ligero (comprimido) |
| `docs/09-agents/status.json.backup` | Copia de seguridad automÃ¡tica antes de la compresiÃ³n |
| `docs/06-stories/` | Archivos de rebajas de historias completas (sin cambios) |
| `docs/09-agents/archive/YYYY-MM.json` | Historias histÃ³ricas completadas |

### ImplementaciÃ³n

El script de compresiÃ³n utiliza `jq` para el procesamiento JSON:

```bash
# Extract only essential fields for each story
jq '[.[] | {story_id, epic, title, owner, status, estimate, created, updated, completed_at, dependencies, branch, summary, last_update, assigned_at}]' status.json > status-compressed.json
```

### CÃ¡lculo de tokens

EstimaciÃ³n aproximada utilizada en la salida:
- 1 token â‰ˆ 4 caracteres/bytes (aproximado)
- Archivo de 100 KB â‰ˆ 25.000 tokens
- Objetivo: < 100 KB para mantenerse muy por debajo de los lÃ­mites

## Preguntas frecuentes

<Accordion type="multiple">
  <AccordionItem value="delete">
    <AccordionTrigger>Â¿Se comprime?n Â¿eliminar archivos de historias?</AccordionTrigger>
    <AccordionContent>
      No. SÃ³lo se modifica status.json. La rebaja de historias en docs/06-stories/ no se modifica.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="undo">
    <AccordionTrigger>Â¿Puedo deshacer la compresiÃ³n?</AccordionTrigger>
    <AccordionContent>
      SÃ­. Se crea una copia de seguridad automÃ¡ticamente. Simplemente restaure: `cp docs/09-agents/status.json.backup docs/09-agents/status.json`
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="when">
    <AccordionTrigger>Â¿CuÃ¡ndo debo comprimir?</AccordionTrigger>
    <AccordionContent>
      Cuando status.json supera los 25 KB, o mensualmente como mantenimiento. CombÃ­nelo con archivo para obtener mejores resultados.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="performance">
    <AccordionTrigger>Â¿Esto afecta el rendimiento del agente?</AccordionTrigger>
    <AccordionContent>
      SÃ­, lo mejora dramÃ¡ticamente. Status.json mÃ¡s pequeÃ±o = lecturas mÃ¡s rÃ¡pidas, mÃ¡s contexto disponible para los agentes.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="git">
    <AccordionTrigger>WhÂ¿Acerca del historial de git?</AccordionTrigger>
    <AccordionContent>
      Todos los cambios estÃ¡n comprometidos. Las versiones anteriores estÃ¡n en el historial de git si es necesario.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="customize">
    <AccordionTrigger>Â¿Puedo personalizar quÃ© campos conservar?</AccordionTrigger>
    <AccordionContent>
      SÃ­, edite el script de compresiÃ³n para conservar campos adicionales si es necesario para su flujo de trabajo.
    </AccordionContent>
  </AccordionItem>
</Accordion>