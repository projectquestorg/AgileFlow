---
title: /comprimir
description: Comprima status.json eliminando campos detallados y manteniendo solo los metadatos de seguimiento
---

# /comprimir

Reduzca el tama√±o del archivo status.json eliminando los campos de historia detallados y al mismo tiempo conservando todos los metadatos de seguimiento cr√≠ticos y manteniendo los detalles completos de la historia en archivos de rebajas.

## Inicio r√°pido

```bash
/agileflow:compress
```

## Objetivo

Este comando resuelve un problema com√∫n: cuando `status.json` crece (especialmente en proyectos grandes con m√°s de 100 historias), puede exceder los l√≠mites de tokens y ralentizar el procesamiento del agente. El comando de compresi√≥n:
- Elimina campos detallados (descripciones, aire acondicionado, contexto arquitect√≥nico, etc.)
- Mantiene solo los metadatos de seguimiento esenciales (ID de la historia, estado, propietario, marcas de tiempo)
- Normalmente reduce el tama√±o del archivo entre un 80 y un 90 %.
- Conserva el contenido completo de la historia en archivos Markdown.
- Mantiene el historial completo del proyecto.
- Garantiza que los agentes puedan leer status.json de manera eficiente

## Par√°metros

Este comando no tiene par√°metros: opera directamente en `docs/09-agents/status.json`.

## Uso

Simplemente ejecuta:

```bash
/agileflow:compress
```

El comando:
1. Validar status.json existe y es JSON v√°lido
2. Mostrar antes de las estad√≠sticas (tama√±o, l√≠neas, recuento de historias)
3. Crear copia de seguridad autom√°tica
4. Eliminar campos detallados
5. Escribir versi√≥n comprimida
6. Mostrar despu√©s de estad√≠sticas y ahorros

## Lo que se elimina

Estos campos detallados se eliminan de status.json:

```text
- description          # Story description and context
- acceptanceCriteria   # AC bullet points
- architectureContext  # Architecture details
- technicalNotes       # Implementation hints
- testingStrategy      # Test approach
- devAgentRecord       # Implementation notes
- previousStoryInsights # Lessons from previous story
- (all other large text fields)
```

Estos se conservan de forma segura en `docs/06-stories/` archivos de rebajas en su lugar.

## Lo que se conserva

Solo los metadatos de seguimiento esenciales permanecen en status.json:

```text
- story_id            # Story identifier
- epic                # Parent epic
- title               # Story title
- owner               # Assigned agent
- status              # Current status (ready/in-progress/blocked/done)
- estimate            # Time estimate
- created             # Creation timestamp
- updated             # Last update timestamp
- completed_at        # Completion timestamp
- dependencies        # Dependent story IDs
- branch              # Git branch name
- summary             # Short summary
- last_update         # Last modification message
- assigned_at         # Assignment timestamp
```

## Salida de ejemplo

```text
üóúÔ∏è  AgileFlow Status Compression
   Purpose: Strip verbose fields from status.json
   Target: Keep only essential tracking metadata

üíæ Backup created: docs/09-agents/status.json.backup

üìä Before Compression:
   Stories: 145
   Size: 384KB
   Lines: 12,847

‚úÖ Compression complete!

üìä After Compression:
   Stories: 145 (unchanged)
   Size: 384KB ‚Üí 42KB
   Lines: 12,847 ‚Üí 1,203
   Saved: 89% (342KB)

‚úÖ Estimated tokens: ~10,500 (safely under 25000 limit)

üìã Status Summary:
   ready: 23 stories
   in-progress: 8 stories
   blocked: 2 stories
   done: 112 stories

üíæ To restore original: cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

## Cuando usar

### Utilice compresi√≥n cuando:

1. **status.json exceeds 25,000 tokens**
   - Los agentes fallan con "el contenido del archivo excede los tokens m√°ximos permitidos"

2. **File is slow to process**
   - Demasiado grande para ventanas contextuales
   - Causa problemas de tiempo de espera

3. **After major epic completion**
   - Muchas historias completas con registros detallados.
   - El proyecto ha crecido significativamente

4. **Quarterly maintenance**
   - Limpieza regular para mantener un seguimiento eficiente

### Alternativa: combinar con archivo

Para obtener resultados a√∫n mejores, combine la compresi√≥n con el archivo:

```bash
# Step 1: Archive completed stories older than 3 days
bash .agileflow/scripts/archive-completed-stories.sh 3

# Step 2: Compress remaining stories
/agileflow:compress
```

Este proceso de dos pasos logra la m√°xima reducci√≥n manteniendo el historial.

## Seguridad y copias de seguridad

### Copia de seguridad autom√°tica

Antes de la compresi√≥n, el comando crea una copia de seguridad:
```text
docs/09-agents/status.json.backup
```

### Sin p√©rdida de datos

- El contenido completo de la historia permanece en `docs/06-stories/` archivos de rebajas
- Los archivos de rebajas de historias NO se modifican
- S√≥lo el √≠ndice status.json est√° comprimido
- Siempre se puede restaurar desde la copia de seguridad

### Restaurar si es necesario

```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

La copia de seguridad contiene el archivo original completo.

## ¬øPor qu√© esta arquitectura?

### Separaci√≥n de preocupaciones

**status.json** = √≠ndice de seguimiento ligero
- "¬øQu√© historias existen?"
- "¬øA qui√©n pertenece cada historia?"
- "¬øCu√°l es el estado actual?"
- "¬øCu√°ndo se actualiz√≥?"

**docs/06-stories/** = contenido completo de la historia
- Descripciones completas
- Criterios de aceptaci√≥n
- Decisiones de arquitectura
- Notas de implementaci√≥n
- Estrategias de prueba

**docs/09-agents/archive/** = datos hist√≥ricos
- Historias completadas anteriores al umbral
- organizaci√≥n mensual
- Capacidad de recuperaci√≥n completa

### Beneficios

1. **Fast Indexing** - Los agentes leen status.json r√°pidamente
2. **Complete Content** - Detalles completos en la rebaja de la historia.
3. **Searchable** - Puede buscar archivos de historias en busca de contenido.
4. **Versionable** - Todos los archivos tienen seguimiento de git
5. **Archivable** - Las historias antiguas no aumentan el √≠ndice de seguimiento.

## Estimaci√≥n de tokens

El comando estima el uso del token:

```text
Token estimation formula: tokens ‚âà bytes / 4

Before: 384KB √ó 1024 bytes/KB √∑ 4 = 98,304 tokens
After: 42KB √ó 1024 bytes/KB √∑ 4 = 10,752 tokens

Saved: 87,552 tokens!
```

Objetivo: mantener status.json por debajo de 25¬†000 tokens (100 KB comprimidos).

## Integraci√≥n del flujo de trabajo

### Con autob√∫s de agente

La compresi√≥n status.json no afecta:
- Bus de mensajes del agente (`docs/09-agents/bus/log.jsonl`)
- Comunicaci√≥n y coordinaci√≥n de agentes.
- Seguimiento del estado de la historia

### Con CI/CD

Se puede agregar compresi√≥n a la automatizaci√≥n de CI:

```yaml
name: Maintenance
on:
  schedule:
    - cron: '0 2 * * 0'  # Sunday 2am UTC

jobs:
  compress:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Archive and compress
        run: |
          bash .agileflow/scripts/archive-completed-stories.sh 3
          /agileflow:compress
      - name: Commit if changed
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add docs/09-agents/
          git diff --quiet && git diff --staged --quiet || \
          git commit -m "chore(maintenance): archive and compress status"
          git push
```

## Escenarios comunes

### Escenario 1: Proyecto creciendo

**Problem**: status.json tiene 250 KB con 150 historias
**Solution**:
```bash
/agileflow:compress
```
**Result**: Se reduce a 30 KB, f√°cilmente por debajo de los l√≠mites de token

### Escenario 2: Muchas historias completadas

**Problem**: 120 historias completadas, 30 activas; status.json hinchado
**Solution**:
```bash
# Archive stories completed >7 days ago
bash .agileflow/scripts/archive-completed-stories.sh 7

# Then compress
/agileflow:compress
```
**Result**: Mueve historias antiguas al archivo, comprime las restantes

### Escenario 3: Mantenimiento regular

**Problem**: Quiere mantener status.json lean autom√°ticamente
**Solution**: Agregar a la programaci√≥n de CI (compresi√≥n mensual)
**Result**: Siempre bajo l√≠mites de token, procesamiento r√°pido del agente

## Soluci√≥n de problemas

### "status.json sigue siendo demasiado grande despu√©s de la compresi√≥n"

Pruebe un archivo m√°s agresivo:
```bash
# Archive stories >3 days old instead of default 7
bash .agileflow/scripts/archive-completed-stories.sh 3

/agileflow:compress
```

### "Se perdi√≥ informaci√≥n cr√≠tica despu√©s de la compresi√≥n"

Restaurar desde copia de seguridad:
```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

Compruebe si los archivos de rebajas de historias tienen los detalles en `docs/06-stories/`.

### "No puedo encontrar detalles de la historia"

El contenido de la historia est√° en archivos de rebajas:
```bash
find docs/06-stories/ -name "US-*.md" | xargs grep "your search term"
```

## Mejores pr√°cticas

1. **Regular Compression** - Ejecutar mensual o trimestralmente
2. **Archive Aggressively** - Mover primero las historias antiguas completadas
3. **Back Up Before** - La compresi√≥n crea una copia de seguridad autom√°ticamente
4. **Verify After** - Verificar la estimaci√≥n del token en la salida.
5. **Commit Changes** - Agregar estado comprimido a git
6. **Document Policy** - Registrar cu√°ndo y por qu√© se ejecuta la compresi√≥n.
7. **Test Restoration** - Verificar que la copia de seguridad funcione si es necesario

## Comandos relacionados

- [`/agileflow:estado`](/commands/status) - Ver estados de historias actuales
- [`/agileflow:validar`](/commands/validate) - Verificar el estado del sistema AgileFlow
- Gui√≥n de archivo: `bash .agileflow/scripts/archive-completed-stories.sh` - Mover historias completadas para archivar

## Detalles t√©cnicos

### Archivos involucrados

| File | Purpose |
|------|---------|
| `docs/09-agents/status.json` | Lightweight tracking index (compressed) |
| `docs/09-agents/status.json.backup` | Automatic backup before compression |
| `docs/06-stories/` | Full story markdown files (unchanged) |
| `docs/09-agents/archive/YYYY-MM.json` | Historical completed stories |

### Implementaci√≥n

El script de compresi√≥n utiliza `jq` para procesamiento JSON:

```bash
# Extract only essential fields for each story
jq '[.[] | {story_id, epic, title, owner, status, estimate, created, updated, completed_at, dependencies, branch, summary, last_update, assigned_at}]' status.json > status-compressed.json
```

### C√°lculo de tokens

Estimaci√≥n aproximada utilizada en la salida:
- 1 token ‚âà 4 caracteres/bytes (aproximado)
- Archivo de 100 KB ‚âà 25 000 tokens
- Objetivo: \< 100 KB para mantenerse muy por debajo de los l√≠mites

## Preguntas frecuentes

<Accordion type="multiple">
  <AccordionItem value="delete">
    <AccordionTrigger>Does compression delete story files?</AccordionTrigger>
    <AccordionContent>
      No. S√≥lo se modifica status.json. La rebaja de historias en docs/06-stories/ no se modifica.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="undo">
    <AccordionTrigger>Can I undo compression?</AccordionTrigger>
    <AccordionContent>
      S√≠. Se crea una copia de seguridad autom√°ticamente. Simplemente restaure: `cp docs/09-agents/status.json.backup docs/09-agents/status.json`
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="when">
    <AccordionTrigger>When should I compress?</AccordionTrigger>
    <AccordionContent>
      Cuando status.json supera los 25 KB, o mensualmente como mantenimiento. Comb√≠nelo con archivo para obtener mejores resultados.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="performance">
    <AccordionTrigger>Does this affect agent performance?</AccordionTrigger>
    <AccordionContent>
      S√≠, lo mejora dram√°ticamente. Status.json m√°s peque√±o = lecturas m√°s r√°pidas, m√°s contexto disponible para los agentes.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="git">
    <AccordionTrigger>What about git history?</AccordionTrigger>
    <AccordionContent>
      Todos los cambios est√°n comprometidos. Las versiones anteriores est√°n en el historial de git si es necesario.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="customize">
    <AccordionTrigger>Can I customize which fields to keep?</AccordionTrigger>
    <AccordionContent>
      S√≠, edite el script de compresi√≥n para conservar campos adicionales si es necesario para su flujo de trabajo.
    </AccordionContent>
  </AccordionItem>
</Accordion>
