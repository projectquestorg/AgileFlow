---
title: /impact
description: Analyser l'impact des changements sur l'ensemble de la base de code
---
# /impact

Analysez l'impact des modifications de code sur d'autres parties de votre base de code pour éviter les régressions. La détection d'impact identifie les fichiers, les tests et les fonctionnalités concernés, puis suggère les tests à exécuter et ceux qui pourraient échouer.

## Démarrage rapide

```bash
# Auto-detect changes on current branch
/agileflow:impact

# Analyze specific files
/agileflow:impact FILES=src/api/auth.ts,src/middleware/jwt.ts

# Skip test execution
/agileflow:impact RUN_TESTS=no
```

La commande va :
1. Identifiez les fichiers modifiés
2. Cartographier les dépendances (directes et indirectes)
3. Rechercher des tests associés
4. Détecter les changements radicaux
5. Générer un rapport d'impact
6. Exécutez éventuellement les tests concernés

## Principales fonctionnalités

### Analyse du graphique de dépendance

Impact crée automatiquement un graphique de dépendances :

```text
Your Change: src/api/auth.ts
  ├─ Direct dependents (files that import this)
  │  ├─ src/api/auth/index.ts
  │  ├─ src/middleware/auth.ts
  │  └─ tests/api/auth/login.test.ts
  └─ Indirect dependents (2-level chain)
     ├─ src/app.ts
     ├─ src/routes.ts
     └─ [more...]
```

### Test de découverte

Recherche automatiquement les tests à exécuter :

```text
Critical (Always Run):
  ✓ tests/api/auth/login.test.ts
  ✓ tests/integration/auth-flow.test.ts

Recommended (Affected Indirectly):
  ⚠️  tests/api/users/*.test.ts
  ⚠️  tests/e2e/login.spec.ts

Optional (Low Risk):
  - tests/components/Header.test.tsx
```

### Détection des changements avec rupture

Identifie les modifications de signature de fonction :

```text
⚠️  BREAKING CHANGE DETECTED

File: src/api/auth/login.ts
Function: login()

Before:
  login(email: string, password: string): Promise<Token>

After:
  login(credentials: LoginRequest): Promise<AuthResponse>

Affected callers:
  - src/middleware/auth.ts:45
  - tests/api/auth/login.test.ts:23
  - tests/integration/auth-flow.test.ts:67
```

### Cartographie de la couverture

Affiche la couverture de test pour le code modifié :

```text
Changed Lines:  45-52 (8 lines)
Test Coverage:  87%
Uncovered:      Lines 50-51 (2 lines not tested)

⚠️  2 lines of changes have no test coverage
    Consider adding tests for these paths
```

## Utilisation

### Basic – détection automatique des modifications

```bash
/agileflow:impact
```

Utilise git pour trouver les modifications sur la branche actuelle et analyse l'impact.

### Analyser des fichiers spécifiques

```bash
/agileflow:impact FILES=src/api/auth.ts,src/middleware/jwt.ts
```

Unanalyse uniquement les fichiers répertoriés (utile pour une analyse manuelle).

### Branche de base différente

```bash
/agileflow:impact BASE=develop
```

Compare avec develop au lieu de main/master.

### Ignorer l'exécution du test

```bash
/agileflow:impact RUN_TESTS=no
```

Affiche l'analyse d'impact mais n'exécute pas de tests.

## Paramètres

| Paramètre | Obligatoire | Par défaut | Descriptif |
|-----------|----------|---------|-------------|
| `FILES` | Non | Détection automatique | Chemins de fichiers séparés par des virgules |
| `BASE` | Non | principal/maître | Branche de base pour comparaison |
| `RUN_TESTS` | Non | oui | Exécuter les tests concernés |

## Exemples

### Modifications typiques des fonctionnalités

```bash
/agileflow:impact

# Output:
# Impact Analysis Report
#
# Changed Files: 3
# - src/api/auth.ts (23 lines modified)
# - src/middleware/auth.ts (15 lines modified)
# - src/components/LoginForm.tsx (12 lines modified)
#
# Affected Files: 8
# - Direct dependents: 3
# - Indirect dependents: 5
#
# Tests to Run: 5
# - Critical: 2 (direct tests)
# - Recommended: 3 (integration tests)
#
# Coverage: 87% (2 lines uncovered)
```

### Modification du middleware de sécurité

```bash
/agileflow:impact FILES=src/middleware/auth.ts

# Output:
# Changed: src/middleware/auth.ts (34 lines)
#
# Direct Dependents (6):
#   - src/api/auth/index.ts
#   - src/api/users/index.ts
#   - src/api/posts/index.ts
#   - src/middleware/validate.ts
#   - src/app.ts
#   - tests/middleware/auth.test.ts
#
# Tests to Run:
#   ✓ tests/middleware/auth.test.ts
#   ⚠️  tests/integration/auth-flow.test.ts
#   ⚠️  tests/api/*/index.test.ts
```

### Détection des changements avec rupture

```bash
/agileflow:impact

# Output includes:
# ⚠️  BREAKING CHANGE DETECTED
#
# Function signature changed in src/api/auth/login.ts
#
# Before: login(email, password)
# After:  login(credentials)
#
# Update these callers:
#   - src/middleware/auth.ts:45
#   - tests/api/auth/login.test.ts:23
```

## Structure du rapport d'impact

### En-tête

```text
# Impact Analysis Report

**Branch**: feature/user-auth
**Base**: main
**Changed Files**: 5
**Potentially Affected Files**: 23
**Tests to Run**: 12
```

### Impacts directs

Pour chaque fichier modifié :

```text
### src/api/auth/login.ts (MODIFIED)

**Type**: API endpoint
**Changes**: 23 lines modified

**Direct dependents** (3):
- src/api/auth/index.ts (exports this endpoint)
- src/middleware/auth.ts (uses login logic)
- tests/api/auth/login.test.ts (tests this file)

**Indirect dependents** (8):
- src/app.ts → src/api/auth/index.ts → login.ts
- src/routes.ts → src/api/auth/index.ts → login.ts
- [6 more...]

**Related tests**:
- ✅ tests/api/auth/login.test.ts (exists)
- ⚠️  tests/integration/auth-flow.test.ts (may need updates)
- ❌ Missing: E2E test for login flow

**Related stories**:
- US-0042: Implement JWT authentication (IN-REVIEW)

**Coverage**: 87% (lines 45-52 uncovered)
```

## Méthodes d'analyse

### Analyse statique

Impact utilise une analyse de code statique (pas de code en cours d'exécution) :

- Analyser les instructions import/require
- Construire une dépendance graph
- Identifier les dépendances circulaires
- Rechercher le code exporté mais inutilisé
- Relations entre les fichiers de carte

**Avantages** : Rapide, ne nécessite pas d'exécution de build/tests, détecte les modifications d'importation

### Cartographie de la couverture des tests

Maps a changé les lignes en tests :

- Lit les rapports de couverture (si disponibles)
- Fait correspondre les numéros de ligne aux fichiers de test
- Identifie les changements découverts
- Suggère des ajouts de tests

### Correspondance de motifs

Correspondance de modèles intelligente pour les tests associés :

| Changer le type | Modèle |
|-------------|---------|
| Itinéraire API modifié | Recherchez `routes.test.ts`, `api/*.test.ts` |
| Composant modifié | Recherchez `*.test.tsx`, `*.stories.tsx` |
| Service modifié | Recherchez `service.test.ts`, tests d'intégration |
| Type modifié | Recherchez `*.test.ts` qui utilise le type |

## Modifications radicales

Impact détecte les modifications avec rupture :

### Changement de signature de fonction

```text
⚠️  BREAKING CHANGE

Function: login()
Before:   login(email: string, password: string)
After:    login(credentials: LoginRequest)

Callers to update:
- src/middleware/auth.ts:45
  OLD: login(user.email, user.password)
  NEW: login({ email: user.email, password: user.password })
```

### Exportation supprimée

```text
⚠️  BREAKING CHANGE

Removed export: validateSession
(was in src/middleware/auth.ts)

Callers will break:
- src/api/posts/index.ts:23 - imports validateSession
- tests/middleware/auth.test.ts:45
```

### Changement de type

```text
⚠️  BREAKING CHANGE

Type changed: User interface
Added required field: verified_at (Date)

Callers creating User without field:
- src/api/auth/signup.ts:67
- src/seeders/users.ts:12
```

## Recommandations de tests

L'impact suggère quels tests to run:

### Critique (Toujours exécuter)

- Tests unitaires directs pour les fichiers modifiés
- Des tests qui ciblent spécifiquement le code modifié
- Tous les tests qui importent le fichier modifié

### Recommandé (exécuter si le temps le permet)

- Tests d'intégration à partir de fichiers modifiés
- Tests de bout en bout grâce à des fonctionnalités modifiées
- Tests des fonctionnalités dépendantes

### Optional (Low Risk)

- Peripheral tests
- Tests avec chaînes de dépendances indirectes
- Tests de fonctionnalités sans rapport

## Actions après analyse

### 1. Examiner le résumé de l'impact

```text
Changed: 3 files
Affected: 8 files
Tests: 5 need to run
```

### 2. Exécutez des tests (si RUN_TESTS=oui)

```text
Running critical tests...
✅ tests/api/auth/login.test.ts (12 tests, 345ms)
✅ tests/middleware/auth.test.ts (8 tests, 234ms)
⚠️  tests/integration/auth-flow.test.ts (3 tests, FAILED)

Test Results: 20 passed, 3 failed
```

### 3. Handle Failures

If tests fail:

```text
Tests failed. Options:
1. Fix code and re-run tests
2. Create story for regression
3. Skip and investigate later

What should we do?
```

### 4. Gérer les changements radicaux

Si des changements cassants sont détectés :

```text
⚠️  Breaking changes found!

These functions changed signature:
- login() in src/api/auth.ts

3 callers need to be updated:
- src/middleware/auth.ts:45
- tests/api/auth/login.test.ts:23

Create stories to update these files?
```

## Visualization

Impact peut visualiser des arbres de dépendances :

```text
src/api/auth/login.ts (CHANGED)
├── src/api/auth/index.ts (direct)
│   ├── src/app.ts (indirect)
│   └── src/routes.ts (indirect)
├── src/middleware/auth.ts (direct)
│   └── src/app.ts (indirect)
└── tests/api/auth/login.test.ts (test)
```

## Integration with CI

Suggérez un CI optimisé qui exécute uniquement les tests concernés :

```yaml
- name: Impact analysis
  run: npx claude-code /agileflow:impact BASE=main

- name: Run affected tests
  run: npm test -- $(cat affected-tests.txt)

- name: Check for breaking changes
  run: |
    if grep -q "BREAKING CHANGE" impact-report.md; then
      echo "::warning::Breaking changes detected"
    fi
```

## Cas d'utilisation

### Before submitting PR

```bash
# Check impact of your changes
/agileflow:impact

# Run the recommended tests
# If any fail, fix before submitting PR
```

### Après la révision du code, commentaires

```bash
# You made changes based on review
/agileflow:impact

# Make sure nothing broke
# Re-run affected tests
```

### Before merging to main

```bash
# Final check before merge
/agileflow:impact BASE=main

# Ensure no regressions
# All critical tests passing
```

### Refactoring safety

```bash
# Before large refactor
/agileflow:baseline "Before refactor"

# Make changes
# Check impact
/agileflow:impact

# If breaking changes, understand them
# Update callers accordingly
```

## Conseils

### Exécutez l'impact tôt et souvent

```bash
# After each major change
/agileflow:impact

# Catch breakage early
# Easier to fix one change than many
```

### Faites attention aux impacts indirects

```text
Direct impact: 3 affected files
Indirect impact: 8 more affected files

Fixing direct isn't enough - test indirects too
```

### La couverture des tests est importante

```text
87% coverage = 13% of changes untested
Missing tests = potential bugs from untested paths

Add tests for uncovered lines
```

### Les changements radicaux nécessitent une coordination

```text
⚠️  Function signature changed
Need to update 5 callers
Create stories to track the updates
```

## Commandes associées

- [`/review`](/commands/review) - Examen de la qualité du code
- [`/verify`](/commands/verify) - Exécuter des tests
- [`/pr`](/commands/pr) - Générer des relations publiques avec des notes d'impact
- [`/babysit`](/commands/babysit) - Conseils de mise en œuvre (impact des exécutions)
- [`/baseline`](/commands/baseline) - Créer un point de contrôle vérifié