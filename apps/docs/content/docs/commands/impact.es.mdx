---
title: "/impacto"
description: Analizar el impacto del cambio en toda la base de código
---

# /impacto

Analice el impacto de los cambios de código en otras partes de su base de código para evitar regresiones. La detección de impacto identifica los archivos, las pruebas y las funciones afectados y luego sugiere qué pruebas ejecutar y cuáles podrían fallar.

## Inicio rápido

```bash
# Auto-detect changes on current branch
/agileflow:impact

# Analyze specific files
/agileflow:impact FILES=src/api/auth.ts,src/middleware/jwt.ts

# Skip test execution
/agileflow:impact RUN_TESTS=no
```

El comando:
1. Identificar archivos modificados
2. Dependencias del mapa (directas e indirectas)
3. Encuentra pruebas relacionadas
4. Detectar cambios importantes
5. Generar informe de impacto
6. Opcionalmente, ejecute las pruebas afectadas

## Características clave

### Análisis de gráficos de dependencia

Impact crea automáticamente un gráfico de dependencia:

```text
Your Change: src/api/auth.ts
  ├─ Direct dependents (files that import this)
  │  ├─ src/api/auth/index.ts
  │  ├─ src/middleware/auth.ts
  │  └─ tests/api/auth/login.test.ts
  └─ Indirect dependents (2-level chain)
     ├─ src/app.ts
     ├─ src/routes.ts
     └─ [more...]
```

### Descubrimiento de prueba

Encuentra automáticamente las pruebas que deben ejecutarse:

```text
Critical (Always Run):
  ✓ tests/api/auth/login.test.ts
  ✓ tests/integration/auth-flow.test.ts

Recommended (Affected Indirectly):
  ⚠️  tests/api/users/*.test.ts
  ⚠️  tests/e2e/login.spec.ts

Optional (Low Risk):
  - tests/components/Header.test.tsx
```

### Detección de cambios importantes

Identifica cambios de firma de función:

```text
⚠️  BREAKING CHANGE DETECTED

File: src/api/auth/login.ts
Function: login()

Before:
  login(email: string, password: string): Promise<Token>

After:
  login(credentials: LoginRequest): Promise<AuthResponse>

Affected callers:
  - src/middleware/auth.ts:45
  - tests/api/auth/login.test.ts:23
  - tests/integration/auth-flow.test.ts:67
```

### Mapeo de cobertura

Muestra la cobertura de prueba para el código modificado:

```text
Changed Lines:  45-52 (8 lines)
Test Coverage:  87%
Uncovered:      Lines 50-51 (2 lines not tested)

⚠️  2 lines of changes have no test coverage
    Consider adding tests for these paths
```

## Uso

### Básico: detección automática de cambios

```bash
/agileflow:impact
```

Utiliza git para encontrar cambios en la rama actual y analiza el impacto.

### Analizar archivos específicos

```bash
/agileflow:impact FILES=src/api/auth.ts,src/middleware/jwt.ts
```

Analiza sólo los archivos enumerados (útil para el análisis manual).

### Rama base diferente

```bash
/agileflow:impact BASE=develop
```

Se compara con desarrollo en lugar de principal/maestro.

### Saltar ejecución de prueba

```bash
/agileflow:impact RUN_TESTS=no
```

Muestra análisis de impacto pero no ejecuta pruebas.

## Parámetros

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `FILES` | No | Auto-detect | Comma-separated file paths |
| `BASE` | No | main/master | Base branch for comparison |
| `RUN_TESTS` | No | yes | Execute affected tests |

## Ejemplos

### Cambios típicos de características

```bash
/agileflow:impact

# Output:
# Impact Analysis Report
#
# Changed Files: 3
# - src/api/auth.ts (23 lines modified)
# - src/middleware/auth.ts (15 lines modified)
# - src/components/LoginForm.tsx (12 lines modified)
#
# Affected Files: 8
# - Direct dependents: 3
# - Indirect dependents: 5
#
# Tests to Run: 5
# - Critical: 2 (direct tests)
# - Recommended: 3 (integration tests)
#
# Coverage: 87% (2 lines uncovered)
```

### Cambio de middleware de seguridad

```bash
/agileflow:impact FILES=src/middleware/auth.ts

# Output:
# Changed: src/middleware/auth.ts (34 lines)
#
# Direct Dependents (6):
#   - src/api/auth/index.ts
#   - src/api/users/index.ts
#   - src/api/posts/index.ts
#   - src/middleware/validate.ts
#   - src/app.ts
#   - tests/middleware/auth.test.ts
#
# Tests to Run:
#   ✓ tests/middleware/auth.test.ts
#   ⚠️  tests/integration/auth-flow.test.ts
#   ⚠️  tests/api/*/index.test.ts
```

### Detección de cambios importantes

```bash
/agileflow:impact

# Output includes:
# ⚠️  BREAKING CHANGE DETECTED
#
# Function signature changed in src/api/auth/login.ts
#
# Before: login(email, password)
# After:  login(credentials)
#
# Update these callers:
#   - src/middleware/auth.ts:45
#   - tests/api/auth/login.test.ts:23
```

## Estructura del informe de impacto

### Encabezamiento

```text
# Impact Analysis Report

**Branch**: feature/user-auth
**Base**: main
**Changed Files**: 5
**Potentially Affected Files**: 23
**Tests to Run**: 12
```

### Impactos directos

Para cada archivo modificado:

```text
### src/api/auth/login.ts (MODIFIED)

**Type**: API endpoint
**Changes**: 23 lines modified

**Direct dependents** (3):
- src/api/auth/index.ts (exports this endpoint)
- src/middleware/auth.ts (uses login logic)
- tests/api/auth/login.test.ts (tests this file)

**Indirect dependents** (8):
- src/app.ts → src/api/auth/index.ts → login.ts
- src/routes.ts → src/api/auth/index.ts → login.ts
- [6 more...]

**Related tests**:
- ✅ tests/api/auth/login.test.ts (exists)
- ⚠️  tests/integration/auth-flow.test.ts (may need updates)
- ❌ Missing: E2E test for login flow

**Related stories**:
- US-0042: Implement JWT authentication (IN-REVIEW)

**Coverage**: 87% (lines 45-52 uncovered)
```

## Métodos de análisis

### Análisis estático

Impact utiliza análisis de código estático (sin código en ejecución):

- Parse import/require statements
- Construir gráfico de dependencia
- Identificar dependencias circulares
- Encuentra código exportado pero no utilizado
- Relaciones de archivos de mapa

**Benefits**: Rápido, no requiere compilación/pruebas para ejecutarse, detecta cambios de importación

### Mapeo de cobertura de prueba

Maps cambió líneas a pruebas:

- Lee informes de cobertura (si están disponibles)
- Coincide con números de línea con archivos de prueba
- Identifica cambios descubiertos
- Sugiere adiciones de prueba

### Coincidencia de patrones

Smart pattern matching for related tests:

| Change Type | Pattern |
|-------------|---------|
| API route changed | Look for `routes.test.ts`, `api/*.test.ts` |
| Component changed | Look for `*.test.tsx`, `*.stories.tsx` |
| Service changed | Look for `service.test.ts`, integration tests |
| Type changed | Look for `*.test.ts` that use the type |

## Cambios importantes

Impact detecta cambios importantes:

### Cambio de firma de función

```text
⚠️  BREAKING CHANGE

Function: login()
Before:   login(email: string, password: string)
After:    login(credentials: LoginRequest)

Callers to update:
- src/middleware/auth.ts:45
  OLD: login(user.email, user.password)
  NEW: login({ email: user.email, password: user.password })
```

### Exportación eliminada

```text
⚠️  BREAKING CHANGE

Removed export: validateSession
(was in src/middleware/auth.ts)

Callers will break:
- src/api/posts/index.ts:23 - imports validateSession
- tests/middleware/auth.test.ts:45
```

### Cambio de tipo

```text
⚠️  BREAKING CHANGE

Type changed: User interface
Added required field: verified_at (Date)

Callers creating User without field:
- src/api/auth/signup.ts:67
- src/seeders/users.ts:12
```

## Recomendaciones de prueba

Impact sugiere qué pruebas ejecutar:

### Crítico (siempre ejecutar)

- Pruebas unitarias directas para archivos modificados
- Pruebas que apuntan específicamente al código modificado.
- Todas las pruebas que importan archivos modificados.

### Recomendado (ejecutar si el tiempo lo permite)

- Pruebas de integración utilizando archivos modificados.
- Pruebas de un extremo a otro a través de funciones modificadas
- Pruebas de características dependientes.

### Opcional (bajo riesgo)

- Pruebas periféricas
- Pruebas con cadenas de dependencia indirecta.
- Pruebas de características no relacionadas.

## Acciones después del análisis

### 1. Revisar el resumen de impacto

```text
Changed: 3 files
Affected: 8 files
Tests: 5 need to run
```

### 2. Ejecute pruebas (si RUN_TESTS=yes)

```text
Running critical tests...
✅ tests/api/auth/login.test.ts (12 tests, 345ms)
✅ tests/middleware/auth.test.ts (8 tests, 234ms)
⚠️  tests/integration/auth-flow.test.ts (3 tests, FAILED)

Test Results: 20 passed, 3 failed
```

### 3. Manejar las fallas

Si las pruebas fallan:

```text
Tests failed. Options:
1. Fix code and re-run tests
2. Create story for regression
3. Skip and investigate later

What should we do?
```

### 4. Manejar los cambios importantes

Si se detectan cambios importantes:

```text
⚠️  Breaking changes found!

These functions changed signature:
- login() in src/api/auth.ts

3 callers need to be updated:
- src/middleware/auth.ts:45
- tests/api/auth/login.test.ts:23

Create stories to update these files?
```

## Visualización

Impact puede visualizar árboles de dependencia:

```text
src/api/auth/login.ts (CHANGED)
├── src/api/auth/index.ts (direct)
│   ├── src/app.ts (indirect)
│   └── src/routes.ts (indirect)
├── src/middleware/auth.ts (direct)
│   └── src/app.ts (indirect)
└── tests/api/auth/login.test.ts (test)
```

## Integración con CI

Sugiera CI optimizado que solo ejecute las pruebas afectadas:

```yaml
- name: Impact analysis
  run: npx claude-code /agileflow:impact BASE=main

- name: Run affected tests
  run: npm test -- $(cat affected-tests.txt)

- name: Check for breaking changes
  run: |
    if grep -q "BREAKING CHANGE" impact-report.md; then
      echo "::warning::Breaking changes detected"
    fi
```

## Casos de uso

### Antes de enviar PR

```bash
# Check impact of your changes
/agileflow:impact

# Run the recommended tests
# If any fail, fix before submitting PR
```

### Comentarios después de la revisión del código

```bash
# You made changes based on review
/agileflow:impact

# Make sure nothing broke
# Re-run affected tests
```

### Before merging to main

```bash
# Final check before merge
/agileflow:impact BASE=main

# Ensure no regressions
# All critical tests passing
```

### Seguridad de refactorización

```bash
# Before large refactor
/agileflow:baseline "Before refactor"

# Make changes
# Check impact
/agileflow:impact

# If breaking changes, understand them
# Update callers accordingly
```

## Consejos

### Ejecute el impacto temprano y con frecuencia

```bash
# After each major change
/agileflow:impact

# Catch breakage early
# Easier to fix one change than many
```

### Preste atención a los impactos indirectos

```text
Direct impact: 3 affected files
Indirect impact: 8 more affected files

Fixing direct isn't enough - test indirects too
```

### La cobertura de la prueba importa

```text
87% coverage = 13% of changes untested
Missing tests = potential bugs from untested paths

Add tests for uncovered lines
```

### Los cambios importantes requieren coordinación

```text
⚠️  Function signature changed
Need to update 5 callers
Create stories to track the updates
```

## Comandos relacionados

- [`/revisar`](/commands/review) - Revisión de la calidad del código.
- [`/verificar`](/commands/verify) - Ejecutar pruebas
- [`/pr`](/commands/pr) - Generar relaciones públicas con notas de impacto.
- [`/cuidar`](/commands/babysit) - Guía de implementación (impacto de las ejecuciones)
- [`/línea de base`](/commands/baseline) - Crear punto de control verificado
