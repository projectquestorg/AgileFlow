---
title: /compressa
description: Compacte status.json removendo campos detalhados e mantendo apenas o rastreamento de metadados
---

# /compressa

Reduza o tamanho do arquivo status.json removendo campos de hist√≥ria detalhados, preservando todos os metadados cr√≠ticos de rastreamento e mantendo detalhes completos da hist√≥ria em arquivos markdown.

## In√≠cio r√°pido

```bash
/agileflow:compress
```

## Prop√≥sito

Este comando resolve um problema comum: quando `status.json` cresce muito (especialmente em grandes projetos com mais de 100 hist√≥rias), pode exceder os limites de tokens e retardar o processamento do agente. O comando compactar:
- Remove campos detalhados (descri√ß√µes, AC, contexto de arquitetura, etc.)
- Mant√©m apenas metadados de rastreamento essenciais (ID da hist√≥ria, status, propriet√°rio, carimbos de data/hora)
- Reduz o tamanho do arquivo em 80-90% normalmente
- Preserva o conte√∫do completo da hist√≥ria em arquivos markdown
- Mant√©m o hist√≥rico completo do projeto
- Ensures agents can read status.json efficiently

## Par√¢metros

Este comando n√£o possui par√¢metros - ele opera diretamente `docs/09-agents/status.json`.

## Uso

Basta executar:

```bash
/agileflow:compress
```

O comando ir√°:
1. Validar status.json existe e √© JSON v√°lido
2. Mostrar antes das estat√≠sticas (tamanho, linhas, contagem de hist√≥rias)
3. Crie backup autom√°tico
4. Remover campos detalhados
5. Escreva a vers√£o compactada
6. Mostrar depois de estat√≠sticas e economias

## O que √© removido

Esses campos detalhados foram removidos do status.json:

```text
- description          # Story description and context
- acceptanceCriteria   # AC bullet points
- architectureContext  # Architecture details
- technicalNotes       # Implementation hints
- testingStrategy      # Test approach
- devAgentRecord       # Implementation notes
- previousStoryInsights # Lessons from previous story
- (all other large text fields)
```

Estes s√£o preservados com seguran√ßa em `docs/06-stories/` arquivos markdown em vez disso.

## O que √© mantido

Apenas metadados de rastreamento essenciais permanecem em status.json:

```text
- story_id            # Story identifier
- epic                # Parent epic
- title               # Story title
- owner               # Assigned agent
- status              # Current status (ready/in-progress/blocked/done)
- estimate            # Time estimate
- created             # Creation timestamp
- updated             # Last update timestamp
- completed_at        # Completion timestamp
- dependencies        # Dependent story IDs
- branch              # Git branch name
- summary             # Short summary
- last_update         # Last modification message
- assigned_at         # Assignment timestamp
```

## Exemplo de sa√≠da

```text
üóúÔ∏è  AgileFlow Status Compression
   Purpose: Strip verbose fields from status.json
   Target: Keep only essential tracking metadata

üíæ Backup created: docs/09-agents/status.json.backup

üìä Before Compression:
   Stories: 145
   Size: 384KB
   Lines: 12,847

‚úÖ Compression complete!

üìä After Compression:
   Stories: 145 (unchanged)
   Size: 384KB ‚Üí 42KB
   Lines: 12,847 ‚Üí 1,203
   Saved: 89% (342KB)

‚úÖ Estimated tokens: ~10,500 (safely under 25000 limit)

üìã Status Summary:
   ready: 23 stories
   in-progress: 8 stories
   blocked: 2 stories
   done: 112 stories

üíæ To restore original: cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

## Quando usar

### Use compacta√ß√£o quando:

1. **status.json exceeds 25,000 tokens**
   - Os agentes falham com "o conte√∫do do arquivo excede o m√°ximo de tokens permitidos"

2. **File is slow to process**
   - Muito grande para janelas de contexto
   - Causa problemas de tempo limite

3. **After major epic completion**
   - Muitas hist√≥rias conclu√≠das com registros detalhados
   - Projeto cresceu significativamente

4. **Quarterly maintenance**
   - Limpeza regular para continuar monitorando o lean

### Alternativa: Combinar com Arquivamento

Para resultados ainda melhores, combine compacta√ß√£o com arquivamento:

```bash
# Step 1: Archive completed stories older than 3 days
bash .agileflow/scripts/archive-completed-stories.sh 3

# Step 2: Compress remaining stories
/agileflow:compress
```

Este processo de duas etapas atinge a redu√ß√£o m√°xima enquanto mant√©m o hist√≥rico.

## Seguran√ßa e backups

### Backup Autom√°tico

Antes da compacta√ß√£o, o comando cria um backup:
```text
docs/09-agents/status.json.backup
```

### Sem perda de dados

- O conte√∫do completo da hist√≥ria permanece em `docs/06-stories/` arquivos de redu√ß√£o
- Os arquivos de marca√ß√£o da hist√≥ria N√ÉO s√£o modificados
- Apenas o √≠ndice status.json √© compactado
- Sempre √© poss√≠vel restaurar do backup

### Restaure se necess√°rio

```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

O backup cont√©m o arquivo original completo.

## Por que esta arquitetura?

### Separa√ß√£o de Preocupa√ß√µes

**status.json** = √≠ndice de rastreamento leve
- "Que hist√≥rias existem?"
- "Quem √© o dono de cada hist√≥ria?"
- ‚ÄúQual √© o status atual?‚Äù
- "Quando foi atualizado?"

**docs/06-stories/** = conte√∫do completo da hist√≥ria
- Descri√ß√µes completas
- Crit√©rios de aceita√ß√£o
- Decis√µes de arquitetura
- Notas de implementa√ß√£o
- Estrat√©gias de teste

**docs/09-agents/archive/** = dados hist√≥ricos
- Hist√≥rias conclu√≠das anteriores ao limite
- Organiza√ß√£o mensal
- Capacidade de recupera√ß√£o total

### Benef√≠cios

1. **Fast Indexing** - Os agentes leem status.json rapidamente
2. **Complete Content** - Detalhes completos na marca√ß√£o da hist√≥ria
3. **Searchable** - Pode fazer grep em arquivos de hist√≥ria para conte√∫do
4. **Versionable** - Todos os arquivos s√£o rastreados pelo git
5. **Archivable** - Hist√≥rias antigas n√£o aumentam o √≠ndice de rastreamento

## Estimativa de token

O comando estima o uso do token:

```text
Token estimation formula: tokens ‚âà bytes / 4

Before: 384KB √ó 1024 bytes/KB √∑ 4 = 98,304 tokens
After: 42KB √ó 1024 bytes/KB √∑ 4 = 10,752 tokens

Saved: 87,552 tokens!
```

Alvo: manter status.json abaixo de 25.000 tokens (100 KB compactados).

## Integra√ß√£o de fluxo de trabalho

### Com √¥nibus de agente

A compacta√ß√£o status.json n√£o afeta:
- Barramento de mensagens do agente (`docs/09-agents/bus/log.jsonl`)
- Comunica√ß√£o e coordena√ß√£o do agente
- Acompanhamento do status da hist√≥ria

### Com CI/CD

A compacta√ß√£o pode ser adicionada √† automa√ß√£o de CI:

```yaml
name: Maintenance
on:
  schedule:
    - cron: '0 2 * * 0'  # Sunday 2am UTC

jobs:
  compress:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Archive and compress
        run: |
          bash .agileflow/scripts/archive-completed-stories.sh 3
          /agileflow:compress
      - name: Commit if changed
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add docs/09-agents/
          git diff --quiet && git diff --staged --quiet || \
          git commit -m "chore(maintenance): archive and compress status"
          git push
```

## Cen√°rios Comuns

### Cen√°rio 1: Projeto Crescendo

**Problem**: status.json is 250KB with 150 stories
**Solution**:
```bash
/agileflow:compress
```
**Result**: Reduz para 30 KB, facilmente abaixo dos limites de token

### Cen√°rio 2: Muitas hist√≥rias conclu√≠das

**Problem**: 120 hist√≥rias conclu√≠das, 30 hist√≥rias ativas; status.json inchado
**Solution**:
```bash
# Archive stories completed >7 days ago
bash .agileflow/scripts/archive-completed-stories.sh 7

# Then compress
/agileflow:compress
```
**Result**: Move hist√≥rias antigas para arquivo, compacta o restante

### Cen√°rio 3: Manuten√ß√£o Regular

**Problem**: Deseja manter o status.json enxuto automaticamente
**Solution**: Adicionar √† programa√ß√£o de CI (compacta√ß√£o mensal)
**Result**: Sempre abaixo dos limites de token, processamento r√°pido do agente

## Solu√ß√£o de problemas

### "status.json ainda muito grande ap√≥s a compacta√ß√£o"

Experimente um arquivamento mais agressivo:
```bash
# Archive stories >3 days old instead of default 7
bash .agileflow/scripts/archive-completed-stories.sh 3

/agileflow:compress
```

### "Informa√ß√µes cr√≠ticas perdidas ap√≥s compacta√ß√£o"

Restaurar do backup:
```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

Verifique se os arquivos de marca√ß√£o da hist√≥ria cont√™m os detalhes `docs/06-stories/`.

### "N√£o consigo encontrar detalhes da hist√≥ria"

O conte√∫do da hist√≥ria est√° em arquivos markdown:
```bash
find docs/06-stories/ -name "US-*.md" | xargs grep "your search term"
```

## Melhores Pr√°ticas

1. **Regular Compression** - Execute mensalmente ou trimestralmente
2. **Archive Aggressively** - Mova primeiro hist√≥rias antigas conclu√≠das
3. **Back Up Before** - A compacta√ß√£o cria backup automaticamente
4. **Verify After** - Verifique a estimativa do token na sa√≠da
5. **Commit Changes** - Adicionar status compactado ao git
6. **Document Policy** - Registre quando/por que a compacta√ß√£o √© executada
7. **Test Restoration** - Verifique se o backup funciona, se necess√°rio

## Comandos Relacionados

- [`/agileflow:status`](/commands/status) - Veja o status atual da hist√≥ria
- [`/agileflow:validar`](/commands/validate) - Verifique a integridade do sistema AgileFlow
- Script de arquivo: `bash .agileflow/scripts/archive-completed-stories.sh` - Mova hist√≥rias conclu√≠das para arquivar

## Detalhes t√©cnicos

### Arquivos envolvidos

| File | Purpose |
|------|---------|
| `docs/09-agents/status.json` | Lightweight tracking index (compressed) |
| `docs/09-agents/status.json.backup` | Automatic backup before compression |
| `docs/06-stories/` | Full story markdown files (unchanged) |
| `docs/09-agents/archive/YYYY-MM.json` | Historical completed stories |

### Implementa√ß√£o

O script de compacta√ß√£o usa `jq` para processamento JSON:

```bash
# Extract only essential fields for each story
jq '[.[] | {story_id, epic, title, owner, status, estimate, created, updated, completed_at, dependencies, branch, summary, last_update, assigned_at}]' status.json > status-compressed.json
```

### C√°lculo de token

Estimativa aproximada usada na sa√≠da:
- 1 token ‚âà 4 caracteres/bytes (aproximado)
- Arquivo de 100 KB ‚âà 25.000 tokens
- Meta: \< 100 KB para permanecer dentro dos limites

## Perguntas frequentes

<Accordion type="multiple">
  <AccordionItem value="delete">
    <AccordionTrigger>Does compression delete story files?</AccordionTrigger>
    <AccordionContent>
      N√£o. Apenas status.json √© modificado. A marca√ß√£o da hist√≥ria em docs/06-stories/ permanece intacta.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="undo">
    <AccordionTrigger>Can I undo compression?</AccordionTrigger>
    <AccordionContent>
      Sim. Um backup √© criado automaticamente. Basta restaurar: `cp docs/09-agents/status.json.backup docs/09-agents/status.json`
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="when">
    <AccordionTrigger>When should I compress?</AccordionTrigger>
    <AccordionContent>
      Quando status.json exceder 25 KB, ou mensalmente como manuten√ß√£o. Combine com arquivo para obter melhores resultados.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="performance">
    <AccordionTrigger>Does this affect agent performance?</AccordionTrigger>
    <AccordionContent>
      Sim, melhora drasticamente. Status.json menor = leituras mais r√°pidas, contexto mais dispon√≠vel para agentes.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="git">
    <AccordionTrigger>What about git history?</AccordionTrigger>
    <AccordionContent>
      Todas as altera√ß√µes foram confirmadas. As vers√µes anteriores est√£o no hist√≥rico do git, se necess√°rio.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="customize">
    <AccordionTrigger>Can I customize which fields to keep?</AccordionTrigger>
    <AccordionContent>
      Sim, edite o script de compacta√ß√£o para manter campos adicionais, se necess√°rio, para o seu fluxo de trabalho.
    </AccordionContent>
  </AccordionItem>
</Accordion>
