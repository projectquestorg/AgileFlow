---
title: /compressa
description: Compacte status.json removendo campos detalhados e mantendo apenas o rastreamento de metadados
---
# /comprimir

Reduza o tamanho do arquivo status.json removendo campos de história detalhados, preservando todos os metadados críticos de rastreamento e mantendo detalhes completos da história em arquivos markdown.

## Início rápido

```bash
/agileflow:compress
```

## Objetivo

Este comando resolve um problema comum: quando __NOTRASLATE_16__ cresce muito (especialmente em grandes projetos com mais de 100 histórias), ele pode exceder os limites de token e retardar o processamento do agente. O comando compactar:
- Remove campos detalhados (descrições, AC, contexto de arquitetura, etc.)
- Mantém apenas metadados de rastreamento essenciais (ID da história, status, proprietário, carimbos de data/hora)
- Reduz o tamanho do arquivo em 80-90% normalmente
- Preserva o conteúdo completo da história em arquivos markdown
- Mantém o histórico completo do projeto
- Garante que os agentes possam ler o status.json com eficiência

## Parâmetros

Este comando não possui parâmetros - ele opera diretamente em __NOTRASLATE_17__.

## Uso

Basta executar:

```bash
/agileflow:compress
```

O comando irá:
1. Valide status.json existe e é JSON válido
2. Mostrar estatísticas anteriores (tamanho, linhas, número de históriasnão)
3. Crie backup automático
4. Remova campos detalhados
5. Escreva a versão compactada
6. Mostrar estatísticas e economias

## O que é removido

Esses campos detalhados foram removidos do status.json:

```text
- description          # Story description and context
- acceptanceCriteria   # AC bullet points
- architectureContext  # Architecture details
- technicalNotes       # Implementation hints
- testingStrategy      # Test approach
- devAgentRecord       # Implementation notes
- previousStoryInsights # Lessons from previous story
- (all other large text fields)
```

Em vez disso, eles são preservados com segurança em arquivos markdown __NOTRASLATE_18__.

## O que é mantido

Apenas metadados de rastreamento essenciais permanecem em status.json:

__NOTRADUZIR_3__

## Exemplo de saída

__NÃOTRADUZIR_4__

## Quando usar

### Use compactação quando:

1. **status.json excede 25.000 tokens**
   - Os agentes falham com "o conteúdo do arquivo excede o máximo de tokens permitidos"

2. **O processamento do arquivo é lento**
   - Muito grande para janelas de contexto
   - Causa problemas de tempo limite

3. **Após uma grande conclusão épica**
   - Muitas histórias concluídas com registros detalhados
   - Projeto cresceu significativamente

4. **Manutenção trimestral**
   - Limpeza regular para continuar monitorando o lean

### Alternativa: Combinar com Arquivamento

Para resultados ainda melhores, combine compactação com arquivamento:

__NOTRADUZIR_5__

Este processo em duas etapasss atinge a redução máxima enquanto mantém o histórico.

## Segurança e backups

### Backup Automático

Antes da compactação, o comando cria um backup:
__NOTRADUZIR_6__

### Sem perda de dados

- O conteúdo completo da história permanece nos arquivos markdown __NOTRASLATE_19__
- Os arquivos de marcação da história NÃO são modificados
- Somente o índice status.json é compactado
- Sempre é possível restaurar do backup

### Restaure se necessário

__NÃOTRADUZIR_7__

O backup contém o arquivo original completo.

## Por que essa arquitetura?

### Separação de Preocupações

**status.json** = índice de rastreamento leve
- "Que histórias existem?"
- "Quem é o dono de cada história?"
- "Qual é o status atual?"
- "Quando foi atualizado?"

**docs/06-stories/** = conteúdo completo da história
- Descrições completas
- Critérios de aceitação
- Decisões de arquitetura
- Notas de implementação
- Estratégias de teste

**docs/09-agents/archive/** = dados históricos
- Histórias concluídas anteriores ao limite
- Organização mensal
- Capacidade de recuperação total

### Benefícios

1. **Indexação Rápida** - AgenteÉ ler status.json rapidamente
2. **Conteúdo completo** - Detalhes completos na marcação da história
3. **Pesquisável** - Pode buscar conteúdo em arquivos de história
4. **Versionável** - Todos os arquivos são rastreados pelo git
5. **Arquivável** – Histórias antigas não aumentam o índice de rastreamento

## Estimativa de token

O comando estima o uso do token:

__NÃOTRADUZIR_8__

Alvo: manter status.json abaixo de 25.000 tokens (100 KB compactados).

## Integração de fluxo de trabalho

### Com ônibus do agente

A compactação status.json não afeta:
- Barramento de mensagens do agente (__NOTRASLATE_20__)
- Comunicação e coordenação de agentes
- Acompanhamento do status da história

### Com CI/CD

A compactação pode ser adicionada à automação de CI:

__NOTRADUZIR_9__

## Cenários Comuns

### Cenário 1: Projeto crescendo

**Problema**: status.json tem 250 KB com 150 histórias
**Solução**:
__NOTRADUZIR_10__
**Resultado**: Reduz para 30 KB, facilmente abaixo dos limites de token

### Cenário 2: muitas histórias concluídas

**Problema**: 120 histórias concluídas, 30 histórias ativas; status.json inchado
**Solução**:
__NOTRADUZIR_11__
**Resultado**: Move histórias antigas para arquivo, compacta o restante

### Cenário 3: Manutenção Regular

**Problema**: deseja manter o status.json enxuto automaticamente
**Solução**: Adicionar à programação de CI (compactação mensal)
**Resultado**: Sempre abaixo dos limites de token, processamento rápido do agente

## Solução de problemas

### "status.json ainda muito grande após a compactação"

Experimente um arquivamento mais agressivo:
```bash
# Archive stories >3 days old instead of default 7
bash .agileflow/scripts/archive-completed-stories.sh 3

/agileflow:compress
```

### "Informações críticas perdidas após a compactação"

Restaurar do backup:
__NÃOTRADUZIR_13__

Verifique se os arquivos de marcação da história contêm os detalhes em __NOTRASLATE_21__.

### "Não foi possível encontrar detalhes da história"

O conteúdo da história está em arquivos markdown:
__NOTRADUZIR_14__

## Melhores práticas

1. **Compressão regular** - Execute mensalmente ou trimestralmente
2. **Arquivar agressivamente** - Mova primeiro histórias antigas concluídas
3. **Back Up Before** - A compactação cria backup automaticamente
4. **Verificar depois** - Verifique a estimativa do token na saída
5. **Commit Changes** - Adicione status compactado ao git
6. **Política de Documentos** - Registre quando/por que compilarexecuções de ressão
7. **Teste a restauração** - Verifique se o backup funciona, se necessário

## Comandos Relacionados

- [`/agileflow:status`](/commands/status) - Ver o status atual da história
- [__NOTRASLATE_23__](/commands/validate) - Verifique a integridade do sistema AgileFlow
- Arquivar script: __NOTRASLATE_24__ - Mover histórias concluídas para arquivar

## Detalhes Técnicos

### Arquivos envolvidos

| Arquivo | Finalidade |
|------|---------|
| `docs/09-agents/status.json` | Índice de rastreamento leve (compactado) |
| `docs/09-agents/status.json.backup` | Backup automático antes da compactação |
| `docs/06-stories/` | Arquivos de markdown da história completa (inalterados) |
| `docs/09-agents/archive/YYYY-MM.json` | Histórias históricas concluídas |

### Implementação

O script de compactação usa __NOTRASLATE_29__ para processamento JSON:

__NÃOTRADUZIR_15__

### Cálculo de token

Estimativa aproximada usada na saída:
- 1 token ≈ 4 caracteres/bytes (aproximado)
- Arquivo de 100 KB ≈ 25.000 tokens
- Meta: <100 KB para ficar bem dentro dos limites

## Perguntas frequentes

<Accordion type="multiple">
  <AccordionItem value="delete">
    <AccordionTrigger>A compressãon excluir arquivos de história?</AccordionTrigger>
    <AccordionContent>
      Não. Apenas status.json é modificado. A marcação da história em docs/06-stories/ permanece intacta.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="undo">
    <AccordionTrigger>Posso desfazer a compactação?</AccordionTrigger>
    <AccordionContent>
      Sim. Um backup é criado automaticamente. Apenas restaure: __NOTRASLATE_30__
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="when">
    <AccordionTrigger>Quando devo compactar?</AccordionTrigger>
    <AccordionContent>
      Quando status.json exceder 25 KB, ou mensalmente como manutenção. Combine com arquivo para obter melhores resultados.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="performance">
    <AccordionTrigger>Isso afeta o desempenho do agente?</AccordionTrigger>
    <AccordionContent>
      Sim, melhora drasticamente. Status.json menor = leituras mais rápidas, contexto mais disponível para agentes.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="git">
    <AccordionTrigger>Whpor volta da história do git?__NOTRASLATE_62__
    <AccordionContent>
      Todas as alterações foram confirmadas. As versões anteriores estão no histórico do git, se necessário.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="customize">
    <AccordionTrigger>Posso personalizar quais campos manter?__NOTRASLATE_65__
    <AccordionContent>
      Sim, edite o script de compactação para manter campos adicionais, se necessário, para o seu fluxo de trabalho.
    </AccordionContent>
  </AccordionItem>
</Accordion>