---
title: /agileflow:configuração:visual-e2e
description: Configure a infraestrutura de testes Visual E2E com Playwright e verificação de captura de tela
---
# /agileflow:setup:visual-e2e

Configure a infraestrutura de testes Visual E2E com Playwright e fluxo de trabalho de verificação de captura de tela.

## Início rápido

```bash
/agileflow:setup:visual-e2e
```

## Objetivo

Configura uma infraestrutura completa de testes Visual E2E, incluindo:

- Instalação do Playwright com dependências do navegador
- __NOTRASLATE_18__ com inicialização automática do webServer
- Exemplo de teste E2E com captura de tela
- Diretório de capturas de tela para verificação visual
- scripts npm para execução de testes

## Por que Visual E2E?

**O problema**: os testes são aprovados, mas a IU está quebrada.

Os testes funcionais verificam o comportamento, mas não a aparência visual. Um botão pode "funcionar", mas ser:
- Cor errada
- Posição errada
- Sobreposição de outros elementos
- Totalmente ausente (substituído por estado de erro)

O Visual E2E com verificação de captura de tela detecta esses problemas.

## O que é criado

### dramaturgo.config.ts

Configuração do Playwright com webServer para iniciar automaticamente seu servidor de desenvolvimento:

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,

  use: {
    baseURL: 'http://localhost:3000',
    screenshot: 'on',
    trace: 'on-first-retry',
  },

  // Auto-start dev server
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
    timeout: 120000,
  },

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
  ],
});
```

### Exemplo de teste

__NOTRADUZIR_19__:

```typescript
import { test, expect } from '@playwright/test';

test.describe('Visual Verification Examples', () => {
  test('homepage loads correctly', async ({ page }) => {
    await page.goto('/');

    // Capture full-page screenshot for visual verification
    await page.screenshot({
      path: 'screenshots/homepage-full.png',
      fullPage: true,
    });

    // Basic assertions
    await expect(page).toHaveTitle(/./);
  });
});
```

### Diretório Sestrutura

__NOTRADUZIR_3__

### Scripts npm

Adicionado a __NOTRASLATE_20__:

__NÃOTRADUZIR_4__

## Etapas de configuração

O comando executa estas 8 etapas:

1. **Verifique package.json** - Verifique se o projeto tem configuração npm
2. **Instale o Playwright** - `npm install --save-dev @playwright/test`
3. **Instale o navegador** - `npx playwright install --with-deps chromium`
4. **Criar configuração** - __NOTRASLATE_23__ com webServer
5. **Criar diretório de teste** - __NOTRASLATE_24__
6. **Criar diretório de capturas de tela** - __NOTRASLATE_25__
7. **Criar teste de exemplo** - Teste com captura de tela
8. **Adicionar scripts npm** - __NOTRASLATE_26__ scripts
9. **Executar verificação** - Executar teste de exemplo

## Fluxo de trabalho de verificação visual

Após a execução dos testes, as capturas de tela precisam de revisão visual:

### 1. Execute testes

__NOTRADUZIR_5__

Os testes geram capturas de tela no diretório __NOTRASLATE_27__.

### 2. Revise as capturas de tela

Claude analisa cada captura de tela para verificar se a IU está correta.

### 3. Verifique e renomeie

As capturas de tela aprovadas são renomeadas com o prefixo __NOTRASLATE_28__:

__NOTRADUZIR_6__### 4. Execute o verificador

__NÃOTRADUZIR_7__

Isso garante que todas as capturas de tela foram revisadas antes de concluir o trabalho.

## Integração com modo Loop

Visual E2E integra-se com [Loop Mode__NOTRASLATE_36__ para desenvolvimento autônomo de UI:

__NÃOTRADUZIR_8__

No Modo Visual, o loop verifica:
1. Testes aprovados
2. Todas as capturas de tela têm o prefixo __NOTRASLATE_29__
3. Mínimo de 2 iterações concluídas

Isso evita a conclusão prematura do trabalho da UI.

## Parâmetros

| Parâmetro | Padrão | Descrição |
|-----------|---------|------------|
| DEV_CMD | `npm run dev` | Comando do servidor de desenvolvimento |
| PORTO | `3000` | Porta do servidor de desenvolvimento |
| NAVEGADOR | `chromium` | Navegador para instalar (o cromo é o menor, ~300 MB) |

## Executando testes

Após a configuração:

__NOTRADUZIR_9__

## Melhores práticas

### 1. Capture páginas inteiras

Para verificação visual, capture páginas inteiras:

__NOTRADUZIR_10__

### 2. Componentes de captura

Para testes específicos de componentes:

__NOTRADUZIR_11__

### 3. Nomeie as capturas de tela de forma descritiva

```
screenshots/
├── login-form-empty.png
├── login-form-filled.png
├── login-form-error.png
└── dashboard-loaded.png
```

### 4. Teste estados diferentes

__NÃOTRADUZIR_13__

## Solução de problemas

### Navegador não encontrado

Se o Playwright não conseguir encontrar o navegador:

__NOTRADUZIR_14__

### Servidor de desenvolvimento não inicia

Verifique se seu __NOTRASLATE_33__ tem o comando dev correto:

__NÃOTRADUZIR_15__

### Diretório de capturas de tela ausente

Certifique-se de que o diretório exista antes de executar os testes:

__NOTRADUZIR_16__

### Tempo limite dos testes

Aumente o tempo limite do webServer na configuração:

```typescript
webServer: {
  command: 'npm run dev',
  timeout: 180000,  // 3 minutes
}
```

## Relacionado

- [Modo Visual__NOTRASLATE_37__ - Sistema de verificação de captura de tela
- [Loop Mode__NOTRASLATE_38__ - Processamento autônomo de histórias
- [`/agileflow:verify`__NOTRASLATE_39__ - Execute testes e verificação
- [`/agileflow:tests`](/commands/tests) - Testando a configuração da infraestrutura