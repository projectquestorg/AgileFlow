---
title: /agileflow:setup:visual-e2e
description: Richten Sie eine Visual E2E-Testinfrastruktur mit Playwright und Screenshot-Verifizierung ein
---
# /agileflow:setup:visual-e2e

Set up Visual E2E testing infrastructure with Playwright and screenshot verification workflow.

## Schnellstart

```bash
/agileflow:setup:visual-e2e
```

## Zweck

Richtet eine vollständige Visual E2E-Testinfrastruktur ein, einschließlich:

- Playwright-Installation mit Browserabhängigkeiten
- `playwright.config.ts` mit WebServer-Autostart
- Beispiel eines E2E-Tests mit Screenshot-Erfassung
- Screenshots-Verzeichnis zur visuellen Überprüfung
- NPM-Skripte zum Ausführen von Tests

## Warum Visual E2E?

**Das Problem**: Tests bestehen, aber die Benutzeroberfläche ist defekt.

Funktionstests überprüfen das Verhalten, nicht jedoch das optische Erscheinungsbild. Eine Schaltfläche kann „funktionieren“, aber sein:
- Falsche Farbe
- Falsche Position
- Überlappung mit anderen Elementen
- Fehlt vollständig (ersetzt durch Fehlerstatus)

Visual E2E mit Screenshot-Überprüfung erkennt diese Probleme.

## Was erstellt wird

### playwright.config.ts

Playwright-Konfiguration mit webServer zum automatischen Starten Ihres Entwicklungsservers:

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,

  use: {
    baseURL: 'http://localhost:3000',
    screenshot: 'on',
    trace: 'on-first-retry',
  },

  // Auto-start dev server
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
    timeout: 120000,
  },

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
  ],
});
```

### Beispieltest

`tests/e2e/visual-example.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';

test.describe('Visual Verification Examples', () => {
  test('homepage loads correctly', async ({ page }) => {
    await page.goto('/');

    // Capture full-page screenshot for visual verification
    await page.screenshot({
      path: 'screenshots/homepage-full.png',
      fullPage: true,
    });

    // Basic assertions
    await expect(page).toHaveTitle(/./);
  });
});
```

### Verzeichnis SStruktur

```
your-project/
├── playwright.config.ts
├── tests/
│   └── e2e/
│       └── visual-example.spec.ts
├── screenshots/
│   ├── homepage-full.png          # After test runs
│   └── verified-homepage-full.png # After visual review
└── package.json                   # Updated with test:e2e scripts
```

### npm-Skripte

Hinzugefügt zu `package.json`:

```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:headed": "playwright test --headed"
  }
}
```

## Einrichtungsschritte

Der Befehl führt diese 8 Schritte aus:

1. **Überprüfen Sie package.json** – Überprüfen Sie, ob das Projekt über ein NPM-Setup verfügt
2. **Playwright installieren** – `npm install --save-dev @playwright/test`
3. **Browser installieren** – `npx playwright install --with-deps chromium`
4. **Konfiguration erstellen** - `playwright.config.ts` mit webServer
5. **Testverzeichnis erstellen** – `tests/e2e/`
6. **Screenshots-Verzeichnis erstellen** – `screenshots/`
7. **Beispieltest erstellen** – Test mit Screenshot-Erfassung
8. **Npm-Skripte hinzufügen** – `test:e2e` Skripte
9. **Überprüfung durchführen** – Beispieltest ausführen

## Visueller Verifizierungsworkflow

Nachdem die Tests ausgeführt wurden, müssen die Screenshots visuell überprüft werden:

### 1. Führen Sie Tests durch

```bash
npm run test:e2e
```

Tests generieren Screenshots im Verzeichnis `screenshots/`.

### 2. Überprüfen Sie die Screenshots

Claude überprüft jeden Screenshot, um sicherzustellen, dass die Benutzeroberfläche korrekt aussieht.

### 3. Überprüfen und umbenennen

Genehmigte Screenshots werden mit dem Präfix `verified-` umbenannt:

```bash
mv screenshots/homepage.png screenshots/verified-homepage.png
```### 4. Führen Sie Verifier aus

```bash
node scripts/screenshot-verifier.js --path ./screenshots
```

Dadurch wird sichergestellt, dass alle Screenshots überprüft wurden, bevor die Arbeit als abgeschlossen markiert wird.

## Integration mit Loop-Modus

Visual E2E lässt sich in [Loop Mode](/features/loop-mode)] für die autonome UI-Entwicklung integrieren:

```bash
# Initialize loop with Visual Mode
/agileflow:babysit EPIC=EP-0042 MODE=loop VISUAL=true
```

Im visuellen Modus prüft die Schleife Folgendes:
1. Tests bestehen
2. Alle Screenshots haben das Präfix `verified-`
3. Mindestens 2 Iterationen abgeschlossen

Dies verhindert einen vorzeitigen Abschluss der UI-Arbeit.

## Parameter

| Parameter | Standard | Beschreibung |
|-----------|---------|-------------|
| DEV_CMD | `npm run dev` | Dev-Server-Befehl |
| HAFEN | `3000` | Dev-Server-Port |
| BROWSER | `chromium` | Zu installierender Browser (Chrom ist am kleinsten, ~300 MB) |

## Tests ausführen

Nach der Einrichtung:

```bash
# Run all E2E tests
npm run test:e2e

# Run with UI (interactive mode)
npm run test:e2e:ui

# Run with visible browser
npm run test:e2e:headed

# Run specific test
npx playwright test tests/e2e/visual-example.spec.ts
```

## Best Practices

### 1. Ganze Seiten erfassen

Erfassen Sie zur visuellen Überprüfung ganze Seiten:

```typescript
await page.screenshot({
  path: 'screenshots/homepage.png',
  fullPage: true,
});
```

### 2. Komponenten erfassen

Für komponentenspezifische Tests:

```typescript
const header = page.locator('header').first();
await header.screenshot({
  path: 'screenshots/header.png',
});
```

### 3. Benennen Sie Screenshots beschreibend

```
screenshots/
├── login-form-empty.png
├── login-form-filled.png
├── login-form-error.png
└── dashboard-loaded.png
```

### 4. Testen Sie verschiedene Zustände

```typescript
// Empty state
await page.screenshot({ path: 'screenshots/list-empty.png' });

// Loading state
await page.goto('/users');
await page.screenshot({ path: 'screenshots/list-loading.png' });

// Loaded state
await page.waitForSelector('[data-testid="user-list"]');
await page.screenshot({ path: 'screenshots/list-loaded.png' });
```

## Fehlerbehebung

### Browser nicht gefunden

Wenn Playwright den Browser nicht finden kann:

```bash
npx playwright install --with-deps chromium
```

### Dev-Server startet nicht

Überprüfen Sie, ob Ihr `package.json` den richtigen Dev-Befehl hat:

```json
{
  "scripts": {
    "dev": "next dev"  // or your dev command
  }
}
```

### Screenshots-Verzeichnis fehlt

Stellen Sie sicher, dass das Verzeichnis vorhanden ist, bevor Sie Tests ausführen:

```bash
mkdir -p screenshots
```

### Testzeitüberschreitung

Erhöhen Sie das WebServer-Timeout in der Konfiguration:

```typescript
webServer: {
  command: 'npm run dev',
  timeout: 180000,  // 3 minutes
}
```

## Verwandte

- [Visual Mode](/features/visual-mode) - Screenshot-Verifizierungssystem
- [Loop Mode](/features/loop-mode) – Autonome Story-Verarbeitung
- [`/agileflow:verify`](/commands/verify) – Führen Sie Tests und Überprüfungen durch
- [`/agileflow:tests`](/commands/tests) – Testen der Infrastruktureinrichtung