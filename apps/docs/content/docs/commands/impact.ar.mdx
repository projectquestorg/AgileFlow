---
title: "/تأثير"
description: تحليل تأثير التغيير عبر قاعدة التعليمات البرمجية
---

# /تأثير

قم بتحليل تأثير تغييرات التعليمات البرمجية على أجزاء أخرى من قاعدة التعليمات البرمجية الخاصة بك لمنع التراجعات. يحدد اكتشاف التأثير الملفات والاختبارات والميزات المتأثرة، ثم يقترح الاختبارات التي سيتم تشغيلها وما قد يتعطل.

## بداية سريعة

```bash
# Auto-detect changes on current branch
/agileflow:impact

# Analyze specific files
/agileflow:impact FILES=src/api/auth.ts,src/middleware/jwt.ts

# Skip test execution
/agileflow:impact RUN_TESTS=no
```

الأمر سوف:
1. تحديد الملفات التي تم تغييرها
2. Map dependencies (direct and indirect)
3. البحث عن الاختبارات ذات الصلة
4. كشف التغييرات العاجلة
5. إنشاء تقرير التأثير
6. قم بإجراء الاختبارات المتأثرة بشكل اختياري

## الميزات الرئيسية

### تحليل الرسم البياني للتبعية

يقوم Impact تلقائيًا بإنشاء رسم بياني للتبعية:

```text
Your Change: src/api/auth.ts
  ├─ Direct dependents (files that import this)
  │  ├─ src/api/auth/index.ts
  │  ├─ src/middleware/auth.ts
  │  └─ tests/api/auth/login.test.ts
  └─ Indirect dependents (2-level chain)
     ├─ src/app.ts
     ├─ src/routes.ts
     └─ [more...]
```

### اكتشاف الاختبار

يجد تلقائيًا الاختبارات التي تحتاج إلى تشغيل:

```text
Critical (Always Run):
  ✓ tests/api/auth/login.test.ts
  ✓ tests/integration/auth-flow.test.ts

Recommended (Affected Indirectly):
  ⚠️  tests/api/users/*.test.ts
  ⚠️  tests/e2e/login.spec.ts

Optional (Low Risk):
  - tests/components/Header.test.tsx
```

### كسر كشف التغيير

يحدد تغييرات توقيع الوظيفة:

```text
⚠️  BREAKING CHANGE DETECTED

File: src/api/auth/login.ts
Function: login()

Before:
  login(email: string, password: string): Promise<Token>

After:
  login(credentials: LoginRequest): Promise<AuthResponse>

Affected callers:
  - src/middleware/auth.ts:45
  - tests/api/auth/login.test.ts:23
  - tests/integration/auth-flow.test.ts:67
```

### رسم خرائط التغطية

يظهر تغطية الاختبار للكود الذي تم تغييره:

```text
Changed Lines:  45-52 (8 lines)
Test Coverage:  87%
Uncovered:      Lines 50-51 (2 lines not tested)

⚠️  2 lines of changes have no test coverage
    Consider adding tests for these paths
```

## الاستخدام

### الأساسية - الكشف التلقائي عن التغييرات

```bash
/agileflow:impact
```

يستخدم git للعثور على التغييرات في الفرع الحالي وتحليل التأثير.

### تحليل ملفات محددة

```bash
/agileflow:impact FILES=src/api/auth.ts,src/middleware/jwt.ts
```

يقوم بتحليل الملفات المدرجة فقط (مفيد للتحليل اليدوي).

### فرع قاعدة مختلفة

```bash
/agileflow:impact BASE=develop
```

يقارن مع التطوير بدلاً من الرئيسي/الماجستير.

### تخطي تنفيذ الاختبار

```bash
/agileflow:impact RUN_TESTS=no
```

يظهر تحليل التأثير ولكن لا يقوم بإجراء الاختبارات.

## حدود

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `FILES` | No | Auto-detect | Comma-separated file paths |
| `BASE` | No | main/master | Base branch for comparison |
| `RUN_TESTS` | No | yes | Execute affected tests |

## أمثلة

### تغييرات الميزات النموذجية

```bash
/agileflow:impact

# Output:
# Impact Analysis Report
#
# Changed Files: 3
# - src/api/auth.ts (23 lines modified)
# - src/middleware/auth.ts (15 lines modified)
# - src/components/LoginForm.tsx (12 lines modified)
#
# Affected Files: 8
# - Direct dependents: 3
# - Indirect dependents: 5
#
# Tests to Run: 5
# - Critical: 2 (direct tests)
# - Recommended: 3 (integration tests)
#
# Coverage: 87% (2 lines uncovered)
```

### تغيير البرمجيات الوسيطة الأمنية

```bash
/agileflow:impact FILES=src/middleware/auth.ts

# Output:
# Changed: src/middleware/auth.ts (34 lines)
#
# Direct Dependents (6):
#   - src/api/auth/index.ts
#   - src/api/users/index.ts
#   - src/api/posts/index.ts
#   - src/middleware/validate.ts
#   - src/app.ts
#   - tests/middleware/auth.test.ts
#
# Tests to Run:
#   ✓ tests/middleware/auth.test.ts
#   ⚠️  tests/integration/auth-flow.test.ts
#   ⚠️  tests/api/*/index.test.ts
```

### كسر كشف التغيير

```bash
/agileflow:impact

# Output includes:
# ⚠️  BREAKING CHANGE DETECTED
#
# Function signature changed in src/api/auth/login.ts
#
# Before: login(email, password)
# After:  login(credentials)
#
# Update these callers:
#   - src/middleware/auth.ts:45
#   - tests/api/auth/login.test.ts:23
```

## هيكل تقرير التأثير

### رأس

```text
# Impact Analysis Report

**Branch**: feature/user-auth
**Base**: main
**Changed Files**: 5
**Potentially Affected Files**: 23
**Tests to Run**: 12
```

### التأثيرات المباشرة

لكل ملف تم تغييره:

```text
### src/api/auth/login.ts (MODIFIED)

**Type**: API endpoint
**Changes**: 23 lines modified

**Direct dependents** (3):
- src/api/auth/index.ts (exports this endpoint)
- src/middleware/auth.ts (uses login logic)
- tests/api/auth/login.test.ts (tests this file)

**Indirect dependents** (8):
- src/app.ts → src/api/auth/index.ts → login.ts
- src/routes.ts → src/api/auth/index.ts → login.ts
- [6 more...]

**Related tests**:
- ✅ tests/api/auth/login.test.ts (exists)
- ⚠️  tests/integration/auth-flow.test.ts (may need updates)
- ❌ Missing: E2E test for login flow

**Related stories**:
- US-0042: Implement JWT authentication (IN-REVIEW)

**Coverage**: 87% (lines 45-52 uncovered)
```

## طرق التحليل

### التحليل الساكن

يستخدم Impact تحليل التعليمات البرمجية الثابتة (لا يوجد تعليمات برمجية قيد التشغيل):

- تحليل بيانات الاستيراد/الطلب
- بناء الرسم البياني التبعية
- تحديد التبعيات الدائرية
- ابحث عن الكود المصدر ولكن غير المستخدم
- خريطة علاقات الملفات

**Benefits**: سريع، لا يتطلب إنشاء/اختبارات للتشغيل، ويلتقط تغييرات الاستيراد

### رسم خرائط تغطية الاختبار

تم تغيير خطوط الخرائط إلى اختبارات:

- يقرأ تقارير التغطية (إن وجدت)
- يطابق أرقام الأسطر لملفات الاختبار
- يحدد التغييرات المكشوفة
- يقترح إضافات الاختبار

### مطابقة الأنماط

مطابقة الأنماط الذكية للاختبارات ذات الصلة:

| Change Type | Pattern |
|-------------|---------|
| API route changed | Look for `routes.test.ts`, `api/*.test.ts` |
| Component changed | Look for `*.test.tsx`, `*.stories.tsx` |
| Service changed | Look for `service.test.ts`, integration tests |
| Type changed | Look for `*.test.ts` that use the type |

## كسر التغييرات

يكتشف التأثير التغييرات العاجلة:

### تغيير توقيع الوظيفة

```text
⚠️  BREAKING CHANGE

Function: login()
Before:   login(email: string, password: string)
After:    login(credentials: LoginRequest)

Callers to update:
- src/middleware/auth.ts:45
  OLD: login(user.email, user.password)
  NEW: login({ email: user.email, password: user.password })
```

### تمت إزالة التصدير

```text
⚠️  BREAKING CHANGE

Removed export: validateSession
(was in src/middleware/auth.ts)

Callers will break:
- src/api/posts/index.ts:23 - imports validateSession
- tests/middleware/auth.test.ts:45
```

### اكتب التغيير

```text
⚠️  BREAKING CHANGE

Type changed: User interface
Added required field: verified_at (Date)

Callers creating User without field:
- src/api/auth/signup.ts:67
- src/seeders/users.ts:12
```

## توصيات الاختبار

يقترح التأثير الاختبارات التي سيتم تشغيلها:

### حرجة (تشغيل دائمًا)

- اختبارات الوحدة المباشرة للملفات التي تم تغييرها
- الاختبارات التي تستهدف على وجه التحديد التعليمات البرمجية التي تم تغييرها
- تم تغيير كافة الاختبارات التي تستورد الملف

### موصى به (تشغيل إذا سمح الوقت)

- اختبارات التكامل باستخدام الملفات التي تم تغييرها
- اختبارات شاملة من خلال الميزات المتغيرة
- اختبارات الميزات التابعة

### اختياري (منخفض المخاطر)

- الاختبارات الطرفية
- اختبارات مع سلاسل التبعية غير المباشرة
- اختبارات الميزات غير ذات الصلة

## الإجراءات بعد التحليل

### 1. مراجعة ملخص التأثير

```text
Changed: 3 files
Affected: 8 files
Tests: 5 need to run
```

### 2. تشغيل الاختبارات (إذا كان RUN_TESTS = نعم)

```text
Running critical tests...
✅ tests/api/auth/login.test.ts (12 tests, 345ms)
✅ tests/middleware/auth.test.ts (8 tests, 234ms)
⚠️  tests/integration/auth-flow.test.ts (3 tests, FAILED)

Test Results: 20 passed, 3 failed
```

### 3. التعامل مع الفشل

إذا فشلت الاختبارات:

```text
Tests failed. Options:
1. Fix code and re-run tests
2. Create story for regression
3. Skip and investigate later

What should we do?
```

### 4. التعامل مع التغييرات العاجلة

في حالة اكتشاف تغييرات معطلة:

```text
⚠️  Breaking changes found!

These functions changed signature:
- login() in src/api/auth.ts

3 callers need to be updated:
- src/middleware/auth.ts:45
- tests/api/auth/login.test.ts:23

Create stories to update these files?
```

## التصور

يمكن أن يتصور التأثير أشجار التبعية:

```text
src/api/auth/login.ts (CHANGED)
├── src/api/auth/index.ts (direct)
│   ├── src/app.ts (indirect)
│   └── src/routes.ts (indirect)
├── src/middleware/auth.ts (direct)
│   └── src/app.ts (indirect)
└── tests/api/auth/login.test.ts (test)
```

## التكامل مع CI

اقترح CI محسّنًا يقوم بتشغيل الاختبارات المتأثرة فقط:

```yaml
- name: Impact analysis
  run: npx claude-code /agileflow:impact BASE=main

- name: Run affected tests
  run: npm test -- $(cat affected-tests.txt)

- name: Check for breaking changes
  run: |
    if grep -q "BREAKING CHANGE" impact-report.md; then
      echo "::warning::Breaking changes detected"
    fi
```

## حالات الاستخدام

### قبل تقديم العلاقات العامة

```bash
# Check impact of your changes
/agileflow:impact

# Run the recommended tests
# If any fail, fix before submitting PR
```

### بعد تعليقات مراجعة الكود

```bash
# You made changes based on review
/agileflow:impact

# Make sure nothing broke
# Re-run affected tests
```

### قبل الدمج مع الرئيسي

```bash
# Final check before merge
/agileflow:impact BASE=main

# Ensure no regressions
# All critical tests passing
```

### إعادة هيكلة السلامة

```bash
# Before large refactor
/agileflow:baseline "Before refactor"

# Make changes
# Check impact
/agileflow:impact

# If breaking changes, understand them
# Update callers accordingly
```

## نصائح

### قم بتشغيل التأثير مبكرًا وفي كثير من الأحيان

```bash
# After each major change
/agileflow:impact

# Catch breakage early
# Easier to fix one change than many
```

### انتبه إلى التأثيرات غير المباشرة

```text
Direct impact: 3 affected files
Indirect impact: 8 more affected files

Fixing direct isn't enough - test indirects too
```

### تغطية الاختبار مهمة

```text
87% coverage = 13% of changes untested
Missing tests = potential bugs from untested paths

Add tests for uncovered lines
```

### التغييرات العاجلة تتطلب التنسيق

```text
⚠️  Function signature changed
Need to update 5 callers
Create stories to track the updates
```

## الأوامر ذات الصلة

- [`/مراجعة`](/commands/review) - مراجعة جودة الكود
- [`/التحقق`](/commands/verify) - تشغيل الاختبارات
- [`/العلاقات العامة`](/commands/pr) - إنشاء العلاقات العامة مع ملاحظات التأثير
- [`/ جليسة الأطفال`](/commands/babysit) - إرشادات التنفيذ (يعمل بالتأثير)
- [`/خط الأساس`](/commands/baseline) - إنشاء نقطة تفتيش تم التحقق منها
