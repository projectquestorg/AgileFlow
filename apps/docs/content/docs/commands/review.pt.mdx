---
title: "/an√°lise"
description: Revis√£o de c√≥digo baseada em IA com sugest√µes de qualidade
---

# /an√°lise

Execute uma revis√£o abrangente de c√≥digo com tecnologia de IA em altera√ß√µes de pull request. Review analisa o c√≥digo quanto √† qualidade, seguran√ßa, desempenho e pr√°ticas recomendadas e fornece feedback acion√°vel com exemplos de c√≥digo espec√≠ficos.

## In√≠cio r√°pido

```bash
# Review current branch against main
/agileflow:review

# Review specific branch
/agileflow:review BRANCH=feature/auth

# Review with focus on security
/agileflow:review FOCUS=security
```

O comando ir√°:
1. Obtenha altera√ß√µes de c√≥digo (git diff)
2. Analise em 6 categorias (Qualidade, Seguran√ßa, Desempenho, Melhores Pr√°ticas, Testes, Documenta√ß√£o)
3. Gere relat√≥rio detalhado com problemas priorizados por gravidade
4. Calcular o √≠ndice de qualidade do c√≥digo
5. Sugira corre√ß√µes autom√°ticas e trabalho de acompanhamento

## Principais recursos

### An√°lise Abrangente

A revis√£o examina as altera√ß√µes do seu c√≥digo em 6 categorias importantes:

| Category | Checks |
|----------|--------|
| **Code Quality** | Complexity, duplication, naming, function/file length |
| **Security** | SQL injection, XSS, hardcoded secrets, unsafe deserialization |
| **Performance** | N+1 queries, inefficient algorithms, memory leaks |
| **Best Practices** | Error handling, logging, type safety, async/await |
| **Testing** | Missing tests, test quality, coverage gaps |
| **Documentation** | Missing JSDoc, outdated comments, README updates |

### Prioriza√ß√£o Baseada em Gravidade

Os problemas s√£o categorizados por impacto:

```text
üî¥ CRITICAL - Must fix before merge
üü† HIGH    - Fix before merge (blocks release)
üü° MEDIUM  - Address soon (technical debt)
‚ö™ LOW     - Nice to have (style/consistency)
```

### √çndice de qualidade do c√≥digo

Seu PR recebe uma pontua√ß√£o (0-100) dividida por categoria:

```text
Code Quality Score: 72/100

Breakdown:
- Security: 40/100 (critical issues found)
- Performance: 75/100 (one N+1 query)
- Maintainability: 80/100 (some complexity)
- Testing: 65/100 (coverage gaps)
- Style: 90/100 (mostly consistent)
```

### Feedback construtivo

Cada edi√ß√£o inclui:
- Onde est√° (arquivo, n√∫mero da linha)
- Por que √© importante (risco/impacto)
- Como consertar (exemplos de c√≥digo espec√≠ficos)
- Exemplo de ‚ùå c√≥digo RUIM
- Exemplo de ‚úÖ c√≥digo BOM

## Uso

### B√°sico - revise o branch atual

```bash
/agileflow:review
```

Revisa as altera√ß√µes na ramifica√ß√£o atual em rela√ß√£o √† principal/mestre.

### Revise a filial espec√≠fica

```bash
/agileflow:review BRANCH=feature/user-auth
```

Analisa o branch nomeado em rela√ß√£o ao main.

### Revis√£o em rela√ß√£o a uma base diferente

```bash
/agileflow:review BRANCH=feature/auth BASE=develop
```

Compara com um branch base diferente.

### Revis√£o com √°rea de foco

```bash
# Security-only review
/agileflow:review FOCUS=security

# Performance-only review
/agileflow:review FOCUS=performance

# Testing coverage review
/agileflow:review FOCUS=tests
```

### Filtrar por gravidade

```bash
# Show only critical/high issues
/agileflow:review SEVERITY=high

# Show all issues
/agileflow:review SEVERITY=all
```

## Par√¢metros

| Parameter | Required | Default | Options |
|-----------|----------|---------|---------|
| `BRANCH` | No | Current | Branch name to review |
| `BASE` | No | main/master | Base branch for comparison |
| `FOCUS` | No | all | all, security, performance, style, tests |
| `SEVERITY` | No | all | critical, high, medium, low, all |

## Exemplos

### Revis√£o t√≠pica de rela√ß√µes p√∫blicas

```bash
/agileflow:review

# Output:
# AI Code Review Report
# Branch: feature/user-auth
# Files Changed: 5
# Critical: 1 | High: 3 | Medium: 5 | Low: 2
# Code Quality Score: 72/100
#
# üî¥ CRITICAL ISSUES
# - Hardcoded API key in stripe.ts:15
#
# üü† HIGH ISSUES
# - N+1 query in posts API
# - Missing error handling in login
# ...
```

### Revis√£o focada na seguran√ßa

```bash
/agileflow:review FOCUS=security

# Analyzes only for:
# - Hardcoded secrets
# - SQL injection risks
# - XSS vulnerabilities
# - Authentication issues
# - CORS misconfiguration
```

### Avalia√ß√£o de desempenho

```bash
/agileflow:review FOCUS=performance

# Checks for:
# - N+1 database queries
# - Inefficient algorithms
# - Missing indexes
# - Memory leaks
# - Bundle size issues
```

## Revise a estrutura do relat√≥rio

### Cabe√ßalho

```text
# AI Code Review Report

**Branch**: feature/user-auth
**Base**: main
**Files Changed**: 8
**Lines Added**: 245
**Lines Removed**: 32
**Generated**: 2025-10-16T10:30:00Z
```

### Resumo

```text
## Summary

**Critical**: 2 | **High**: 5 | **Medium**: 12 | **Low**: 8
**Must Fix Before Merge**: 7 issues
```

### Problemas por gravidade

Para cada quest√£o:

```text
### 1. Hardcoded API Key (SECURITY)
**File**: src/api/payments/stripe.ts:15
**Severity**: CRITICAL

// ‚ùå BAD
const stripeKey = "sk_live_abc123...";

// ‚úÖ GOOD
const stripeKey = process.env.STRIPE_SECRET_KEY;
if (!stripeKey) throw new Error("STRIPE_SECRET_KEY not set");

**Risk**: API key exposed in version control.
**Fix**: Move to environment variable. Rotate immediately.
**Priority**: Block merge
```

### Observa√ß√µes Positivas

```text
## Positive Observations ‚úÖ

- ‚úÖ Good use of TypeScript strict mode
- ‚úÖ Consistent error handling pattern
- ‚úÖ Well-structured component separation
- ‚úÖ Clear commit messages
```

### An√°lise da qualidade do c√≥digo

```text
## Code Quality Score: 72/100

**Breakdown**:
- Security: 40/100 (2 critical issues)
- Performance: 75/100 (1 N+1 query)
- Maintainability: 80/100 (some complexity)
- Testing: 65/100 (coverage gaps)
- Style: 90/100 (mostly consistent)
```

## Personaliza√ß√£o

### Regras espec√≠ficas do projeto

Crie regras de revis√£o personalizadas em:
- `.agileflow/review-rules.md`
- `docs/02-practices/code-standards.md`

Exemplo:

```markdown
# Code Review Rules

## Critical
- No console.log in production code
- All API endpoints must have rate limiting
- All database queries must use ORM

## High
- Functions >30 lines should be refactored
- Test coverage must be >85%
```

## A√ß√µes ap√≥s revis√£o

### Problemas de corre√ß√£o autom√°tica

```text
Review asks: "Fix auto-fixable issues? (YES/NO)"

If YES:
  - Runs npm run lint -- --fix
  - Fixes 8 style issues automatically
  - Shows which issues were fixed
```

### Crie hist√≥rias de acompanhamento

```text
Review asks: "Create stories for follow-up work?"

If YES:
  - Creates story for each medium/low issue
  - Adds to your backlog
  - Links to code review report
```

### Bloquear mesclagem para problemas cr√≠ticos

```text
Review asks: "Block merge for critical/high issues?"

If YES:
  - Marks merge as blocked
  - Provides failure reason
  - Suggests resolution steps
```

### Salvar relat√≥rio

Relat√≥rio salvo automaticamente em:
```text
docs/08-project/code-reviews/<YYYYMMDD>-<BRANCH>.md
```

Exemplo:
```text
docs/08-project/code-reviews/20251016-feature-user-auth.md
```

## Verifica√ß√µes de seguran√ßa

Rever verifica automaticamente:

### Segredos e credenciais
- Chaves de API codificadas
- Senhas de banco de dados
- Tokens OAuth
- Segredos do JWT
- Credenciais da AWS

### Vulnerabilidades Comuns
- Inje√ß√£o de SQL (consultas n√£o parametrizadas)
- Ataques XSS (sa√≠da sem escape)
- Desserializa√ß√£o insegura
- Vulnerabilidades CSRF
- Valida√ß√£o CORS ausente

### Padr√µes Inseguros
- avalia√ß√£o() ou Fun√ß√£o()
- Concatena√ß√£o de strings insegura
- Valida√ß√£o de entrada ausente
- Criptografia fraca
- Depend√™ncias inseguras

## Verifica√ß√µes de desempenho

A revis√£o procura:

### Banco de dados
- Problemas de consulta N+1
- √çndices ausentes
- Jun√ß√µes ineficientes
- Consultas desnecess√°rias

### Algoritmos
- O(n¬≤) quando O(n) poss√≠vel
- Loops aninhados que podem ser planos
- C√°lculos repetidos
- Recurs√£o n√£o otimizada

### Mem√≥ria
- Vazamentos de mem√≥ria
- Objetos grandes n√£o liberados
- Refer√™ncias circulares
- Estruturas de dados que consomem muita mem√≥ria

## Cobertura de testes

Revise as verifica√ß√µes:

### Novo C√≥digo
- Existe um teste para novas funcionalidades?
- Os casos extremos s√£o cobertos?
- A qualidade do teste √© boa?

### Lacunas de cobertura
- Linhas adicionadas sem testes
- Fun√ß√µes sem cobertura de teste
- Caminhos de erro n√£o testados

### Qualidade do teste
- As afirma√ß√µes s√£o significativas?
- Os testes verificam o comportamento?
- Os testes s√£o sustent√°veis?

## Resultados e recomenda√ß√µes

### A√ß√µes imediatas (mesclagem de blocos)

```text
1. Remove hardcoded API key (critical)
2. Fix SQL injection (critical)
3. Add error handling to login (high)
```

### Antes de mesclar

```text
4. Add tests for auth endpoints (high)
5. Fix N+1 query in posts API (high)
6. Reduce complexity in validator.ts (medium)
```

### Acompanhamento (criar hist√≥rias)

```text
7. Standardize naming conventions (medium)
8. Add ESLint rule for secrets (medium)
9. Set up automated security scanning (low)
```

## Integra√ß√£o com CI

Sugira adicionar a `.github/workflows/pr.yml`:

```yaml
- name: AI Code Review
  run: npx claude-code /agileflow:review BRANCH=${{ github.head_ref }}

- name: Check for critical issues
  run: |
    if grep -q "CRITICAL" code-review-report.md; then
      echo "::error::Critical issues found."
      exit 1
    fi
```

## Pontas

### Antes de enviar PR

```bash
/agileflow:review
# Fix any CRITICAL or HIGH issues
# Address MEDIUM issues if possible
# Then submit PR with confidence
```

### Melhoria iterativa

```bash
# After feedback, run review again
/agileflow:review

# See if score improved
# Ensure critical issues fixed
# Check test coverage
```

### Abordagem que prioriza a seguran√ßa

```bash
# Always check security first
/agileflow:review FOCUS=security

# Fix any CRITICAL security issues
# Then review other categories
```

## Princ√≠pios

- **Be constructive** - Forne√ßa feedback acion√°vel, n√£o apenas cr√≠ticas
- **Show examples** - Incluir c√≥digo ‚ùå RUIM e ‚úÖ BOM
- **Prioritize** - Quest√µes cr√≠ticas primeiro, estilo por √∫ltimo
- **Celebrate** - Incluir observa√ß√µes positivas
- **Suggest fixes** - N√£o apenas identifique problemas
- **No force commits** - Sempre pergunte antes da corre√ß√£o autom√°tica

## Comandos Relacionados

- [`/pr`](/commands/pr) - Gerar descri√ß√£o do PR (revisar antes de enviar)
- [`/impacto`](/commands/impact) - Analisar o impacto da mudan√ßa
- [`/bab√°`](/commands/babysit) - Orienta√ß√£o de implementa√ß√£o (realiza revis√£o antes do PR)
- [`/verificar`](/commands/verify) - Verifique a aprova√ß√£o nos testes
- [`/linha de base`](/commands/baseline) - Criar ponto de verifica√ß√£o verificado
