---
title: /قصة
description: أنشئ قصة مستخدم بمعايير القبول
---

# /قصة

قم بإنشاء قصة مستخدم جديدة بمعايير القبول، ونقاط الاختبار، وتتبع الحالة.

## بداية سريعة

```bash
/agileflow:story EPIC=<EP-ID> STORY=<US-ID> TITLE=<text> OWNER=<id>
```

## حدود

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `EPIC` | Yes | - | Parent epic ID (e.g., EP-0001) |
| `STORY` | Yes | - | Story identifier (e.g., US-0001) |
| `TITLE` | Yes | - | Story title describing the feature |
| `OWNER` | Yes | - | Owner name or agent ID (e.g., AG-UI, AG-API) |
| `ESTIMATE` | No | `0.5d` | Time estimate (e.g., `0.5d`, `1d`, `2d`) |
| `AC` | No | - | Acceptance criteria in Given/When/Then format |
| `DEPENDENCIES` | No | - | Comma-separated list of dependent story IDs (e.g., `US-0001,US-0002`) |
| `TDD` | No | Smart default | Enable TDD mode to generate test stubs from acceptance criteria |

## أمثلة

### إنشاء القصة الأساسية

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0001 TITLE="User registration form" OWNER=AG-UI
```

يقوم بإنشاء ملف قصة في `docs/06-stories/EP-0010/US-0001-user-registration-form.md` مع التقدير الافتراضي (0.5 د) والحالة (جاهز).

### قصة مع معايير القبول

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0002 TITLE="Validate email address" OWNER=AG-API ESTIMATE=1d AC="Given a valid email, When form submitted, Then confirmation email sent"
```

ينشئ القصة بمعايير قبول محددة توجه التطوير والاختبار.

### قصة مع التبعيات

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0003 TITLE="Password reset flow" OWNER=AG-API ESTIMATE=1d DEPENDENCIES=US-0001,US-0002
```

يقوم بإنشاء القصة ووضع علامة عليها على أنها تعتمد على القصص السابقة. يتم تصور هذه التبعيات في `/deps` يأمر.

### القصة مع وضع TDD

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0004 TITLE="User login" OWNER=AG-API AC="Given user on login page, When valid credentials entered, Then dashboard shown"
```

بالنسبة لأصحاب الأكواد مثل AG-API، يتم تمكين وضع TDD تلقائيًا. يؤدي هذا إلى إنشاء ملف اختبار في `__tests__/US-0004.test.ts` مع الاختبارات المعلقة المستمدة من معايير القبول.

## وضع TDD

يقوم وضع TDD (التطوير القائم على الاختبار) بإنشاء بذرة اختبار خاصة بإطار العمل من معايير القبول الخاصة بك. يتم إنشاء الاختبارات **before** التنفيذ، وفقًا للمبدأ القائل بأن الاختبارات يجب أن تكون **specify** السلوك، وليس فقط التحقق منه.

### الافتراضيات الذكية

يستخدم وضع TDD الإعدادات الافتراضية الذكية بناءً على مالك القصة:

| Owner Type | TDD Default | Rationale |
|------------|-------------|-----------|
| AG-API, AG-UI, AG-DATABASE | `true` | Code-focused, tests critical |
| AG-TESTING, AG-SECURITY, AG-PERFORMANCE | `true` | Quality-focused |
| AG-DOCUMENTATION, AG-RESEARCH, AG-PRODUCT | `false` | Non-code work |
| AG-DEVOPS, AG-CI | `false` | Infrastructure, config |

يمكنك دائمًا تجاوز الإعداد الافتراضي:
- `TDD=true` - تفعيل وضع TDD
- `TDD=false` - إيقاف تشغيل وضع TDD

### هيكل الاختبار الذي تم إنشاؤه

بالنسبة إلى Jest/Vitest (TypeScript):
```typescript
describe('US-0004: User login', () => {
  // AC1: valid login shows dashboard
  describe('valid login shows dashboard', () => {
    it.skip('should dashboard shown', () => {
      // Given: user on login page
      // When: valid credentials entered
      // Then: dashboard shown
      expect(true).toBe(true); // TODO: Implement
    });
  });
});
```

### سير عمل TDD

1. **Create story with TDD** - يتم إنشاء الاختبارات من معايير القبول
2. **Clear context** - ابدأ جلسة كلود جديدة
3. **Implement to pass tests** - أخبر الوكيل: "قم بإجراء جميع الاختبارات `__tests__/US-0004.test.ts` يمر"
4. **Agent implements blindly** - دون معرفة كيفية إنشاء الاختبارات
5. **Tests validate behavior** - التنفيذ يلبي المتطلبات بشكل حقيقي

يضمن هذا الفصل أن تحدد الاختبارات السلوك حقًا بدلاً من مجرد التحقق مما تمت كتابته.

## الإخراج

يقوم الأمر بإنشاء:

1. **Story file** (`docs/06-stories/EP-XXXX/US-XXXX-<slug>.md`)
   - البيانات الوصفية للقصة (المعرف والملحمة والمالك والتقدير والحالة)
   - الوصف ومعايير القبول
   - سياق الهندسة المعمارية (يتم ملؤها أثناء التطوير)
   - استراتيجية الاختبار
   - شارة TDD (في حالة تمكين وضع TDD)

2. **Test stub** (`docs/07-testing/test-cases/US-XXXX.md`)
   - هيكل الاختبار متوافق مع معايير القبول
   - العنصر النائب لتنفيذ الاختبار
   - روابط للقصة للسياق

3. **TDD test file** (إذا تم تمكين وضع TDD)
   - الدعابة/الزيارة: `__tests__/US-XXXX.test.ts`
   - بيتيست: `tests/test_US-XXXX.py`
   - يذهب: `<package>/US-XXXX_test.go`

4. **Status tracking** (`docs/09-agents/status.json`)
   - إدخال القصة مع المالك والتقدير والحالة
   - روابط التبعية لقصص أخرى
   - مهمة ملحمية
   - علامة وضع TDD ومسار ملف الاختبار (في حالة تمكين TDD)

5. **Agent communication** (`docs/09-agents/bus/log.jsonl`)
   - تظهر رسالة المهمة القصة التي تم إنشاؤها وتعيينها

## سير العمل

1. **Create the story** - يجري `/story` مع الملحمة والمعرف والعنوان والمالك
2. **Add acceptance criteria** - يستخدم `/story-validate` لتحسين واختبار التيار المتردد
3. **Validate completeness** - يجري `/story-validate STORY=<US-ID>` قبل التطوير
4. **Develop the story** - المالك ينفذ وفق معايير القبول
5. **Run tests** - يستخدم `/verify` لتشغيل الاختبارات الآلية
6. **Request review** - تحديث الحالة إلى `in-review` عندما تكون جاهزة

## نموذج معايير القبول

استخدم تنسيق معين/متى/ثم للحصول على معايير واضحة وقابلة للاختبار:

```markdown
- **Given** a user on the registration page
  **When** they enter valid email and password
  **Then** an account is created and confirmation email sent

- **Given** they submit an invalid email
  **When** they click submit
  **Then** form shows "Invalid email" error
```

يجب أن تكون معايير القبول:
- **Specific**: الإشارة إلى الحقول والقيم الفعلية
- **Testable**: يمكن التحقق منها باختبارات آلية أو يدوية
- **Independent**: كل ​​معيار يختبر شيئًا واحدًا
- **Complete**: تغطية المسار السعيد وحالات الحافة الرئيسية

## تقديرات القصة

استخدم هذه التقديرات القياسية:

| Estimate | When to Use |
|----------|------------|
| `0.5d` | Simple CRUD, basic UI component, quick fix |
| `1d` | Standard feature with validation and basic tests |
| `1.5d` | Complex logic, multiple validations, or integration |
| `2d` | Significant refactoring or major feature component |
| `>2d` | Break into smaller stories |

## التكامل مع الأوامر الأخرى

- **After story creation**: يستخدم `/story-validate` لضمان الجاهزية
- **Before development**: يستخدم `/babysit` للمساعدة في التنفيذ التفاعلي
- **During development**: يستخدم `/verify` لتشغيل الاختبارات
- **For code review**: يستخدم `/review` للحصول على اقتراحات مدعومة بالذكاء الاصطناعي
- **For pull requests**: يستخدم `/pr` لإنشاء وصف العلاقات العامة تلقائيًا

## أفضل الممارسات

- **One story = one feature** - حافظ على تركيز القصص وقابليتها للتسليم بشكل مستقل
- **Write clear acceptance criteria** - هذه دليل التطوير والاختبار
- **Use TDD for code stories** - دع الاختبارات تحدد السلوك قبل التنفيذ
- **Clear context before implementing TDD tests** - ابدأ من جديد حتى لا "يعرف" الوكيل الاختبارات
- **Estimate realistically** - خذ بعين الاعتبار التعقيد وخبرة الفريق
- **Link dependencies explicitly** - يساعد في تخطيط العدو وتقييم المخاطر
- **Validate before development** - يستخدم `/story-validate` للقبض على القضايا في وقت مبكر

## الأوامر ذات الصلة

- [`/ملحمة`](/commands/epic) - إنشاء الملحمة الأم
- [`/التحقق من صحة القصة`](/commands/story-validate) - التحقق من اكتمال القصة قبل التطوير
- [`/ سبرينت`](/commands/sprint) - حدد القصص للتخطيط للعدو
- [`/تلقائي`](/commands/auto) - إنشاء قصص تلقائيًا من PRDs أو المواصفات
- [`/ جليسة الأطفال`](/commands/babysit) - الحصول على مساعدة تفاعلية أثناء التنفيذ
- [`/التحقق`](/commands/verify) - تشغيل الاختبارات وتحديث حالة الاختبار
- [`/الاختبارات`](/commands/tests) - إعداد البنية التحتية للاختبار لسير عمل TDD
