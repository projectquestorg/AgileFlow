---
title: "/historia"
description: Crear una historia de usuario con criterios de aceptación.
---

# /historia

Cree una nueva historia de usuario con criterios de aceptación, resguardos de prueba y seguimiento de estado.

## Inicio rápido

```bash
/agileflow:story EPIC=<EP-ID> STORY=<US-ID> TITLE=<text> OWNER=<id>
```

## Parámetros

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `EPIC` | Yes | - | Parent epic ID (e.g., EP-0001) |
| `STORY` | Yes | - | Story identifier (e.g., US-0001) |
| `TITLE` | Yes | - | Story title describing the feature |
| `OWNER` | Yes | - | Owner name or agent ID (e.g., AG-UI, AG-API) |
| `ESTIMATE` | No | `0.5d` | Time estimate (e.g., `0.5d`, `1d`, `2d`) |
| `AC` | No | - | Acceptance criteria in Given/When/Then format |
| `DEPENDENCIES` | No | - | Comma-separated list of dependent story IDs (e.g., `US-0001,US-0002`) |
| `TDD` | No | Smart default | Enable TDD mode to generate test stubs from acceptance criteria |

## Ejemplos

### Creación básica de historias

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0001 TITLE="User registration form" OWNER=AG-UI
```

Crea un archivo de historia en `docs/06-stories/EP-0010/US-0001-user-registration-form.md` con estimación predeterminada (0,5d) y estado (listo).

### Historia con criterios de aceptación

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0002 TITLE="Validate email address" OWNER=AG-API ESTIMATE=1d AC="Given a valid email, When form submitted, Then confirmation email sent"
```

Crea la historia con criterios de aceptación específicos que guían el desarrollo y las pruebas.

### Historia con dependencias

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0003 TITLE="Password reset flow" OWNER=AG-API ESTIMATE=1d DEPENDENCIES=US-0001,US-0002
```

Crea la historia y la marca como dependiente de historias anteriores. Estas dependencias se visualizan en `/deps` dominio.

### Historia con modo TDD

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0004 TITLE="User login" OWNER=AG-API AC="Given user on login page, When valid credentials entered, Then dashboard shown"
```

Para propietarios de códigos como AG-API, el modo TDD se habilita automáticamente. Esto genera un archivo de prueba en `__tests__/US-0004.test.ts` con pruebas pendientes derivadas de los criterios de aceptación.

## Modo TDD

El modo TDD (Desarrollo basado en pruebas) genera resguardos de prueba específicos del marco a partir de sus criterios de aceptación. Se crean pruebas **before** implementación, siguiendo el principio de que las pruebas deben **specify** comportamiento, no sólo verificarlo.

### Valores predeterminados inteligentes

El modo TDD utiliza valores predeterminados inteligentes según el propietario de la historia:

| Owner Type | TDD Default | Rationale |
|------------|-------------|-----------|
| AG-API, AG-UI, AG-DATABASE | `true` | Code-focused, tests critical |
| AG-TESTING, AG-SECURITY, AG-PERFORMANCE | `true` | Quality-focused |
| AG-DOCUMENTATION, AG-RESEARCH, AG-PRODUCT | `false` | Non-code work |
| AG-DEVOPS, AG-CI | `false` | Infrastructure, config |

Siempre puedes anular el valor predeterminado:
- `TDD=true` - Forzar el modo TDD activado
- `TDD=false` - Forzar el modo TDD desactivado

### Estructura de prueba generada

Para Jest/Vitest (Mecanografiado):
```typescript
describe('US-0004: User login', () => {
  // AC1: valid login shows dashboard
  describe('valid login shows dashboard', () => {
    it.skip('should dashboard shown', () => {
      // Given: user on login page
      // When: valid credentials entered
      // Then: dashboard shown
      expect(true).toBe(true); // TODO: Implement
    });
  });
});
```

### Flujo de trabajo TDD

1. **Create story with TDD** - Las pruebas se generan a partir de criterios de aceptación.
2. **Clear context** - Iniciar una nueva sesión de Claude
3. **Implement to pass tests** - Dígale al agente: "Haga todas las pruebas en `__tests__/US-0004.test.ts` aprobar"
4. **Agent implements blindly** - Sin saber cómo se generaron las pruebas.
5. **Tests validate behavior** - La implementación realmente satisface los requisitos.

Esta separación garantiza que las pruebas realmente especifiquen el comportamiento en lugar de simplemente verificar lo que se escribió.

## Producción

El comando crea:

1. **Story file** (`docs/06-stories/EP-XXXX/US-XXXX-<slug>.md`)
   - Metadatos de la historia (ID, épica, propietario, estimación, estado)
   - Descripción y criterios de aceptación.
   - Contexto arquitectónico (completado durante el desarrollo)
   - Estrategia de prueba
   - Insignia TDD (si el modo TDD está habilitado)

2. **Test stub** (`docs/07-testing/test-cases/US-XXXX.md`)
   - Estructura de prueba alineada con los criterios de aceptación.
   - Marcador de posición para la implementación de pruebas
   - Enlaces a la historia para contexto.

3. **TDD test file** (si el modo TDD está habilitado)
   - Broma/Vitest: `__tests__/US-XXXX.test.ts`
   - pytest: `tests/test_US-XXXX.py`
   - Ir: `<package>/US-XXXX_test.go`

4. **Status tracking** (`docs/09-agents/status.json`)
   - Entrada de historia con propietario, estimación y estado
   - Enlaces de dependencia a otras historias.
   - tarea épica
   - Indicador de modo TDD y ruta del archivo de prueba (si TDD está habilitado)

5. **Agent communication** (`docs/09-agents/bus/log.jsonl`)
   - Mensaje de tarea que muestra la historia creada y asignada

## Flujo de trabajo

1. **Create the story** - Correr `/story` con épica, identificación, título y propietario
2. **Add acceptance criteria** - Usar `/story-validate` para refinar y probar AC
3. **Validate completeness** - Correr `/story-validate STORY=<US-ID>` antes del desarrollo
4. **Develop the story** - El propietario implementa según criterios de aceptación.
5. **Run tests** - Usar `/verify` para ejecutar pruebas automatizadas
6. **Request review** - Actualizar estado a `in-review` cuando esté listo

## Formato de criterios de aceptación

Utilice el formato Dado/Cuándo/Entonces para obtener criterios claros y comprobables:

```markdown
- **Given** a user on the registration page
  **When** they enter valid email and password
  **Then** an account is created and confirmation email sent

- **Given** they submit an invalid email
  **When** they click submit
  **Then** form shows "Invalid email" error
```

Los criterios de aceptación deben ser:
- **Specific**: Referencia a campos y valores reales
- **Testable**: Se puede verificar con pruebas automáticas o manuales.
- **Independent**: Cada criterio prueba una cosa
- **Complete**: Cubra el camino feliz y los principales casos extremos

## Estimaciones de historias

Utilice estas estimaciones estándar:

| Estimate | When to Use |
|----------|------------|
| `0.5d` | Simple CRUD, basic UI component, quick fix |
| `1d` | Standard feature with validation and basic tests |
| `1.5d` | Complex logic, multiple validations, or integration |
| `2d` | Significant refactoring or major feature component |
| `>2d` | Break into smaller stories |

## Integración con otros comandos

- **After story creation**: Usar `/story-validate` para garantizar la preparación
- **Before development**: Usar `/babysit` para ayuda de implementación interactiva
- **During development**: Usar `/verify` para ejecutar pruebas
- **For code review**: Usar `/review` para sugerencias impulsadas por IA
- **For pull requests**: Usar `/pr` para generar automáticamente la descripción de relaciones públicas

## Mejores prácticas

- **One story = one feature** - Mantenga las historias enfocadas y entregables de forma independiente
- **Write clear acceptance criteria** - Estas guían el desarrollo y las pruebas.
- **Use TDD for code stories** - Permitir que las pruebas especifiquen el comportamiento antes de la implementación.
- **Clear context before implementing TDD tests** - Comience de nuevo para que el agente no "conozca" las pruebas
- **Estimate realistically** - Considere la complejidad y la experiencia del equipo.
- **Link dependencies explicitly** - Ayuda con la planificación de sprints y la evaluación de riesgos.
- **Validate before development** - Usar `/story-validate` para detectar problemas temprano

## Comandos relacionados

- [`/épico`](/commands/epic) - Crear la epopeya principal.
- [`/validar historia`](/commands/story-validate) - Validar la integridad de la historia antes del desarrollo.
- [`/correr`](/commands/sprint) - Seleccionar historias para la planificación de sprint
- [`/automático`](/commands/auto) - Generar automáticamente historias a partir de PRD o especificaciones.
- [`/cuidar`](/commands/babysit) - Obtenga ayuda interactiva durante la implementación
- [`/verificar`](/commands/verify) - Ejecutar pruebas y actualizar el estado de las pruebas.
- [`/pruebas`](/commands/tests) - Configurar la infraestructura de prueba para el flujo de trabajo TDD
