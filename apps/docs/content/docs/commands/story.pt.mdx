---
title: "/história"
description: Crie uma história de usuário com critérios de aceitação
---

# /história

Crie uma nova história de usuário com critérios de aceitação, stubs de teste e rastreamento de status.

## Início rápido

```bash
/agileflow:story EPIC=<EP-ID> STORY=<US-ID> TITLE=<text> OWNER=<id>
```

## Parâmetros

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `EPIC` | Yes | - | Parent epic ID (e.g., EP-0001) |
| `STORY` | Yes | - | Story identifier (e.g., US-0001) |
| `TITLE` | Yes | - | Story title describing the feature |
| `OWNER` | Yes | - | Owner name or agent ID (e.g., AG-UI, AG-API) |
| `ESTIMATE` | No | `0.5d` | Time estimate (e.g., `0.5d`, `1d`, `2d`) |
| `AC` | No | - | Acceptance criteria in Given/When/Then format |
| `DEPENDENCIES` | No | - | Comma-separated list of dependent story IDs (e.g., `US-0001,US-0002`) |
| `TDD` | No | Smart default | Enable TDD mode to generate test stubs from acceptance criteria |

## Exemplos

### Criação Básica de História

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0001 TITLE="User registration form" OWNER=AG-UI
```

Cria um arquivo de história em `docs/06-stories/EP-0010/US-0001-user-registration-form.md` com estimativa padrão (0,5d) e status (pronto).

### História com critérios de aceitação

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0002 TITLE="Validate email address" OWNER=AG-API ESTIMATE=1d AC="Given a valid email, When form submitted, Then confirmation email sent"
```

Cria a história com critérios de aceitação específicos que orientam o desenvolvimento e os testes.

### História com Dependências

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0003 TITLE="Password reset flow" OWNER=AG-API ESTIMATE=1d DEPENDENCIES=US-0001,US-0002
```

Cria a história e a marca como dependente de histórias anteriores. Essas dependências são visualizadas em `/deps` comando.

### História com modo TDD

```bash
/agileflow:story EPIC=EP-0010 STORY=US-0004 TITLE="User login" OWNER=AG-API AC="Given user on login page, When valid credentials entered, Then dashboard shown"
```

Para proprietários de código como AG-API, o modo TDD é ativado automaticamente. Isso gera um arquivo de teste em `__tests__/US-0004.test.ts` com testes pendentes derivados dos critérios de aceitação.

## Modo TDD

O modo TDD (Test-Driven Development) gera stubs de teste específicos da estrutura a partir de seus critérios de aceitação. Testes são criados **before** implementação, seguindo o princípio de que os testes devem **specify** comportamento, e não apenas verificá-lo.

### Padrões inteligentes

O modo TDD usa padrões inteligentes baseados no proprietário da história:

| Owner Type | TDD Default | Rationale |
|------------|-------------|-----------|
| AG-API, AG-UI, AG-DATABASE | `true` | Code-focused, tests critical |
| AG-TESTING, AG-SECURITY, AG-PERFORMANCE | `true` | Quality-focused |
| AG-DOCUMENTATION, AG-RESEARCH, AG-PRODUCT | `false` | Non-code work |
| AG-DEVOPS, AG-CI | `false` | Infrastructure, config |

Você sempre pode substituir o padrão:
- `TDD=true` - Forçar o modo TDD ativado
- `TDD=false` - Forçar o modo TDD desativado

### Estrutura de teste gerada

Para Jest/Vitest (TypeScript):
```typescript
describe('US-0004: User login', () => {
  // AC1: valid login shows dashboard
  describe('valid login shows dashboard', () => {
    it.skip('should dashboard shown', () => {
      // Given: user on login page
      // When: valid credentials entered
      // Then: dashboard shown
      expect(true).toBe(true); // TODO: Implement
    });
  });
});
```

### Fluxo de trabalho TDD

1. **Create story with TDD** - Os testes são gerados a partir de critérios de aceitação
2. **Clear context** - Comece uma nova sessão de Claude
3. **Implement to pass tests** - Diga ao agente: "Faça todos os testes em `__tests__/US-0004.test.ts` passar"
4. **Agent implements blindly** - Sem saber como os testes foram gerados
5. **Tests validate behavior** - A implementação satisfaz genuinamente os requisitos

Essa separação garante que os testes realmente especifiquem o comportamento, em vez de apenas verificar o que foi escrito.

## Saída

O comando cria:

1. **Story file** (`docs/06-stories/EP-XXXX/US-XXXX-<slug>.md`)
   - Metadados da história (ID, épico, proprietário, estimativa, status)
   - Descrição e critérios de aceitação
   - Contexto da arquitetura (preenchido durante o desenvolvimento)
   - Estratégia de teste
   - Emblema TDD (se o modo TDD estiver ativado)

2. **Test stub** (`docs/07-testing/test-cases/US-XXXX.md`)
   - Estrutura de teste alinhada aos critérios de aceitação
   - Espaço reservado para implementação de teste
   - Links para a história para contexto

3. **TDD test file** (se o modo TDD estiver ativado)
   - Brincadeira/Viteste: `__tests__/US-XXXX.test.ts`
   - teste de py: `tests/test_US-XXXX.py`
   - Ir: `<package>/US-XXXX_test.go`

4. **Status tracking** (`docs/09-agents/status.json`)
   - Entrada de história com proprietário, estimativa e status
   - Links de dependência para outras histórias
   - Tarefa épica
   - Sinalizador do modo TDD e caminho do arquivo de teste (se o TDD estiver habilitado)

5. **Agent communication** (`docs/09-agents/bus/log.jsonl`)
   - Mensagem de atribuição mostrando a história criada e atribuída

## Fluxo de trabalho

1. **Create the story** - Correr `/story` com épico, ID, título e proprietário
2. **Add acceptance criteria** - Usar `/story-validate` para refinar e testar AC
3. **Validate completeness** - Correr `/story-validate STORY=<US-ID>` antes do desenvolvimento
4. **Develop the story** - Implementos do proprietário de acordo com critérios de aceitação
5. **Run tests** - Usar `/verify` para executar testes automatizados
6. **Request review** - Atualizar status para `in-review` quando estiver pronto

## Formato dos Critérios de Aceitação

Use o formato Dado/Quando/Então para critérios claros e testáveis:

```markdown
- **Given** a user on the registration page
  **When** they enter valid email and password
  **Then** an account is created and confirmation email sent

- **Given** they submit an invalid email
  **When** they click submit
  **Then** form shows "Invalid email" error
```

Os critérios de aceitação devem ser:
- **Specific**: Referência a campos e valores reais
- **Testable**: Pode ser verificado com testes automatizados ou manuais
- **Independent**: Cada critério testa uma coisa
- **Complete**: Cubra o caminho feliz e os principais casos extremos

## Estimativas de história

Use estas estimativas padrão:

| Estimate | When to Use |
|----------|------------|
| `0.5d` | Simple CRUD, basic UI component, quick fix |
| `1d` | Standard feature with validation and basic tests |
| `1.5d` | Complex logic, multiple validations, or integration |
| `2d` | Significant refactoring or major feature component |
| `>2d` | Break into smaller stories |

## Integração com outros comandos

- **After story creation**: Usar `/story-validate` para garantir a prontidão
- **Before development**: Usar `/babysit` para ajuda de implementação interativa
- **During development**: Usar `/verify` para executar testes
- **For code review**: Usar `/review` para sugestões baseadas em IA
- **For pull requests**: Usar `/pr` para gerar automaticamente a descrição do PR

## Melhores Práticas

- **One story = one feature** - Mantenha as histórias focadas e entregues de forma independente
- **Write clear acceptance criteria** - Estes orientam o desenvolvimento e os testes
- **Use TDD for code stories** - Deixe os testes especificarem o comportamento antes da implementação
- **Clear context before implementing TDD tests** - Comece do zero para que o agente não "conheça" os testes
- **Estimate realistically** - Considere a complexidade e a experiência da equipe
- **Link dependencies explicitly** - Ajuda no planejamento de sprint e avaliação de riscos
- **Validate before development** - Usar `/story-validate` para detectar problemas antecipadamente

## Comandos Relacionados

- [`/épico`](/commands/epic) - Crie o épico pai
- [`/validar história`](/commands/story-validate) - Validar a integridade da história antes do desenvolvimento
- [`/sprint`](/commands/sprint) - Selecione histórias para planejamento de sprint
- [`/auto`](/commands/auto) - Gere histórias automaticamente a partir de PRDs ou especificações
- [`/babá`](/commands/babysit) - Obtenha ajuda interativa durante a implementação
- [`/verificar`](/commands/verify) - Execute testes e atualize o status do teste
- [`/testes`](/commands/tests) - Configurar infraestrutura de teste para fluxo de trabalho TDD
