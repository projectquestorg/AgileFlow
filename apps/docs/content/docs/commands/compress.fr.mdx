---
title: /compresse
description: Compressez status.json en supprimant les champs d√©taill√©s et en ne conservant que les m√©tadonn√©es de suivi
---

# /compresse

R√©duisez la taille du fichier status.json en supprimant les champs d'histoire d√©taill√©s tout en pr√©servant toutes les m√©tadonn√©es de suivi critiques et en conservant les d√©tails complets de l'histoire dans les fichiers markdown.

## D√©marrage rapide

```bash
/agileflow:compress
```

## But

Cette commande r√©sout un probl√®me courant¬†: lorsque `status.json` grandit (en particulier sur les grands projets comportant plus de 100¬†histoires), il peut d√©passer les limites de jetons et ralentir le traitement des agents. La commande compresser¬†:
- Supprime les champs verbeux (descriptions, AC, contexte d'architecture, etc.)
- Ne conserve que les m√©tadonn√©es de suivi essentielles (ID de l'histoire, statut, propri√©taire, horodatages)
- R√©duit g√©n√©ralement la taille du fichier de 80 √† 90¬†%
- Pr√©serve le contenu complet de l'histoire dans les fichiers markdown
- Conserve l‚Äôhistorique complet du projet
- Garantit que les agents peuvent lire efficacement status.json

## Param√®tres

Cette commande n'a pas de param√®tres - elle op√®re directement sur `docs/09-agents/status.json`.

## Usage

Ex√©cutez simplement¬†:

```bash
/agileflow:compress
```

La commande va¬†:
1. Valider status.json existe et est un JSON valide
2. Afficher avant les statistiques (taille, lignes, nombre d'histoires)
3. Cr√©er une sauvegarde automatique
4. Supprimer les champs verbeux
5. √âcrire une version compress√©e
6. Afficher apr√®s les statistiques et les √©conomies

## Ce qui est supprim√©

Ces champs d√©taill√©s sont supprim√©s de status.json¬†:

```text
- description          # Story description and context
- acceptanceCriteria   # AC bullet points
- architectureContext  # Architecture details
- technicalNotes       # Implementation hints
- testingStrategy      # Test approach
- devAgentRecord       # Implementation notes
- previousStoryInsights # Lessons from previous story
- (all other large text fields)
```

Ceux-ci sont conserv√©s en toute s√©curit√© dans `docs/06-stories/` fichiers de d√©marque √† la place.

## Ce qui est conserv√©

Only essential tracking metadata remains in status.json:

```text
- story_id            # Story identifier
- epic                # Parent epic
- title               # Story title
- owner               # Assigned agent
- status              # Current status (ready/in-progress/blocked/done)
- estimate            # Time estimate
- created             # Creation timestamp
- updated             # Last update timestamp
- completed_at        # Completion timestamp
- dependencies        # Dependent story IDs
- branch              # Git branch name
- summary             # Short summary
- last_update         # Last modification message
- assigned_at         # Assignment timestamp
```

## Exemple de sortie

```text
üóúÔ∏è  AgileFlow Status Compression
   Purpose: Strip verbose fields from status.json
   Target: Keep only essential tracking metadata

üíæ Backup created: docs/09-agents/status.json.backup

üìä Before Compression:
   Stories: 145
   Size: 384KB
   Lines: 12,847

‚úÖ Compression complete!

üìä After Compression:
   Stories: 145 (unchanged)
   Size: 384KB ‚Üí 42KB
   Lines: 12,847 ‚Üí 1,203
   Saved: 89% (342KB)

‚úÖ Estimated tokens: ~10,500 (safely under 25000 limit)

üìã Status Summary:
   ready: 23 stories
   in-progress: 8 stories
   blocked: 2 stories
   done: 112 stories

üíæ To restore original: cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

## Quand utiliser

### Utilisez la compression lorsque¬†:

1. **status.json exceeds 25,000 tokens**
   - Les agents √©chouent avec ¬´¬†le contenu du fichier d√©passe le nombre maximal de jetons autoris√©s¬†¬ª

2. **File is slow to process**
   - Trop grand pour les fen√™tres contextuelles
   - Provoque des probl√®mes de d√©lai d'attente

3. **After major epic completion**
   - De nombreuses histoires termin√©es avec des enregistrements d√©taill√©s
   - Le projet s'est consid√©rablement d√©velopp√©

4. **Quarterly maintenance**
   - Nettoyage r√©gulier pour continuer √† suivre le Lean

### Alternative¬†: combiner avec Archivage

Pour des r√©sultats encore meilleurs, combinez compression et archivage¬†:

```bash
# Step 1: Archive completed stories older than 3 days
bash .agileflow/scripts/archive-completed-stories.sh 3

# Step 2: Compress remaining stories
/agileflow:compress
```

Ce processus en deux √©tapes permet d'obtenir une r√©duction maximale tout en conservant l'historique.

## S√©curit√© et sauvegardes

### Sauvegarde automatique

Avant la compression, la commande cr√©e une sauvegarde¬†:
```text
docs/09-agents/status.json.backup
```

### Aucune perte de donn√©es

- Le contenu complet de l'histoire reste dans `docs/06-stories/` fichiers de d√©marques
- Les fichiers de d√©marques d'histoire ne sont PAS modifi√©s
- Seul l'index status.json est compress√©
- Peut toujours restaurer √† partir d'une sauvegarde

### Restaurer si n√©cessaire

```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

La sauvegarde contient le fichier original complet.

## Pourquoi cette architecture ?

### S√©paration des pr√©occupations

**status.json** = indice de suivi l√©ger
- ¬´ Quelles histoires existent ?
- ¬´ √Ä qui appartient chaque histoire ?
- ¬´ Quelle est la situation actuelle ?
- ¬´ Quand a-t-il √©t√© mis √† jour ?

**docs/06-stories/** = contenu de l'histoire compl√®te
- Descriptions compl√®tes
- Crit√®res d'acceptation
- D√©cisions architecturales
- Notes de mise en ≈ìuvre
- Strat√©gies de test

**docs/09-agents/archive/** = donn√©es historiques
- Histoires termin√©es plus anciennes que le seuil
- Organisation mensuelle
- Capacit√© de r√©cup√©ration compl√®te

### Avantages

1. **Fast Indexing** - Les agents lisent rapidement status.json
2. **Complete Content** - Tous les d√©tails dans la d√©marque de l'histoire
3. **Searchable** - Peut r√©cup√©rer des fichiers d'histoire pour le contenu
4. **Versionable** - Tous les fichiers sont suivis par git
5. **Archivable** - Les vieilles histoires ne gonflent pas l'index de suivi

## Estimation des jetons

La commande estime l'utilisation du jeton¬†:

```text
Token estimation formula: tokens ‚âà bytes / 4

Before: 384KB √ó 1024 bytes/KB √∑ 4 = 98,304 tokens
After: 42KB √ó 1024 bytes/KB √∑ 4 = 10,752 tokens

Saved: 87,552 tokens!
```

Cible¬†: conserver status.json sous 25¬†000 jetons (100 Ko compress√©s).

## Int√©gration du flux de travail

### Avec Agent Bus

La compression status.json n'affecte pas¬†:
- Bus de messages d'agent (`docs/09-agents/bus/log.jsonl`)
- Communication et coordination des agents
- Suivi du statut de l'histoire

### Avec CI/CD

La compression peut √™tre ajout√©e √† l'automatisation CI¬†:

```yaml
name: Maintenance
on:
  schedule:
    - cron: '0 2 * * 0'  # Sunday 2am UTC

jobs:
  compress:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Archive and compress
        run: |
          bash .agileflow/scripts/archive-completed-stories.sh 3
          /agileflow:compress
      - name: Commit if changed
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add docs/09-agents/
          git diff --quiet && git diff --staged --quiet || \
          git commit -m "chore(maintenance): archive and compress status"
          git push
```

## Common Scenarios

### Sc√©nario 1¬†:¬†Le projet prend de l'ampleur

**Problem**: status.json fait 250 Ko avec 150 histoires
**Solution**:
```bash
/agileflow:compress
```
**Result**: R√©duit √† 30 Ko, facilement sous les limites des jetons

### Sc√©nario 2¬†:¬†De nombreuses histoires termin√©es

**Problem**: 120 termin√©s, 30 histoires actives ; status.json gonfl√©
**Solution**:
```bash
# Archive stories completed >7 days ago
bash .agileflow/scripts/archive-completed-stories.sh 7

# Then compress
/agileflow:compress
```
**Result**: D√©place les anciennes histoires vers l'archive, compresse le reste

### Sc√©nario 3¬†:¬†entretien r√©gulier

**Problem**: Vous voulez que status.json reste automatiquement optimis√©
**Solution**: Ajouter au planning CI (compression mensuelle)
**Result**: Toujours dans les limites des jetons, traitement rapide des agents

## D√©pannage

### "status.json toujours trop volumineux apr√®s compression"

Essayez un archivage plus agressif¬†:
```bash
# Archive stories >3 days old instead of default 7
bash .agileflow/scripts/archive-completed-stories.sh 3

/agileflow:compress
```

### "Informations critiques perdues apr√®s compression"

Restaurer √† partir d'une sauvegarde¬†:
```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

V√©rifiez si les fichiers de d√©marques d'histoire contiennent les d√©tails `docs/06-stories/`.

### "Can't find story details"

Le contenu de l'histoire est dans des fichiers markdown¬†:
```bash
find docs/06-stories/ -name "US-*.md" | xargs grep "your search term"
```

## Meilleures pratiques

1. **Regular Compression** - Ex√©cuter mensuellement ou trimestriellement
2. **Archive Aggressively** - D√©placez d'abord les anciennes histoires termin√©es
3. **Back Up Before** - La compression cr√©e automatiquement une sauvegarde
4. **Verify After** - Check token estimate in output
5. **Commit Changes** - Ajouter le statut compress√© √† git
6. **Document Policy** - Enregistrer quand/pourquoi la compression s'ex√©cute
7. **Test Restoration** - V√©rifier que la sauvegarde fonctionne si n√©cessaire

## Commandes associ√©es

- [`/agileflow:statut`](/commands/status) - Afficher les statuts actuels de l'histoire
- [`/agileflow:valider`](/commands/validate) - V√©rifier la sant√© du syst√®me AgileFlow
- Script d'archivage¬†: `bash .agileflow/scripts/archive-completed-stories.sh` - D√©placer les histoires termin√©es vers les archives

## D√©tails techniques

### Fichiers impliqu√©s

| File | Purpose |
|------|---------|
| `docs/09-agents/status.json` | Lightweight tracking index (compressed) |
| `docs/09-agents/status.json.backup` | Automatic backup before compression |
| `docs/06-stories/` | Full story markdown files (unchanged) |
| `docs/09-agents/archive/YYYY-MM.json` | Historical completed stories |

### Implementation

Le script de compression utilise `jq` pour le traitement JSON¬†:

```bash
# Extract only essential fields for each story
jq '[.[] | {story_id, epic, title, owner, status, estimate, created, updated, completed_at, dependencies, branch, summary, last_update, assigned_at}]' status.json > status-compressed.json
```

### Token Calculation

Estimation approximative utilis√©e dans le r√©sultat¬†:
- 1 jeton ‚âà 4 caract√®res/octets (approximatif)
- Fichier de 100 Ko ‚âà 25 000 jetons
- Cible¬†:¬†\<¬†100 Ko pour rester bien en dessous des limites

## FAQ

<Accordion type="multiple">
  <AccordionItem value="delete">
    <AccordionTrigger>Does compression delete story files?</AccordionTrigger>
    <AccordionContent>
      Non, seul status.json est modifi√©. La d√©marque de l'histoire dans docs/06-stories/ n'est pas modifi√©e.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="undo">
    <AccordionTrigger>Can I undo compression?</AccordionTrigger>
    <AccordionContent>
      Oui. Une sauvegarde est cr√©√©e automatiquement. Restaurez simplement¬†: `cp docs/09-agents/status.json.backup docs/09-agents/status.json`
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="when">
    <AccordionTrigger>When should I compress?</AccordionTrigger>
    <AccordionContent>
      Lorsque status.json d√©passe 25 Ko, ou mensuellement √† titre de maintenance. Combinez avec l'archivage pour de meilleurs r√©sultats.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="performance">
    <AccordionTrigger>Does this affect agent performance?</AccordionTrigger>
    <AccordionContent>
      Oui, cela l'am√©liore consid√©rablement. Status.json plus petit = lectures plus rapides, contexte plus disponible pour les agents.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="git">
    <AccordionTrigger>What about git history?</AccordionTrigger>
    <AccordionContent>
      Toutes les modifications sont valid√©es. Les versions pr√©c√©dentes sont dans l'historique de git si n√©cessaire.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="customize">
    <AccordionTrigger>Can I customize which fields to keep?</AccordionTrigger>
    <AccordionContent>
      Oui, modifiez le script de compression pour conserver des champs suppl√©mentaires si n√©cessaire pour votre flux de travail.
    </AccordionContent>
  </AccordionItem>
</Accordion>
