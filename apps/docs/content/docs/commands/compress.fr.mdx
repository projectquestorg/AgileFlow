---
title: /compresse
description: Compressez status.json en supprimant les champs dÃ©taillÃ©s et en ne conservant que les mÃ©tadonnÃ©es de suivi
---
# /compresser

RÃ©duisez la taille du fichier status.json en supprimant les champs d'histoire dÃ©taillÃ©s tout en prÃ©servant toutes les mÃ©tadonnÃ©es de suivi critiques et en conservant les dÃ©tails complets de l'histoire dans les fichiers markdown.

## DÃ©marrage rapide

```bash
/agileflow:compress
```

## Objectif

Cette commande rÃ©sout un problÃ¨me courantÂ : lorsque `status.json` devient volumineux (en particulier sur les grands projets comportant plus de 100Â histoires), il peut dÃ©passer les limites de jetons et ralentir le traitement des agents. La commande compresserÂ :
- Supprime les champs verbeux (descriptions, AC, contexte d'architecture, etc.)
- Ne conserve que les mÃ©tadonnÃ©es de suivi essentielles (ID de l'histoire, statut, propriÃ©taire, horodatages)
- RÃ©duit gÃ©nÃ©ralement la taille du fichier de 80 Ã  90 %
- PrÃ©serve le contenu complet de l'histoire dans les fichiers markdown
- Maintient l'historique complet du projet
- Garantit que les agents peuvent lire efficacement status.json

## ParamÃ¨tres

Cette commande n'a aucun paramÃ¨tre - elle opÃ¨re directement sur `docs/09-agents/status.json`.

## Utilisation

ExÃ©cutez simplementÂ :

```bash
/agileflow:compress
```

La commande vaÂ :
1. Validez status.json existe et est un JSON valide
2. Afficher avant les statistiques (taille, lignes, cou d'histoire)tn)
3. CrÃ©ez une sauvegarde automatique
4. Supprimez les champs verbeux
5. Ã‰crivez une version compressÃ©e
6. Afficher aprÃ¨s les statistiques et les Ã©conomies

## Ce qui est supprimÃ©

Ces champs dÃ©taillÃ©s sont supprimÃ©s de status.jsonÂ :

```text
- description          # Story description and context
- acceptanceCriteria   # AC bullet points
- architectureContext  # Architecture details
- technicalNotes       # Implementation hints
- testingStrategy      # Test approach
- devAgentRecord       # Implementation notes
- previousStoryInsights # Lessons from previous story
- (all other large text fields)
```

Ceux-ci sont conservÃ©s en toute sÃ©curitÃ© dans les fichiers de dÃ©marque `docs/06-stories/`.

## Ce qui est conservÃ©

Seules les mÃ©tadonnÃ©es de suivi essentielles restent dans status.jsonÂ :

```text
- story_id            # Story identifier
- epic                # Parent epic
- title               # Story title
- owner               # Assigned agent
- status              # Current status (ready/in-progress/blocked/done)
- estimate            # Time estimate
- created             # Creation timestamp
- updated             # Last update timestamp
- completed_at        # Completion timestamp
- dependencies        # Dependent story IDs
- branch              # Git branch name
- summary             # Short summary
- last_update         # Last modification message
- assigned_at         # Assignment timestamp
```

## Exemple de sortie

```text
ğŸ—œï¸  AgileFlow Status Compression
   Purpose: Strip verbose fields from status.json
   Target: Keep only essential tracking metadata

ğŸ’¾ Backup created: docs/09-agents/status.json.backup

ğŸ“Š Before Compression:
   Stories: 145
   Size: 384KB
   Lines: 12,847

âœ… Compression complete!

ğŸ“Š After Compression:
   Stories: 145 (unchanged)
   Size: 384KB â†’ 42KB
   Lines: 12,847 â†’ 1,203
   Saved: 89% (342KB)

âœ… Estimated tokens: ~10,500 (safely under 25000 limit)

ğŸ“‹ Status Summary:
   ready: 23 stories
   in-progress: 8 stories
   blocked: 2 stories
   done: 112 stories

ğŸ’¾ To restore original: cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

## Quand l'utiliser

### Utilisez la compression lorsqueÂ :

1. **status.json dÃ©passe 25Â 000 jetons**
   - Les agents Ã©chouent avec "le contenu du fichier dÃ©passe le nombre maximum de jetons autorisÃ©s"

2. **Le traitement du fichier est lent**
   - Trop grand pour les fenÃªtres contextuelles
   - Provoque des problÃ¨mes de dÃ©lai d'attente

3. **AprÃ¨s l'achÃ¨vement Ã©pique majeur**
   - De nombreuses histoires terminÃ©es avec des enregistrements dÃ©taillÃ©s
   - Le projet s'est considÃ©rablement dÃ©veloppÃ©

4. **Entretien trimestriel**
   - Nettoyage rÃ©gulier pour continuer Ã  suivre le Lean

### AlternativeÂ : combiner avec Archivage

Pour des rÃ©sultats encore meilleurs, combinez compression et archivageÂ :

```bash
# Step 1: Archive completed stories older than 3 days
bash .agileflow/scripts/archive-completed-stories.sh 3

# Step 2: Compress remaining stories
/agileflow:compress
```

Ce processus en deux Ã©tapesss atteint une rÃ©duction maximale tout en conservant l'historique.

## SÃ©curitÃ© et sauvegardes

### Sauvegarde automatique

Avant la compression, la commande crÃ©e une sauvegardeÂ :
```text
docs/09-agents/status.json.backup
```

### Aucune perte de donnÃ©es

- Le contenu complet de l'histoire reste dans les fichiers de dÃ©marque `docs/06-stories/`
- Les fichiers de dÃ©marques d'histoire ne sont PAS modifiÃ©s
- Seul l'index status.json est compressÃ©
- Peut toujours restaurer Ã  partir d'une sauvegarde

### Restaurer si nÃ©cessaire

```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

La sauvegarde contient le fichier original complet.

## Pourquoi cette architecture ?

### SÃ©paration des prÃ©occupations

**status.json** = index de suivi lÃ©ger
- "Quelles histoires existent ?"
- "Ã€ qui appartient chaque histoire ?"
- "Quelle est la situation actuelle ?"
- "Quand a-t-il Ã©tÃ© mis Ã  jourÂ ?"

**docs/06-stories/** = contenu complet de l'histoire
-Descriptions complÃ¨tes
- CritÃ¨res d'acceptation
- DÃ©cisions architecturales
- Notes d'implÃ©mentation
- StratÃ©gies de tests

**docs/09-agents/archive/** = donnÃ©es historiques
- Histoires terminÃ©es plus anciennes que le seuil
- Organisation mensuelle
- CapacitÃ© de rÃ©cupÃ©ration complÃ¨te

### Avantages

1. **Indexation rapide** - Agentlisez rapidement status.json
2. **Contenu complet** - Tous les dÃ©tails dans la dÃ©marque de l'histoire
3. **Recherchable** - Peut rÃ©cupÃ©rer des fichiers d'histoire pour le contenu
4. ** Versionnable ** - Tous les fichiers sont suivis par git
5. **Archivable** - Les anciennes histoires ne gonflent pas l'index de suivi

## Token Estimation

La commande estime l'utilisation du jetonÂ :

```text
Token estimation formula: tokens â‰ˆ bytes / 4

Before: 384KB Ã— 1024 bytes/KB Ã· 4 = 98,304 tokens
After: 42KB Ã— 1024 bytes/KB Ã· 4 = 10,752 tokens

Saved: 87,552 tokens!
```

CibleÂ : conserver status.json sous 25Â 000 jetons (100 Ko compressÃ©s).

## IntÃ©gration du flux de travail

### With Agent Bus

La compression status.json n'affecte pasÂ :
- Bus de messages d'agent (`docs/09-agents/bus/log.jsonl`)
- Communication et coordination des agents
- Story status tracking

### With CI/CD

La compression peut Ãªtre ajoutÃ©e Ã  l'automatisation CIÂ :

```yaml
name: Maintenance
on:
  schedule:
    - cron: '0 2 * * 0'  # Sunday 2am UTC

jobs:
  compress:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Archive and compress
        run: |
          bash .agileflow/scripts/archive-completed-stories.sh 3
          /agileflow:compress
      - name: Commit if changed
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add docs/09-agents/
          git diff --quiet && git diff --staged --quiet || \
          git commit -m "chore(maintenance): archive and compress status"
          git push
```

## ScÃ©narios courants

### ScÃ©narioÂ 1Â :Â Le projet prend de l'ampleur

**ProblÃ¨me**Â : status.json fait 250 Ko avec 150 histoires
**Solution**:
```bash
/agileflow:compress
```
**RÃ©sultat**Â : RÃ©duit Ã  30 Ko, facilement en dessous des limites de jetons

### ScÃ©narioÂ 2Â : De nombreuses histoires terminÃ©es

**ProblÃ¨me**Â : 120Â histoires terminÃ©es, 30Â histoires activesÂ ; status.json bloated
**Solution**:
```bash
# Archive stories completed >7 days ago
bash .agileflow/scripts/archive-completed-stories.sh 7

# Then compress
/agileflow:compress
```
**RÃ©sultat**Â : dÃ©place les anciennes histoires vers les archives, compresse le reste

### ScÃ©nario 3Â :Â Maintenance rÃ©guliÃ¨re

**ProblÃ¨me**Â : vous souhaitez que status.json reste automatiquement optimisÃ©
**Solution**Â : Ajouter au planning CI (compression mensuelle)
**RÃ©sultat**Â : toujours sous les limites des jetons, traitement rapide des agents

## DÃ©pannage

### "status.json toujours trop volumineux aprÃ¨s compression"

Essayez un archivage plus agressifÂ :
```bash
# Archive stories >3 days old instead of default 7
bash .agileflow/scripts/archive-completed-stories.sh 3

/agileflow:compress
```

### "Informations critiques perdues aprÃ¨s compression"

Restaurer Ã  partir d'une sauvegardeÂ :
```bash
cp docs/09-agents/status.json.backup docs/09-agents/status.json
```

VÃ©rifiez si les fichiers de dÃ©marques d'histoire contiennent les dÃ©tails dans `docs/06-stories/`.

### "Impossible de trouver les dÃ©tails de l'histoire"

Le contenu de l'histoire est dans des fichiers markdownÂ :
```bash
find docs/06-stories/ -name "US-*.md" | xargs grep "your search term"
```

##Â meilleures pratiques

1. **Compression rÃ©guliÃ¨re**Â â€“ ExÃ©cuter mensuellement ou trimestriellement
2. **Archiver de maniÃ¨re agressive** - DÃ©placez d'abord les anciennes histoires terminÃ©es
3. **Sauvegarder avant** - La compression crÃ©e automatiquement une sauvegarde
4. **VÃ©rifier aprÃ¨s** - VÃ©rifiez l'estimation du jeton dans la sortie
5. **Commit Changes** - Ajouter le statut compressÃ© Ã  git
6. **Politique relative aux documents**Â â€“Â Enregistrer quand/pourquoi la compositionression runs
7. **Test Restoration** - Verify backup works if needed

## Related Commands

- [`/agileflow:status`](/commands/status) - View current story statuses
- [`/agileflow:validate`](/commands/validate) - Check AgileFlow system health
- Archive script: `bash .agileflow/scripts/archive-completed-stories.sh` - Move completed stories to archive

## Technical Details

### Files Involved

| File | Purpose |
|------|---------|
| `docs/09-agents/status.json` | Lightweight tracking index (compressed) |
| `docs/09-agents/status.json.backup` | Automatic backup before compression |
| `docs/06-stories/` | Full story markdown files (unchanged) |
| `docs/09-agents/archive/YYYY-MM.json` | Historical completed stories |

### Implementation

The compression script uses `jq` for JSON processing:

```bash
# Extract only essential fields for each story
jq '[.[] | {story_id, epic, title, owner, status, estimate, created, updated, completed_at, dependencies, branch, summary, last_update, assigned_at}]' status.json > status-compressed.json
```

### Token Calculation

Rough estimation used in output:
- 1 token â‰ˆ 4 characters/bytes (approximate)
- 100KB file â‰ˆ 25,000 tokens
- Target: < 100KB to stay well under limits

## FAQ

<Accordion type="multiple">
  <AccordionItem value="delete">
    <AccordionTrigger>Does compression supprimer les fichiers d'histoireÂ ?</AccordionTrigger>
    <AccordionContent>
      Non, seul status.json est modifiÃ©. La dÃ©marque de l'histoire dans docs/06-stories/ n'est pas modifiÃ©e.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="undo">
    <AccordionTrigger>Puis-je annuler la compressionÂ ?</AccordionTrigger>
    <AccordionContent>
      Oui. Une sauvegarde est crÃ©Ã©e automatiquement. Restaurez simplementÂ : `cp docs/09-agents/status.json.backup docs/09-agents/status.json`
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="when">
    <AccordionTrigger>Quand dois-je compresserÂ ?</AccordionTrigger>
    <AccordionContent>
      Lorsque status.json dÃ©passe 25 Ko, ou mensuellement Ã  titre de maintenance. Combinez avec l'archivage pour de meilleurs rÃ©sultats.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="performance">
    <AccordionTrigger>Cela affecte-t-il les performances de l'agentÂ ?</AccordionTrigger>
    <AccordionContent>
      Oui, cela l'amÃ©liore considÃ©rablement. Status.json plus petit = lectures plus rapides, contexte plus disponible pour les agents.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="git">
    <AccordionTrigger>WhÃ  propos de l'historique de gitÂ ?</AccordionTrigger>
    <AccordionContent>
      Toutes les modifications sont validÃ©es. Les versions prÃ©cÃ©dentes sont dans l'historique de git si nÃ©cessaire.
    </AccordionContent>
  </AccordionItem>
  <AccordionItem value="customize">
    <AccordionTrigger>Puis-je personnaliser les champs Ã  conserverÂ ?</AccordionTrigger>
    <AccordionContent>
      Oui, modifiez le script de compression pour conserver des champs supplÃ©mentaires si nÃ©cessaire pour votre flux de travail.
    </AccordionContent>
  </AccordionItem>
</Accordion>