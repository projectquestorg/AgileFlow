---
title: وضع الحلقة
description: معالجة مستقلة للقصة باستخدام Ralph Loop لإكمال الملحمة دون تدخل
---
# وضع الحلقة

يتيح وضع Loop معالجة القصة بشكل مستقل من خلال نظام **Ralph Loop** الخاص بـ AgileFlow. تم تسميته على اسم نمط "Ralph Wiggum" من بحث Anthropic حول سير العمل الوكيل، وهو يعالج القصص تلقائيًا في ملحمة دون تدخل يدوي.

يتم تنشيط وضع التكرار من خلال الأمر [`/agileflow:babysit`](/commands/babysit) بمعلمات خاصة. يقوم Babysit بتنسيق العملية برمتها بينما يتولى Ralph Loop عملية التشغيل الآلي.

## نظرة عامة

عند التمكين، وضع الحلقة:

1. يختار أول قصة "جاهزة" من الملحمة
2. يتم وضع علامة "in_progress" عليه ويبدأ التنفيذ
3. عندما يتوقف كلود، يقوم بإجراء الاختبارات تلقائيًا
4. إذا نجحت الاختبارات → يشير إلى اكتمال القصة، فسيتم تحميل القصة التالية
5. يستمر حتى اكتمال الملحمة أو الوصول إلى الحد الأقصى من التكرارات

يتيح ذلك **معالجة الدفعات بين عشية وضحاها** لملاحم محددة جيدًا مع معايير قبول واضحة.

## بداية سريعة

__لا تترجم_0__

## كيف يعمل

### خطاف الإيقاف

يستخدم وضع Loop نظام ربط الإيقاف الخاص بـ Claude Code. عندما يتوقف كلود عن الردنانوغرام:

1. يعمل البرنامج النصي `ralph-loop.js` تلقائيًا
2. ينفذ أمر الاختبار الذي تم تكوينه (الافتراضي: `npm test`)
3. بناءً على النتائج، فإنه إما ينتقل إلى القصة التالية أو يطالب بالإصلاحات

<صورة>
  <الوسائط المصدر = "(prefers-color-scheme: dark)" srcset="/images/docs/features/loop-mode-flow.dark.svg" />
  <img alt="تدفق وضع الحلقة" src="/images/docs/features/loop-mode-flow.light.svg" />
</صورة>

### حالة الجلسة

يتم تخزين تكوين الحلقة في `docs/09-agents/session-state.json`:

__لا تترجم_1__

## المعلمات

| المعلمة | مطلوب | الافتراضي | الوصف |
|-----------|----------|---------|-------------|
| __غير مترجم_25__ | نعم | - | المعرّف الملحمي المطلوب معالجته (على سبيل المثال، EP-0042) |
| __غير مترجم_26__ | نعم | - | يجب أن يكون `loop` للوضع المستقل |
| __غير مترجم_28__ | لا | 20 | الحد الأقصى للتكرارات قبل التوقف |

## أوامر واجهة سطر الأوامر

__لا تترجم_2__

## أوضاع الحلقة

### الوضع العادي (الافتراضي)

التحقق القياسي القائم على الاختبار:

__لا تترجم_3__

- تشغيل `npm test` بعد كل توقف لكلود
- ينجح إذا نجحت جميع الاختبارات
- فشل في حالة فشل أي اختبار

### الوضع المرئي

بالنسبة للملاحم التي تركز على واجهة المستخدم والتي تتطلب التحقق من لقطة الشاشة:

__لا تترجم_4__

- التحقق من دليل `screenshots/` للصور
- يجب أن تحتوي جميع لقطات الشاشة على البادئة `verified-`
- مفيد لتطوير مكونات واجهة المستخدم

راجع [الوضع المرئي](/features/visual-mode) للحصول على التفاصيل.

### وضع التغطية

لمتطلبات تغطية الاختبار:

__لا تترجم_5__

- تشغيل الاختبارات مع تقارير التغطية
- التحقق من أن التغطية تلبي الحد الأدنى (على سبيل المثال، 80%)
- يفشل إذا انخفضت التغطية إلى ما دون الحد الأدنى

## اختيار القصة

يحدد Loop Mode القصص بترتيب الأولوية هذا:

1. **القصة الحالية** - إذا كانت إحداها قيد التقدم بالفعل
2. **قصص جاهزة** - قصص بالحالة "جاهزة" (تم استيفاء جميع التبعيات)
3. **القصص المحظورة** - تم تخطيها حتى يتم رفع الحظر عنها

يجب أن تحتوي القصص على:
- معايير قبول واضحة
- حل جميع التبعيات
- تم ضبط الحالة على "جاهز" أو "معلق"

## التكوين

### أمر الاختبار

قم بتكوين أمر الاختبار في __NOترجمة_32__:

__لا تترجم_6__

### إيقاف إعداد الخطاف

يتطلب وضع التكرار خطاف الإيقاف في `.claude/settings.json`:

__لا تترجم_7__

## متى يجب استخدام وضع الحلقة

### جيد ل

- ✅ ملاحم محددة جيدًا بقصص واضحة
- ✅ التطوير القائم على الاختبار (تحدد الاختبارات "تم")
- ✅ معالجة الدفعات لقصص متعددة بين عشية وضحاها
- ✅ مهام التنفيذ المتكررة (نقاط النهاية والمكونات CRUD)
- ✅ قصص بمعايير القبول الآلي

### ليست جيدة ل

- ❌ العمل الاستكشافي بدون معايير قبول واضحة
- ❌ قصص تتطلب مراجعة بشرية قبل المتابعة
- ❌ عمل معقد متعدد المجالات يحتاج إلى تنسيق
- ❌التنفيذ لأول مرة بدون أنماط
- ❌ قصص ذات تبعيات خارجية (واجهات برمجة التطبيقات والخدمات)

## مثال لسير العمل

### 1. قم بإعداد الملحمة

التأكد من أن جميع القصص لها معايير قبول واضحة:

__لا تترجم_8__

### 2. ابدأ وضع الحلقة

__لا تترجم_9__

### 3. مراقبة التقدم

التحقق من الحالة بشكل دوري:

__لا تترجم_10__

الإخراج:
__لا تترجم_11__

### 4. التعامل مع الفشل

إذا اختبارفي حالة الفشل، يعرض Loop Mode حالات الفشل ويستمر في العمل:

__لا تترجم_12__

### 5. أكمل الملحمة

عند اكتمال جميع القصص:

__لا تترجم_13__

## استكشاف الأخطاء وإصلاحها

### الحلقة لا تبدأ

1. التحقق من وجود حالة الجلسة:
   __لا تترجم_14__

2. تحقق من تكوين خطاف الإيقاف:
   __لا تترجم_15__

3. التهيئة يدويًا:
   __لا تترجم_16__

### الاختبارات تفشل دائمًا

1. قم بإجراء الاختبارات يدويًا أولاً:
   __لا تترجم_17__

2. تحقق من أمر الاختبار في التكوين:
   __لا تترجم_18__

3. التأكد من وجود اختبارات للقصة الحالية

### حلقة عالقة في نفس القصة

1. التحقق من عدد التكرارات:
   __لا تترجم_19__

2. إذا اقتربت من الحد الأقصى للتكرارات، إما:
   - إصلاح مشكلة الحظر
   - تخطي القصة: تحديث الحالة إلى "محظور"
   - زيادة الحد الأقصى: `--max=30`

### التوقف بشكل غير متوقع

تتوقف الحلقة عندما:
- تم الوصول إلى الحد الأقصى للتكرارات
- ملحمة كاملة
- أمر التوقف اليدوي
- خطأ فادح في تنفيذ الاختبار

تحقق من السجلات للحصول على التفاصيل:
__لا تترجم_20__

## أفضل الممارسات

### 1. ابدأ بالحلقة الصغيرةics

Test Loop Mode on a 3-5 story epic first before larger batches.

### 2. Write Tests First

Loop Mode works best with TDD - tests define when a story is "done".

### 3. Keep Stories Focused

Each story should be completable in 1-3 iterations. Large stories → more failures.

### 4. Monitor Periodically

Check status every 30-60 minutes during long runs.

### 5. Use Visual Mode for UI

For UI work, enable Visual Mode to catch rendering issues tests might miss.

## Related Features

- [Visual Mode](/features/visual-mode) - Screenshot verification for UI development
- [Compact Context](/features/compact-context) - Context preservation during long sessions
- [`/agileflow:babysit`](/commands/babysit) - The mentor command that orchestrates Loop Mode
- [`/agileflow:verify`](/commands/verify) - Manual test verification

## Architecture

Loop Mode consists of:

| Component | Purpose |
|-----------|---------|
| `ralph-loop.js` | Main loop orchestration script |
| `screenshot-verifier.js` | Visual Mode screenshot checملك |
| __غير مترجم_39__ | تكوين الحلقة وحالتها |
| وقف هوك | نقطة تكامل كود كلود |

يأتي اسم "رالف" من ورقة بحثية لـ Anthropic حول سير العمل الوكيل، حيث تم استخدام "Ralph Wiggum" كاسم رمزي لأنماط إكمال المهام المستقلة.