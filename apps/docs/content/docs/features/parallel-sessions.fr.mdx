---
title: Séances parallèles
description: Travaillez sur plusieurs fonctionnalités simultanément avec des arbres de travail git isolés et une protection des limites de session.
---
# sessions parallèles

Les sessions parallèles vous permettent de travailler simultanément sur plusieurs fonctionnalités, bugs ou expériences sans changement de contexte. Chaque session possède son propre répertoire isolé, sa branche git et sa propre protection des limites pour empêcher les modifications accidentelles entre sessions.

## Aperçu

Lorsque vous travaillez sur des projets complexes, vous devez souvent :
- Correction d'un bug alors qu'une fonctionnalité est en cours
- Expérimentez sans affecter votre travail principal
- Réviser le code dans une branche tout en développant dans une autre

Les sessions parallèles résolvent ce problème en créant des espaces de travail isolés à l'aide de **git worktrees**, chacun suivi par AgileFlow avec une protection automatique des limites.

<image>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-overview.dark.svg" />
  <img alt="Aperçu des sessions parallèles" src="/images/docs/features/parallel-sessions-overview.light.svg" />
</image>

## Principales fonctionnalités

| Fonctionnalité | Descriptif |
|---------|-------------|
| **Arbres de travail Git** | Chaque session est un répertoire distinctavec sa propre succursale |
| **Protection des limites** | Les hooks d'édition/écriture empêchent les modifications accidentelles entre sessions |
| **Suivi de session** | AgileFlow suit toutes les sessions avec leur statut, leurs histoires et leur activité |
| **Commutation facile** | Changer de session avec `/add-dir` - reste dans le même terminal |
| **Contexte indépendant** | Chaque session conserve sa propre histoire et sa propre progression |

## Comment ça marche

### Architecture

<image>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-arch.dark.svg" />
  <img alt="Architecture des sessions parallèles" src="/images/docs/features/parallel-sessions-arch.light.svg" />
</image>

### Gestion de l'état de session

Les sessions sont suivies dans deux fichiers :

**Registre** (`.agileflow/sessions/registry.json`) :
```json
{
  "sessions": [
    {
      "id": "1",
      "path": "/home/user/project",
      "branch": "main",
      "is_main": true,
      "nickname": null
    },
    {
      "id": "2",
      "path": "/home/user/project-bugfix",
      "branch": "session-2-bugfix",
      "is_main": false,
      "nickname": "bugfix"
    }
  ]
}
```

**Session active** (`docs/09-agents/session-state.json`) :
```json
{
  "active_session": {
    "id": "2",
    "nickname": "bugfix",
    "path": "/home/user/project-bugfix",
    "branch": "session-2-bugfix",
    "switched_at": "2025-01-12T10:30:00Z"
  }
}
```

### Protection des limites

Le hook de limite de session s'exécute à chaque opération d'édition et d'écriture :

<image>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-boundary.dark.svg" />
  <img alt="Flux de protection des limites de session" src="/images/docs/features/parallel-sessions-boundary.light.svg" />
</image>

**Logique de protection :**
```javascript
// File is allowed if:
// 1. No active session is set (normal behavior)
// 2. File path starts with active session path

const isAllowed =
  !activeSession ||
  filePath.startsWith(activeSession.path + '/') ||
  filePath === activeSession.path;
```

## Commandes

### Créer une nouvelle session

```
/agileflow:session:new
```

Crée une nouvelle session parallèle avec des options :
- **Création automatique** : génère `../project-{id}` avec la branche `session-{id}`
- **Named** : crée `../project-{name}` avec un surnom personnalisé
- **Branche existante** : utilise une branche git existante

**Sortie :**
```
Created Session 2 "bugfix"

┌───────────┬────────────────────────────────────────────┐
│ Session   │ 2 "bugfix"                                 │
│ Workspace │ ../project-bugfix                          │
│ Branch    │ session-2-bugfix                           │
└───────────┴────────────────────────────────────────────┘

To switch to this session, run:

  /add-dir ../project-bugfix
```

### Changer de session

```
/agileflow:session:resume
```

Répertorie toutes les sessions et fournit la commande pour basculer :

```
Which session would you like to resume?

○ Session 1: main (current)
  US-0042: User Auth API │ Active now │ /home/user/project

○ Session 2: "bugfix"
  US-0038: Fix Login │ Active now │ ../project-bugfix

○ Create new session
  Start a fresh parallel workspace
```

Après sélection :
```
To switch to Session 2 "bugfix":

  /add-dir ../project-bugfix
```

### Afficher l'état de la session

```
/agileflow:session:status
```

Affiche les informations sur la session en cours et toutes les sessions enregistrées.

### Fin de session

```
/agileflow:session:end
```

Termine la session en cours et éventuellement :
- Fusionne les modifications vers le principal
- Supprime l'arbre de travail
- Nettoie la branche

## Exemple de flux de travail

### Démarrage d'une correction de bug pendantLe travail sur les fonctionnalités est en cours

```
# You're working on Session 1 (main) with US-0042: User Auth API

User: I need to quickly fix a login bug, but don't want to lose my current work

Claude: I'll create a new session for the bug fix.

> /agileflow:session:new

Created Session 2 "bugfix"
To switch: /add-dir ../project-bugfix

User: /add-dir ../project-bugfix

# Now working in Session 2
# Claude can only edit files in ../project-bugfix
# Any attempt to edit files in the main project is BLOCKED

User: Fix the login validation bug

Claude: [Fixes bug in ../project-bugfix/src/auth/login.ts]

User: Done, let's go back to main work

> /agileflow:session:resume
> Select: Session 1: main

To switch: /add-dir /home/user/project

User: /add-dir /home/user/project

# Back in Session 1, boundary protection now blocks edits to ../project-bugfix
```

##Configuration

### Activation de la protection des limites de session

Les hooks de limite de session sont automatiquement configurés lorsque vous utilisez des sessions parallèles. Ils sont ajoutés à `.claude/settings.json` :

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "node .agileflow/scripts/session-boundary.js"
          }
        ]
      },
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "node .agileflow/scripts/session-boundary.js"
          }
        ]
      }
    ]
  }
}
```

### Désactivation de la protection des limites

Pour travailler sur plusieurs sessions sans restrictions :

```bash
node .agileflow/scripts/session-manager.js clear-active
```

Cela efface la session active, permettant ainsi de modifier n'importe quel répertoire.

## CLI du gestionnaire de sessions

Le script du gestionnaire de sessions fournit un contrôle direct :

```bash
# List all sessions
node .agileflow/scripts/session-manager.js list --json

# Get current session status
node .agileflow/scripts/session-manager.js status

# Switch active session (for boundary protection)
node .agileflow/scripts/session-manager.js switch 2

# Get currently active session
node .agileflow/scripts/session-manager.js active

# Clear active session (disable boundaries)
node .agileflow/scripts/session-manager.js clear-active

# Create new session
node .agileflow/scripts/session-manager.js create --nickname "feature"

# Delete session
node .agileflow/scripts/session-manager.js delete 2 --remove-worktree
```

## meilleures pratiques

### À faire

- **Utilisez des surnoms descriptifs** : `bugfix`, `auth`, `experiment` sont plus clairs que `session-2`
- **Changer de session explicitement** : utilisez toujours `/agileflow:session:resume` pour changer
- **Commit beforeswitch** : assurez-vous que le travail est enregistré avant de changer de session
- **Terminer les sessions une fois terminé** : nettoyer les arbres de travail pour économiser de l'espace disque

### À ne pas faire

- **Ne pas cd manuellement** : utilisez `/add-dir` pour rester dans la même conversation avec Claude
-**Don ne désactive pas les limites avec désinvolture** : ils empêchent la contamination croisée accidentelle
- **Ne créez pas trop de sessions** : gardez-le gérable (3 à 5 maximum recommandés)

## Dépannage

### Erreur "Modification bloquée"

**Cause** : Vous essayez de modifier un fichier en dehors de la session active.

**Solution** :
```
/agileflow:session:resume
```
Sélectionnez la bonne session, puis exécutez la commande `/add-dir` affichée.

### Session introuvable

**Cause** : Le répertoire worktree a été supprimé ou déplacé.

**Solution** :
```bash
# Check if directory exists
ls ../project-{name}

# If missing, unregister the session
node .agileflow/scripts/session-manager.js delete {id}
```

### Conflits avec l'arbre de travail Git

**Cause** : Branche déjà extraite dans un autre arbre de travail.

**Solution** :
```bash
# List worktrees
git worktree list

# Remove stale worktree
git worktree remove ../project-{name}
```

## Fonctionnalités associées

- [Contrôle des dommages](/docs/features/damage-control) - Protection supplémentaire des fichiers
-[Compact Context](/docs/features/compact-context) - Préservation du contexte entre les sessions
- [Expertise des agents](/docs/features/agent-expertise-system) - Agents spécialisés pour les sessions