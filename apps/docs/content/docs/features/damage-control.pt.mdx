---
title: Controle de Danos
description: Proteja sua base de código de comandos destrutivos usando ganchos PreToolUse
---
# Controle de Danos

O Damage Control é um sistema de segurança que evita que agentes de IA executem comandos destrutivos ou perigosos. Ele usa os **ganchos PreToolUse** do Claude Code para validar comandos antes da execução.

## Início rápido

```bash
# Enable with interactive wizard
/agileflow:configure damagecontrol

# Or command line
node .agileflow/scripts/agileflow-configure.js --enable=damagecontrol

# Then restart Claude Code (Cmd+Q / Ctrl+Q)
```

## Como funciona

<imagem>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/damage-control-flow.dark.svg" />
  <img alt="Fluxo de controle de danos" src="/images/docs/features/damage-control-flow.light.svg" />
</imagem>

O Damage Control usa três ganchos separados:

| Gancho | Arquivo | Protege contra |
|------|------|------------------|
| **Baixa** | `damage-control-bash.js` | Comandos de shell perigosos |
| **Editar** | `damage-control-edit.js` | Edições em arquivos protegidos |
| **Escrever** | `damage-control-write.js` | Grava em locais protegidos |

---

## Camadas de proteção

### Padrões de comando Bash

**Bloqueado automaticamente:**
- Exclusões destrutivas: `rm -rf /`, __NOTRASLATE_21__, exclusões recursivas
- Forçar envio: `git push --force`, `git push -f`
- Reinicialização total: __NOTRASLATE_24__
- Destruição do banco de dados: `DROP TABLE`, `TRUNCATE TABLE`, `DELETE FROM ... ;`
- Operações de disco: `dd if=`, `mkfs.`, `fdisk`
- Exposição de credenciais: `cat *.pem`, __NOTRASLATE_32__
- Forçar a morte: `kill -9`, `killall`, `pkill -9`
- E mais 30 padrões

**Requer confirmação (perguntar padrões):**
- Exclusões de banco de dados com WHERE: __NOTRASLATE_36__
- Publicação: `npm publish`
- Empurrando para principal: __NOTRASLATE_38__
- Cloud CLI exclui: `aws delete`, `gcloud delete`, `az delete`
- Atualizações do banco de dados: __NOTRASLATE_42__
- Removendo node_modules: `rm -rf node_modules`

### Níveis de proteção de caminho

| Nível | Leia | Escreva | Editar | Excluir |
|-------|------|-------|------|--------|
| **Acesso Zero** | Não | Não | Não | Não |
| **Somente leitura** | Sim | Não | Não | Não |
| **Não excluir** | Sim | Sim | Sim | Não |

**Caminhos de acesso zero:**
- Chaves SSH: `~/.ssh/`, `id_rsa`, `id_ed25519`
- Credenciais de nuvem: `~/.aws/`, `~/.gnupg/`, `~/.config/gh/`
- Segredos de produção: `.env.production`, `.env.local`, `.env.secrets`
- Chaves privadas: `*.pem`, `*.key`, `credentials.json`

**Caminhos somente leitura:**
- Configuração do shell: `~/.bashrc`, `~/.zshrc`, `~/.gitconfig`
- Bloquear arquivos: `package-lock.json`, __NOTRASLATE_60__
- Sistema: __NOTRASLATE_61__

**Não excluir caminhos:**
- Núcleo AgileFlow: __NOTRASLATE_62__, __NOTRASLATE_63__
- Status do projeto: __NOTRASLATE_64__
- Controle de origem: __NOTRASLATE_65__
- Raízes do projeto: `README.md`, __NOTRASLATE_67__

---

## Guia de configuração

### Pré-requisitos

- AgileFlow v2.78.0+
- Código Claude (mais recente)
- Diretório __NOTRASLATE_68__ instalado

### Etapa 1: Escolha o nível de proteção

**Padrão (recomendado)**
- Apenas correspondência rápida de padrões
- Latência de 0 ms adicionada
- Mais de 40 padrões perigosos bloqueados
- Perfeito para a maioria dos projetos

**Aprimorado**
- Avaliação padrão + IA para ameaças desconhecidas
-Latência de 50-100 ms adicionada
- Melhor para código altamente sensível
- Recurso experimental

**Mínimo**
- Somente proteção de caminho
- Sem padrões de comando bash

### Etapa 2: Habilitar

```bash
/agileflow:configure damagecontrol
```

Ou:

```bash
node .agileflow/scripts/agileflow-configure.js --enable=damagecontrol
```

### Etapa 3: verificar

__NOTRADUZIR_3__

### Etapa 4: reinicie o código Claude

**Importante:** Os ganchos só entram em vigor após a reinicialização.

__NÃOTRADUZIR_4__

---

## Arquitetura

### Fluxo do sistema

<imagem>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/damage-control-arch.dark.svg" />
  <img alt="Arquitetura de controle de danos" src="/images/docs/features/damage-control-arch.light.svg" />
</imagem>

### Exemplo de gancho Bash

__NOTRADUZIR_5__

### Exemplo de edição de gancho

__NOTRADUZIR_6__

### Códigos de saída

| Código | Significado | Ação |
|------|---------|--------|
| 0 | Permitir | Ferramenta é executada normalmente |
| 2 | Bloco | Execução de ferramenta impedida |

### Filosofia de falha aberta

Se o arquivo de padrões estiver corrompido ou ausente, os comandos serão **permitidos** (não bloqueados). Isso garante um sa quebradoO sistema fety não bloqueia todas as operações.

---

## Configuração

### Arquivo de padrões

Localização: `.agileflow/config/damage-control-patterns.yaml`

__NÃOTRADUZIR_7__

### Adicionando padrões personalizados

Edite o arquivo de padrões diretamente:

__NÃOTRADUZIR_8__

### Configuração de ganchos

Em `.claude/settings.json`:

__NOTRADUZIR_9__

---

## Perguntas frequentes e solução de problemas

### Perguntas Gerais

**P: O Damage Control desacelera os comandos?**

R: Não, adiciona menos de 5 ms por comando. A correspondência de padrões é otimizada.

**P: Posso desativá-lo temporariamente?**

R: Sim:
__NOTRADUZIR_10__
Em seguida, reinicie o Claude Code. Reative com __NOTRASLATE_71__.

**P: E se bloquear algo que deveria ser permitido?**

R: Edite __NOTRASLATE_72__:
1. Torne o padrão mais específico
2. Mova-o de __NOTRASLATE_73__ para __NOTRASLATE_74__
3. Remova-o se não for necessário

Em seguida, reinicie o Claude Code.

**P: Ele também protege contra erros humanos?**

R: Sim. Todos os comandos passam por ganchos, sejam seus ou da IA.

**P: Os padrões podem ser ignorados?**

R: Não é fácil. Combinação de padrõescadeias de comando reais. Soluções alternativas simples como __NOTRASLATE_75__ criam erros de sintaxe.

### Problemas de configuração

**P: Os ganchos não funcionam após a ativação.**

R: Causa mais comum – você não reiniciou o Claude Code:
1. Feche completamente (Cmd+Q / Ctrl+Q)
2. Aguarde 5 segundos
3. Reabrir
4. Teste com __NOTRASLATE_76__

**P: Como posso saber se está funcionando?**

R: Teste um comando bloqueado:
__NOTRADUZIR_11__

**P: Não é possível encontrar o arquivo de padrões.**

R: Crie:
```bash
mkdir -p .agileflow/config
cp .agileflow/templates/damage-control-patterns.yaml .agileflow/config/
```

**P: settings.json foi corrompido.**

R: Corrija:
__NÃOTRADUZIR_13__

### Matriz de solução de problemas

| Problema | Causa | Solução |
|--------|-------|----------|
| Ganchos não funcionam | Não reiniciado | Saia e reinicie Claude Code |
| Todos os comandos bloqueados | Padrões muito amplos | Edite YAML, torne padrões específicos |
| Comando válido bloqueado | Falso positivo | Vá para askPatterns ou remova |
| Arquivo de padrões ausente | Não criado | Execute `/agileflow:configure damagecontrol` |
| Erro de análise JSON | Configurações inválidas | Valide com __NOTRASLATE_78__ |

### Desativando**Desativar temporariamente:**
__NOTRADUZIR_14__

**Remover gancho específico:**
__NÃOTRADUZIR_15__

**Reativar:**
__NOTRADUZIR_16__

---

## Melhores práticas

### O que fazer
- Habilite o controle de danos em todos os projetos
- Use proteção padrão (aprimorada é experimental)
- Teste com __NOTRASLATE_79__ após a configuração
- Mantenha o arquivo de padrões no controle de versão
- Revise operações bloqueadas em logs

### O que não fazer
- Não desative sem um bom motivo
- Não faça padrões muito amplos (falsos positivos)
- Não se esqueça de reiniciar após as alterações
- Não ignore avisos de comandos bloqueados

### Para equipes
- Confirmar __NOTRASLATE_80__
- Documente padrões personalizados com comentários
- Teste padrões antes de implantar na equipe
- Revise e atualize padrões periodicamente