---
title: السيطرة على الأضرار
description: قم بحماية قاعدة التعليمات البرمجية الخاصة بك من الأوامر المدمرة باستخدام خطافات PreToolUse
---
# التحكم في الأضرار

التحكم في الأضرار هو نظام أمان يمنع عملاء الذكاء الاصطناعي من تنفيذ أوامر مدمرة أو خطيرة. ويستخدم **خطافات PreToolUse** الخاصة بـ Claude Code للتحقق من صحة الأوامر قبل التنفيذ.

## بداية سريعة

__لا تترجم_0__

## كيف يعمل

<صورة>
  <مصدر الوسائط="(prefers-color-scheme: dark)" srcset="/images/docs/features/damage-control-flow.dark.svg" />
  <img alt="تدفق التحكم في الأضرار" src="/images/docs/features/damage-control-flow.light.svg" />
</صورة>

يستخدم التحكم في الأضرار ثلاثة خطافات منفصلة:

| هوك | ملف | يحمي من |
|------|------|------------------|
| **باش** | __غير مترجم_17__ | أوامر الصدفة الخطيرة |
| **تحرير** | __غير مترجم_18__ | تعديلات على الملفات المحمية |
| **اكتب** | __غير مترجم_19__ | يكتب إلى المواقع المحمية |

---

## طبقات الحماية

### أنماط أوامر باش

** تم حظره تلقائيًا: **
- عمليات الحذف المدمرة: `rm -rf /`، `rm -rf ..`، عمليات الحذف العودية
- الدفع بقوة: `git push --force`، `git push -f`
- إعادة التعيين الثابت: `git reset --hard`
- تدمير قاعدة البيانات: `DROP TABLE`، `TRUNCATE TABLE`، `DELETE FROM ... ;`
- عمليات القرص: `dd if=`، `mkfs.`، `fdisk`
- عرض بيانات الاعتماد: `cat *.pem`، `cat id_rsa`
- القتل القسري: `kill -9`، `killall`، `pkill -9`
- وأكثر من 30 نمطًا آخر

**يتطلب تأكيدًا (أنماط السؤال):**
- يتم حذف قاعدة البيانات باستخدام المكان: `DELETE FROM table WHERE ...`
- النشر: `npm publish`
- الدفع إلى الرئيسي: `git push origin main`
- حذف واجهة سطر الأوامر في السحابة: `aws delete`، `gcloud delete`، `az delete`
- تحديثات قاعدة البيانات: `UPDATE ... SET ... WHERE`
- إزالة وحدات العقدة: `rm -rf node_modules`

### مستويات حماية المسار

| المستوى | إقرأ | اكتب | تحرير | حذف |
|-------|------|-------|------|--------|
| ** الوصول صفر ** | لا | لا | لا | لا |
| ** للقراءة فقط ** | نعم | لا | لا | لا |
| **لا يوجد حذف** | نعم | نعم | نعم | لا |

** مسارات الوصول صفر: **
- مفاتيح SSH: `~/.ssh/`، `id_rsa`، `id_ed25519`
- بيانات اعتماد السحابة: `~/.aws/`، `~/.gnupg/`، `~/.config/gh/`
- أسرار الإنتاج: `.env.production`، `.env.local`، `.env.secrets`
- المفاتيح الخاصة: `*.pem`، `*.key`، `credentials.json`

** مسارات للقراءة فقط: **
- تكوين الصدفة: `~/.bashrc`، `~/.zshrc`، `~/.gitconfig`
- قفل الملفات: `package-lock.json`، `yarn.lock`
- النظام: `/etc/`

** لا يوجد حذف المسارات: **
- قلب AgileFlow: `.agileflow/`، `.claude/`
- حالة المشروع: `docs/09-agents/status.json`
- التحكم بالمصدر: `.git/`
- جذور المشروع: `README.md`، `package.json`

---

## دليل الإعداد

### المتطلبات الأساسية

- AgileFlow v2.78.0+
- كلود كود (الأحدث)
- تم تثبيت دليل `.agileflow`

### الخطوة 1: اختر مستوى الحماية

**قياسي (موصى به)**
- مطابقة الأنماط السريعة فقط
- تمت إضافة زمن الوصول 0 مللي ثانية
- تم حظر أكثر من 40 نمطًا خطيرًا
- مثالي لمعظم المشاريع

**المحسنة**
- تقييم قياسي + الذكاء الاصطناعي للتهديدات غير المعروفة
-تمت إضافة زمن الوصول 50-100 مللي ثانية
- أفضل للكود الحساس للغاية
- الميزة التجريبية

**الحد الأدنى**
- حماية المسار فقط
- لا توجد أنماط أوامر باش

### الخطوة الثانية: تمكين

__لا تترجم_1__

أو:

__لا تترجم_2__

### الخطوة 3: التحقق

__لا تترجم_3__

### الخطوة 4: أعد تشغيل كلود كود

**هام:** تصبح الخطافات سارية المفعول فقط بعد إعادة التشغيل.

__لا تترجم_4__

---

##الهندسة المعمارية

### تدفق النظام

<صورة>
  <مصدر الوسائط="(prefers-color-scheme: dark)" srcset="/images/docs/features/damage-control-arch.dark.svg" />
  <img alt="بنية التحكم في الأضرار" src="/images/docs/features/damage-control-arch.light.svg" />
</صورة>

### مثال باش هوك

__لا تترجم_5__

### تحرير مثال على الخطاف

__لا تترجم_6__

### رموز الخروج

| الكود | معنى | العمل |
|------|---------|--------|
| 0 | السماح | يتم تنفيذ الأداة بشكل طبيعي |
| 2 | كتلة | تم منع تنفيذ الأداة |

### فلسفة الفشل والانفتاح

إذا كان ملف الأنماط تالفًا أو مفقودًا، فستكون الأوامر **مسموح بها** (غير محظورة). وهذا يضمن كسر سانظام fety لا يمنع جميع العمليات.

---

## التكوين

### ملف الأنماط

الموقع: `.agileflow/config/damage-control-patterns.yaml`

__لا تترجم_7__

### إضافة أنماط مخصصة

تحرير ملف الأنماط مباشرة:

__لا تترجم_8__

### تكوين الخطافات

في `.claude/settings.json`:

__لا تترجم_9__

---

## الأسئلة الشائعة واستكشاف الأخطاء وإصلاحها

### أسئلة عامة

**س: هل يؤدي التحكم في الأضرار إلى إبطاء الأوامر؟**

ج: لا، فهو يضيف أقل من 5 مللي ثانية لكل أمر. تم تحسين مطابقة الأنماط.

**س: هل يمكنني تعطيله مؤقتًا؟**

ج: نعم:
__لا تترجم_10__
ثم أعد تشغيل كلود كود. أعد التمكين باستخدام `--enable=damagecontrol`.

**س: ماذا لو تم حظر شيء يجب السماح به؟**

ج: تحرير `.agileflow/config/damage-control-patterns.yaml`:
1. اجعل النمط أكثر تحديدًا
2. انقله من `bashToolPatterns` إلى `askPatterns`
3. قم بإزالته إذا لم تكن هناك حاجة إليه

ثم أعد تشغيل كلود كود.

**س: هل يحمي من الأخطاء البشرية أيضًا؟**

ج: نعم. تمر جميع الأوامر عبر الخطافات، سواء منك أو من الذكاء الاصطناعي.

**س: هل يمكن تجاوز الأنماط؟**

ج: ليس بسهولة. تطابق الأنماطسلاسل الأوامر الفعلية. تؤدي الحلول البسيطة مثل `r m -rf` إلى إنشاء أخطاء في بناء الجملة.

### مشكلات الإعداد

**س: الخطافات لا تعمل بعد التمكين.**

ج: السبب الأكثر شيوعًا هو عدم قيامك بإعادة تشغيل Claude Code:
1. أغلق تمامًا (Cmd+Q / Ctrl+Q)
2. انتظر 5 ثواني
3. أعد الفتح
4. الاختبار باستخدام `rm -rf /`

**س: كيف أعرف إذا كان يعمل؟**

ج: اختبار أمر محظور:
__لا تترجم_11__

**س: لا يمكن العثور على ملف الأنماط.**

ج: إنشائه:
__لا تترجم_12__

**س: تم تلف settings.json.**

ج: أصلحه:
__لا تترجم_13__

### مصفوفة استكشاف الأخطاء وإصلاحها

| مشكلة | السبب | الحل |
|---------|-------|---------|
| الخطافات لا تعمل | لم تتم إعادة التشغيل | قم بإنهاء وإعادة تشغيل Claude Code |
| تم حظر كافة الأوامر | الأنماط واسعة جدًا | تحرير YAML، وجعل الأنماط محددة |
| تم حظر أمر صالح | إيجابية كاذبة | انتقل إلى AskPatterns أو قم بإزالة |
| ملف الأنماط مفقود | لم يتم إنشاؤه | تشغيل `/agileflow:configure damagecontrol` |
| خطأ في تحليل JSON | إعدادات غير صالحة | التحقق من الصحة باستخدام `jq empty .claude/settings.json` |

### تعطيل**تعطيل مؤقت:**
__لا تترجم_14__

**إزالة خطاف محدد:**
__لا تترجم_15__

**إعادة التمكين:**
__لا تترجم_16__

---

## أفضل الممارسات

### ما يجب فعله
- تمكين التحكم في الأضرار في جميع المشاريع
- استخدام الحماية القياسية (المحسنة تجريبية)
- اختبر باستخدام `rm -rf /` بعد الإعداد
- الاحتفاظ بملف الأنماط في التحكم بالإصدار
- مراجعة العمليات المحظورة في السجلات

### لا تفعل
- لا تقم بالتعطيل دون سبب وجيه
- لا تجعل الأنماط واسعة جدًا (إيجابيات كاذبة)
- لا تنس إعادة التشغيل بعد التغييرات
- لا تتجاهل تحذيرات الأوامر المحظورة

### للفرق
- الالتزام `.agileflow/config/damage-control-patterns.yaml`
- توثيق الأنماط المخصصة بالتعليقات
- أنماط الاختبار قبل النشر في الفريق
- مراجعة وتحديث الأنماط بشكل دوري