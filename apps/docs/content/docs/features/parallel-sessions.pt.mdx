---
title: Sessões Paralelas
description: Trabalhe em vários recursos simultaneamente com árvores de trabalho git isoladas e proteção de limite de sessão.
---

# Sessões Paralelas

As sessões paralelas permitem que você trabalhe em vários recursos, bugs ou experimentos simultaneamente, sem mudança de contexto. Cada sessão tem seu próprio diretório isolado, ramificação git e proteção de limite para evitar edições acidentais entre sessões.

## Visão geral

Ao trabalhar em projetos complexos, muitas vezes você precisa:
- Corrija um bug enquanto um recurso está em andamento
- Experimente sem afetar seu trabalho principal
- Revise o código em uma ramificação enquanto desenvolve em outra

Sessões Paralelas resolvem isso criando espaços de trabalho isolados usando **git worktrees**, cada um rastreado pelo AgileFlow com proteção automática de limites.

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-overview.dark.svg" />
  <img alt="Visão geral das sessões paralelas" src="/images/docs/features/parallel-sessions-overview.light.svg" />
</picture>

## Principais recursos

| Feature | Description |
|---------|-------------|
| **Git Worktrees** | Each session is a separate directory with its own branch |
| **Boundary Protection** | Edit/Write hooks prevent accidental cross-session edits |
| **Session Tracking** | AgileFlow tracks all sessions with status, stories, and activity |
| **Easy Switching** | Switch sessions with `/add-dir` - stays in same terminal |
| **Independent Context** | Each session maintains its own story and progress |

## Como funciona

### Arquitetura

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-arch.dark.svg" />
  <img alt="Arquitetura de sessões paralelas" src="/images/docs/features/parallel-sessions-arch.light.svg" />
</picture>

### Gerenciamento de estado de sessão

As sessões são rastreadas em dois arquivos:

**Registry** (`.agileflow/sessions/registry.json`):
```json
{
  "sessions": [
    {
      "id": "1",
      "path": "/home/user/project",
      "branch": "main",
      "is_main": true,
      "nickname": null
    },
    {
      "id": "2",
      "path": "/home/user/project-bugfix",
      "branch": "session-2-bugfix",
      "is_main": false,
      "nickname": "bugfix"
    }
  ]
}
```

**Active Session** (`docs/09-agents/session-state.json`):
```json
{
  "active_session": {
    "id": "2",
    "nickname": "bugfix",
    "path": "/home/user/project-bugfix",
    "branch": "session-2-bugfix",
    "switched_at": "2025-01-12T10:30:00Z"
  }
}
```

### Proteção de limite

O gancho de limite de sessão é executado em todas as operações de edição e gravação:

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-boundary.dark.svg" />
  <img alt="Fluxo de proteção de limite de sessão" src="/images/docs/features/parallel-sessions-boundary.light.svg" />
</picture>

**Protection Logic:**
```javascript
// File is allowed if:
// 1. No active session is set (normal behavior)
// 2. File path starts with active session path

const isAllowed =
  !activeSession ||
  filePath.startsWith(activeSession.path + '/') ||
  filePath === activeSession.path;
```

## Comandos

### Criar nova sessão

```
/agileflow:session:new
```

Cria uma nova sessão paralela com opções:
- **Auto-create**: Gera `../project-{id}` com filial `session-{id}`
- **Named**: Cria `../project-{name}` com apelido personalizado
- **Existing branch**: Usa uma ramificação git existente

**Output:**
```
Created Session 2 "bugfix"

┌───────────┬────────────────────────────────────────────┐
│ Session   │ 2 "bugfix"                                 │
│ Workspace │ ../project-bugfix                          │
│ Branch    │ session-2-bugfix                           │
└───────────┴────────────────────────────────────────────┘

To switch to this session, run:

  /add-dir ../project-bugfix
```

### Alternar sessões

```
/agileflow:session:resume
```

Lista todas as sessões e fornece o comando para alternar:

```
Which session would you like to resume?

○ Session 1: main (current)
  US-0042: User Auth API │ Active now │ /home/user/project

○ Session 2: "bugfix"
  US-0038: Fix Login │ Active now │ ../project-bugfix

○ Create new session
  Start a fresh parallel workspace
```

Após a seleção:
```
To switch to Session 2 "bugfix":

  /add-dir ../project-bugfix
```

### Ver status da sessão

```
/agileflow:session:status
```

Mostra informações da sessão atual e todas as sessões registradas.

### Encerrar sessão

```
/agileflow:session:end
```

Encerra a sessão atual e opcionalmente:
- Mescla as alterações de volta ao principal
- Exclui a árvore de trabalho
- Limpa o galho

## Exemplo de fluxo de trabalho

### Iniciando uma correção de bug enquanto o trabalho do recurso está em andamento

```
# You're working on Session 1 (main) with US-0042: User Auth API

User: I need to quickly fix a login bug, but don't want to lose my current work

Claude: I'll create a new session for the bug fix.

> /agileflow:session:new

Created Session 2 "bugfix"
To switch: /add-dir ../project-bugfix

User: /add-dir ../project-bugfix

# Now working in Session 2
# Claude can only edit files in ../project-bugfix
# Any attempt to edit files in the main project is BLOCKED

User: Fix the login validation bug

Claude: [Fixes bug in ../project-bugfix/src/auth/login.ts]

User: Done, let's go back to main work

> /agileflow:session:resume
> Select: Session 1: main

To switch: /add-dir /home/user/project

User: /add-dir /home/user/project

# Back in Session 1, boundary protection now blocks edits to ../project-bugfix
```

## Configuração

### Habilitando a proteção de limite de sessão

Os ganchos de limite de sessão são configurados automaticamente quando você usa sessões paralelas. Eles são adicionados a `.claude/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "node .agileflow/scripts/session-boundary.js"
          }
        ]
      },
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "node .agileflow/scripts/session-boundary.js"
          }
        ]
      }
    ]
  }
}
```

### Desativando proteção de limite

Para trabalhar em sessões sem restrições:

```bash
node .agileflow/scripts/session-manager.js clear-active
```

Isso limpa a sessão ativa, permitindo edições em qualquer diretório.

## CLI do gerenciador de sessão

O script do gerenciador de sessão fornece controle direto:

```bash
# List all sessions
node .agileflow/scripts/session-manager.js list --json

# Get current session status
node .agileflow/scripts/session-manager.js status

# Switch active session (for boundary protection)
node .agileflow/scripts/session-manager.js switch 2

# Get currently active session
node .agileflow/scripts/session-manager.js active

# Clear active session (disable boundaries)
node .agileflow/scripts/session-manager.js clear-active

# Create new session
node .agileflow/scripts/session-manager.js create --nickname "feature"

# Delete session
node .agileflow/scripts/session-manager.js delete 2 --remove-worktree
```

## Melhores Práticas

### O que fazer

- **Use descriptive nicknames**: `bugfix`, `auth`, `experiment` são mais claros do que `session-2`
- **Switch sessions explicitly**: Sempre use `/agileflow:session:resume` mudar
- **Commit before switching**: certifique-se de que o trabalho seja salvo antes de alterar as sessões
- **End sessions when done**: Limpe as árvores de trabalho para economizar espaço em disco

### O que não fazer

- **Don't manually cd**: Usar `/add-dir` permanecer na mesma conversa de Claude
- **Don't disable boundaries casually**: Eles evitam a contaminação cruzada acidental
- **Don't create too many sessions**: Mantenha-o gerenciável (3-5 no máximo recomendado)

## Solução de problemas

### Erro "Editar bloqueado"

**Cause**: você está tentando editar um arquivo fora da sessão ativa.

**Solution**:
```
/agileflow:session:resume
```
Selecione a sessão correta e execute o `/add-dir` comando mostrado.

### Sessão não encontrada

**Cause**: o diretório da árvore de trabalho foi excluído ou movido.

**Solution**:
```bash
# Check if directory exists
ls ../project-{name}

# If missing, unregister the session
node .agileflow/scripts/session-manager.js delete {id}
```

### Conflitos da árvore de trabalho do Git

**Cause**: Ramificação já retirada em outra árvore de trabalho.

**Solution**:
```bash
# List worktrees
git worktree list

# Remove stale worktree
git worktree remove ../project-{name}
```

## Recursos relacionados

- [Controle de Danos](/docs/features/damage-control) - Proteção adicional de arquivos
- [Contexto Compacto](/docs/features/compact-context) - Preservação do contexto entre sessões
- [Agent Expertise](/docs/features/agent-expertise-system) - Agentes especializados para sessões
