---
title: Loop-Modus
description: Autonome Story-Verarbeitung mit Ralph Loop für die unkomplizierte epische Vervollständigung
---
# Loop-Modus

Der Loop-Modus ermöglicht die autonome Story-Verarbeitung durch das **Ralph Loop**-System von AgileFlow. Benannt nach dem „Ralph Wiggum“-Muster aus der Forschung von Anthropic zu Agenten-Workflows, verarbeitet es Geschichten automatisch in einem Epos ohne manuelles Eingreifen.

Der Schleifenmodus wird durch den Befehl [`/agileflow:babysit`](/commands/babysit) mit speziellen Parametern aktiviert. Babysit orchestriert den gesamten Prozess, während Ralph Loop die Automatisierung übernimmt.

## Übersicht

Wenn aktiviert, Loop-Modus:

1. Wählt die erste „fertige“ Geschichte aus einem Epos aus
2. Markiert es als „in_progress“ und beginnt mit der Implementierung
3. Wenn Claude stoppt, werden die Tests automatisch ausgeführt
4. Wenn die Tests erfolgreich sind → Markiert die Story als abgeschlossen und lädt die nächste Story
5. Wird fortgesetzt, bis Epic abgeschlossen ist oder die maximale Anzahl an Iterationen erreicht ist

Dies ermöglicht eine **Stapelverarbeitung über Nacht** von wohldefinierten Epics mit klaren Akzeptanzkriterien.

## Schnellstart

```bash
# Start loop mode for an epic
/agileflow:babysit EPIC=EP-0042 MODE=loop

# Or initialize directly via script
node .agileflow/scripts/ralph-loop.js --init --epic=EP-0042 --max=20
```

## Wie es funktioniert

### Der Stopphaken

Der Loop-Modus nutzt das Stop-Hook-System von Claude Code. Als Claude nicht mehr reagiertng:

1. Das Skript `ralph-loop.js` wird automatisch ausgeführt
2. Es führt den konfigurierten Testbefehl aus (Standard: `npm test`)
3. Basierend auf den Ergebnissen wird entweder mit der nächsten Story fortgefahren oder nach Korrekturen gefragt

<Bild>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/loop-mode-flow.dark.svg" />
  <img alt="Loop-Modus-Fluss" src="/images/docs/features/loop-mode-flow.light.svg" />
</Bild>

### Sitzungsstatus

Die Schleifenkonfiguration wird in `docs/09-agents/session-state.json` gespeichert:

```json
{
  "ralph_loop": {
    "enabled": true,
    "epic": "EP-0042",
    "current_story": "US-0015",
    "iteration": 3,
    "max_iterations": 20,
    "test_command": "npm test",
    "mode": "normal"
  }
}
```

## Parameter

| Parameter | Erforderlich | Standard | Beschreibung |
|-----------|----------|---------|-------------|
| `EPIC` | Ja | - | Zu verarbeitende epische ID (z. B. EP-0042) |
| `MODE` | Ja | - | Muss für den autonomen Modus `loop` sein |
| `MAX` | Nein | 20 | Maximale Iterationen vor dem Stoppen |

## CLI-Befehle

```bash
# Initialize loop for an epic
node .agileflow/scripts/ralph-loop.js --init --epic=EP-0042 --max=20

# Check current loop status
node .agileflow/scripts/ralph-loop.js --status

# Stop the loop gracefully
node .agileflow/scripts/ralph-loop.js --stop

# Reset loop state completely
node .agileflow/scripts/ralph-loop.js --reset

# Run one iteration manually
node .agileflow/scripts/ralph-loop.js --run
```

## Loop-Modi

### Normalmodus (Standard)

Standardtestbasierte Verifizierung:

```bash
/agileflow:babysit EPIC=EP-0042 MODE=loop
```

– Führt __NOTRANSLATE aus_29__ nach jedem Claude-Stopp
– Besteht, wenn alle Tests erfolgreich sind
– Schlägt fehl, wenn ein Test fehlschlägt

### Visueller Modus

Für UI-fokussierte Epics, die eine Screenshot-Überprüfung erfordern:

```bash
/agileflow:babysit EPIC=EP-0042 MODE=loop VISUAL=true
```

– Überprüft das Verzeichnis `screenshots/` auf Bilder
- Alle Screenshots müssen das Präfix `verified-` haben
– Nützlich für die Entwicklung von UI-Komponenten

Weitere Informationen finden Sie unter [Visual Mode](/features/visual-mode).

### Abdeckungsmodus

Für Anforderungen an die Testabdeckung:

```bash
/agileflow:babysit EPIC=EP-0042 MODE=loop COVERAGE=80
```

- Führt Tests mit Abdeckungsberichten durch
- Überprüft, ob die Abdeckung den Schwellenwert erreicht (z. B. 80 %).
– Schlägt fehl, wenn die Abdeckung unter den Schwellenwert fällt

## Story-Auswahl

Der Loop-Modus wählt Storys in dieser Prioritätsreihenfolge aus:

1. **Aktuelle Geschichte** – Falls eine bereits in Arbeit ist
2. **Ready Stories** – Stories mit dem Status „ready“ (alle Abhängigkeiten erfüllt)
3. **Blockierte Storys** – Übersprungen, bis die Blockierung aufgehoben wird

Geschichten müssen Folgendes enthalten:
- Klare Akzeptanzkriterien
- Alle Abhängigkeiten gelöst
- Status auf „bereit“ oder „ausstehend“ gesetzt

## Konfiguration

### Testbefehl

Konfigurieren Sie den Testbefehl in `agileflow-metadata.json`:

```json
{
  "loop": {
    "test_command": "npm test",
    "coverage_threshold": 70,
    "max_iterations": 20
  }
}
```

### Hook-Setup stoppen

Der Schleifenmodus erfordert den Stop-Hook in `.claude/settings.json`:

```json
{
  "hooks": {
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "node .agileflow/scripts/ralph-loop.js --run"
          }
        ]
      }
    ]
  }
}
```

## Wann man den Loop-Modus verwenden sollte

### Gut für

- ✅ Klar definierte Epen mit klaren Geschichten
- ✅ Testgetriebene Entwicklung (Tests definieren „erledigt“)
- ✅ Stapelverarbeitung mehrerer Geschichten über Nacht
- ✅ Wiederkehrende Implementierungsaufgaben (CRUD-Endpunkte, Komponenten)
- ✅ Geschichten mit automatisierten Akzeptanzkriterien

### Nicht gut für

- ❌ Sondierungsarbeiten ohne klare Akzeptanzkriterien
- ❌ Geschichten, die vor dem Fortfahren eine menschliche Überprüfung erfordern
- ❌ Komplexe Multi-Domain-Arbeit, die Koordination erfordert
- ❌ Erstmalige Implementierungen ohne Muster
- ❌ Geschichten mit externen Abhängigkeiten (APIs, Dienste)

## Beispiel-Workflow

### 1. Bereiten Sie das Epic vor

Stellen Sie sicher, dass alle Geschichten klare Akzeptanzkriterien haben:

```markdown
## US-0015: Add User List Component

**Acceptance Criteria:**
- [ ] Component renders list of users from API
- [ ] Loading state shown while fetching
- [ ] Error state displayed on failure
- [ ] Empty state when no users

**Tests:** src/components/UserList.test.tsx
```

### 2. Starten Sie den Loop-Modus

```bash
/agileflow:babysit EPIC=EP-0042 MODE=loop MAX=15
```

### 3. Überwachen Sie den Fortschritt

Überprüfen Sie den Status regelmäßig:

```bash
node .agileflow/scripts/ralph-loop.js --status
```

Ausgabe:
```
Loop Status:
  Epic: EP-0042
  Current Story: US-0017
  Iteration: 5 of 15
  Mode: normal
  Stories Completed: 4
  Stories Remaining: 3
```

### 4. Behandeln Sie Fehler

Wenn Tests fehlschlägt, zeigt der Schleifenmodus die Fehler an und arbeitet weiter:

```
❌ Tests failed for US-0017

Failures:
  - UserList.test.tsx: Expected 3 users, got 2

Continue fixing or run /agileflow:babysit --stop to pause.
```

### 5. Schließe das Epos ab

Wenn alle Geschichten fertig sind:

```
✅ Epic EP-0042 Complete!

Summary:
  - Stories Completed: 7
  - Total Iterations: 12
  - Time Elapsed: 2h 34m

All tests passing. Ready for review.
```

## Fehlerbehebung

### Schleife startet nicht

1. Überprüfen Sie, ob der Sitzungsstatus vorhanden ist:
   ```bash
   cat docs/09-agents/session-state.json
   ```

2. Überprüfen Sie, ob der Stopphaken konfiguriert ist:
   ```bash
   cat .claude/settings.json | grep -A5 "Stop"
   ```

3. Manuell initialisieren:
   ```bash
   node .agileflow/scripts/ralph-loop.js --init --epic=EP-0042
   ```

### Tests schlagen immer fehl

1. Führen Sie die Tests zunächst manuell durch:
   ```bash
   npm test
   ```

2. Testbefehl in der Konfiguration prüfen:
   ```bash
   cat docs/00-meta/agileflow-metadata.json | grep test_command
   ```

3. Stellen Sie sicher, dass Tests für die aktuelle Story vorhanden sind

### Schleife bleibt bei derselben Geschichte hängen

1. Überprüfen Sie die Anzahl der Iterationen:
   ```bash
   node .agileflow/scripts/ralph-loop.js --status
   ```

2. Wenn Sie sich der maximalen Anzahl an Iterationen nähern, entweder:
   - Beheben Sie das Blockierungsproblem
   - Story überspringen: Status auf „blockiert“ aktualisieren
   - Max erhöhen: `--max=30`

### Unerwartetes Anhalten

Die Schleife stoppt, wenn:
– Maximale Anzahl an Iterationen erreicht
- Episch abgeschlossen
- Manueller Stoppbefehl
- Kritischer Fehler bei der Testausführung

Weitere Informationen finden Sie in den Protokollen:
```bash
cat .agileflow/logs/ralph-loop.log
```

## Best Practices

### 1. Beginnen Sie mit der kleinen Folgeics

Testen Sie den Loop-Modus zunächst an einem 3- bis 5-stöckigen Epos, bevor Sie größere Serien erstellen.

### 2. Schreiben Sie zuerst Tests

Der Loop-Modus funktioniert am besten mit TDD – Tests definieren, wann eine Story „fertig“ ist.

### 3. Halten Sie die Geschichten fokussiert

Jede Geschichte sollte in 1–3 Iterationen abgeschlossen werden können. Große Geschichten → mehr Misserfolge.

### 4. Regelmäßig überwachen

Überprüfen Sie den Status bei langen Läufen alle 30–60 Minuten.

### 5. Verwenden Sie den visuellen Modus für die Benutzeroberfläche

Aktivieren Sie für UI-Arbeiten den visuellen Modus, um Rendering-Probleme zu erkennen, die Tests möglicherweise übersehen.

## Verwandte Funktionen

– [Visual Mode](/features/visual-mode) – Screenshot-Überprüfung für die UI-Entwicklung
- [Kompakter Kontext](/features/compact-context) – Kontexterhaltung während langer Sitzungen
- [`/agileflow:babysit`](/commands/babysit) – Der Mentor-Befehl, der den Schleifenmodus orchestriert
- [`/agileflow:verify`](/commands/verify) – Manuelle Testüberprüfung

## Architektur

Der Loop-Modus besteht aus:

| Komponente | Zweck |
|-----------|---------|
| `ralph-loop.js` | Hauptschleifen-Orchestrierungsskript |
| `screenshot-verifier.js` | Screenshot-Überprüfung im visuellen ModusKönig |
| `session-state.json` | Schleifenkonfiguration und -status |
| Stopphaken | Claude Code-Integrationspunkt |

Der Name „Ralph“ stammt aus der Forschungsarbeit von Anthropic zu Agenten-Workflows, in der „Ralph Wiggum“ als Codename für autonome Aufgabenerledigungsmuster verwendet wurde.