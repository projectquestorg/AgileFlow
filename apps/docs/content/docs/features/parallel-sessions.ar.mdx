---
title: الجلسات الموازية
description: يمكنك العمل على ميزات متعددة في وقت واحد باستخدام أشجار عمل git المعزولة وحماية حدود الجلسة.
---

# الجلسات الموازية

تتيح لك الجلسات المتوازية العمل على ميزات أو أخطاء أو تجارب متعددة في وقت واحد دون الحاجة إلى تبديل السياق. تحتوي كل جلسة على دليلها المعزول وفرع git وحماية الحدود لمنع التعديلات غير المقصودة عبر الجلسات.

## ملخص

عند العمل في مشاريع معقدة، غالبًا ما تحتاج إلى:
- إصلاح الخلل أثناء تقدم الميزة
- قم بالتجربة دون التأثير على عملك الرئيسي
- مراجعة التعليمات البرمجية في فرع واحد أثناء التطوير في فرع آخر

تعمل الجلسات المتوازية على حل هذه المشكلة عن طريق إنشاء مساحات عمل معزولة باستخدام **git worktrees**، يتم تتبع كل منها بواسطة AgileFlow مع حماية الحدود التلقائية.

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-overview.dark.svg" />
  <img alt="Parallel Sessions Overview" src="/images/docs/features/parallel-sessions-overview.light.svg" />
</picture>

## الميزات الرئيسية

| Feature | Description |
|---------|-------------|
| **Git Worktrees** | Each session is a separate directory with its own branch |
| **Boundary Protection** | Edit/Write hooks prevent accidental cross-session edits |
| **Session Tracking** | AgileFlow tracks all sessions with status, stories, and activity |
| **Easy Switching** | Switch sessions with `/add-dir` - stays in same terminal |
| **Independent Context** | Each session maintains its own story and progress |

## كيف يعمل

### بنيان

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-arch.dark.svg" />
  <img alt="Parallel Sessions Architecture" src="/images/docs/features/parallel-sessions-arch.light.svg" />
</picture>

### إدارة حالة الجلسة

يتم تتبع الجلسات في ملفين:

**Registry** (`.agileflow/sessions/registry.json`):
```json
{
  "sessions": [
    {
      "id": "1",
      "path": "/home/user/project",
      "branch": "main",
      "is_main": true,
      "nickname": null
    },
    {
      "id": "2",
      "path": "/home/user/project-bugfix",
      "branch": "session-2-bugfix",
      "is_main": false,
      "nickname": "bugfix"
    }
  ]
}
```

**Active Session** (`docs/09-agents/session-state.json`):
```json
{
  "active_session": {
    "id": "2",
    "nickname": "bugfix",
    "path": "/home/user/project-bugfix",
    "branch": "session-2-bugfix",
    "switched_at": "2025-01-12T10:30:00Z"
  }
}
```

### حماية الحدود

يتم تشغيل خطاف حدود الجلسة في كل عملية تحرير وكتابة:

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="/images/docs/features/parallel-sessions-boundary.dark.svg" />
  <img alt="Session Boundary Protection Flow" src="/images/docs/features/parallel-sessions-boundary.light.svg" />
</picture>

**Protection Logic:**
```javascript
// File is allowed if:
// 1. No active session is set (normal behavior)
// 2. File path starts with active session path

const isAllowed =
  !activeSession ||
  filePath.startsWith(activeSession.path + '/') ||
  filePath === activeSession.path;
```

## الأوامر

### إنشاء جلسة جديدة

```
/agileflow:session:new
```

إنشاء جلسة متوازية جديدة مع الخيارات:
- **Auto-create**: يولد `../project-{id}` مع فرع `session-{id}`
- **Named**: يخلق `../project-{name}` مع اللقب المخصص
- **Existing branch**: يستخدم فرع بوابة موجود

**Output:**
```
Created Session 2 "bugfix"

┌───────────┬────────────────────────────────────────────┐
│ Session   │ 2 "bugfix"                                 │
│ Workspace │ ../project-bugfix                          │
│ Branch    │ session-2-bugfix                           │
└───────────┴────────────────────────────────────────────┘

To switch to this session, run:

  /add-dir ../project-bugfix
```

### تبديل الجلسات

```
/agileflow:session:resume
```

يسرد كافة الجلسات ويوفر الأمر للتبديل:

```
Which session would you like to resume?

○ Session 1: main (current)
  US-0042: User Auth API │ Active now │ /home/user/project

○ Session 2: "bugfix"
  US-0038: Fix Login │ Active now │ ../project-bugfix

○ Create new session
  Start a fresh parallel workspace
```

بعد الاختيار:
```
To switch to Session 2 "bugfix":

  /add-dir ../project-bugfix
```

### عرض حالة الجلسة

```
/agileflow:session:status
```

يعرض معلومات الجلسة الحالية وجميع الجلسات المسجلة.

### نهاية الجلسة

```
/agileflow:session:end
```

يُنهي الجلسة الحالية واختياريًا:
- يدمج التغييرات مرة أخرى إلى الرئيسي
- حذف شجرة العمل
- ينظف الفرع

## مثال سير العمل

### بدء إصلاح الأخطاء أثناء عمل الميزة

```
# You're working on Session 1 (main) with US-0042: User Auth API

User: I need to quickly fix a login bug, but don't want to lose my current work

Claude: I'll create a new session for the bug fix.

> /agileflow:session:new

Created Session 2 "bugfix"
To switch: /add-dir ../project-bugfix

User: /add-dir ../project-bugfix

# Now working in Session 2
# Claude can only edit files in ../project-bugfix
# Any attempt to edit files in the main project is BLOCKED

User: Fix the login validation bug

Claude: [Fixes bug in ../project-bugfix/src/auth/login.ts]

User: Done, let's go back to main work

> /agileflow:session:resume
> Select: Session 1: main

To switch: /add-dir /home/user/project

User: /add-dir /home/user/project

# Back in Session 1, boundary protection now blocks edits to ../project-bugfix
```

## إعدادات

### تمكين حماية حدود الجلسة

يتم تكوين خطافات حدود الجلسة تلقائيًا عند استخدام جلسات متوازية. يتم إضافتهم إلى `.claude/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "node .agileflow/scripts/session-boundary.js"
          }
        ]
      },
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "node .agileflow/scripts/session-boundary.js"
          }
        ]
      }
    ]
  }
}
```

### تعطيل حماية الحدود

للعمل عبر الجلسات دون قيود:

```bash
node .agileflow/scripts/session-manager.js clear-active
```

يؤدي هذا إلى مسح الجلسة النشطة، مما يسمح بإجراء تعديلات على أي دليل.

## مدير الجلسة CLI

يوفر البرنامج النصي لمدير الجلسة التحكم المباشر:

```bash
# List all sessions
node .agileflow/scripts/session-manager.js list --json

# Get current session status
node .agileflow/scripts/session-manager.js status

# Switch active session (for boundary protection)
node .agileflow/scripts/session-manager.js switch 2

# Get currently active session
node .agileflow/scripts/session-manager.js active

# Clear active session (disable boundaries)
node .agileflow/scripts/session-manager.js clear-active

# Create new session
node .agileflow/scripts/session-manager.js create --nickname "feature"

# Delete session
node .agileflow/scripts/session-manager.js delete 2 --remove-worktree
```

## أفضل الممارسات

### افعل

- **Use descriptive nicknames**: `bugfix`, `auth`, `experiment` هي أوضح من `session-2`
- **Switch sessions explicitly**: استخدم دائمًا `/agileflow:session:resume` للتبديل
- **Commit before switching**: تأكد من حفظ العمل قبل تغيير الجلسات
- **End sessions when done**: تنظيف أشجار العمل لتوفير مساحة القرص

### لا تفعل ذلك

- **Don't manually cd**: يستخدم `/add-dir` للبقاء في نفس محادثة كلود
- **Don't disable boundaries casually**: تمنع التلوث العرضي
- **Don't create too many sessions**: اجعلها قابلة للإدارة (يوصى بـ 3-5 كحد أقصى)

## استكشاف الأخطاء وإصلاحها

### خطأ "تم حظر التعديل".

**Cause**: أنت تحاول تحرير ملف خارج الجلسة النشطة.

**Solution**:
```
/agileflow:session:resume
```
حدد الجلسة الصحيحة، ثم قم بتشغيل `/add-dir` يظهر الأمر.

### لم يتم العثور على الجلسة

**Cause**: تم حذف دليل شجرة العمل أو نقله.

**Solution**:
```bash
# Check if directory exists
ls ../project-{name}

# If missing, unregister the session
node .agileflow/scripts/session-manager.js delete {id}
```

### تعارضات Git Worktree

**Cause**: تم سحب الفرع بالفعل في شجرة عمل أخرى.

**Solution**:
```bash
# List worktrees
git worktree list

# Remove stale worktree
git worktree remove ../project-{name}
```

## الميزات ذات الصلة

- [السيطرة على الأضرار](/docs/features/damage-control) - حماية إضافية للملفات
- [سياق مدمج](/docs/features/compact-context) - الحفاظ على السياق عبر الجلسات
- [خبرة الوكيل](/docs/features/agent-expertise-system) - وكلاء متخصصون للجلسات
