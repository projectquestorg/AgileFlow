---
title: الحفاظ على السياق المضغوط
description: كيف يحافظ وكلاء AgileFlow على المعرفة الهامة أثناء ضغط السياق التلقائي
---
# الحفاظ على السياق المضغوط

يستخدم وكلاء AgileFlow تكوين **compact_context** للحفاظ على المعرفة الهامة والحالة عندما يقوم Claude Code بضغط سياق المحادثة تلقائيًا. تضمن هذه الميزة أن يحافظ الوكلاء على التركيز، ويستمرون في اتباع القواعد الأساسية، وتتبع الحالة الحالية حتى أثناء المحادثات الموسعة التي تؤدي إلى ضغط السياق.

## المشكلة: فقدان السياق أثناء الضغط

عندما تطول المحادثات، يقوم Claude Code تلقائيًا بضغط السياق ليظل ضمن الحدود الرمزية. هذا الضغط يمكن أن يسبب:

- **القواعد المفقودة**: ينسى الوكلاء القواعد السلوكية المهمة (على سبيل المثال، "تحميل الخبرة أولاً"، "التحقق من اجتياز الاختبارات قبل المراجعة")
- **الحالة المفقودة**: يفقد الوكلاء متابعة العمل الحالي (القصة التي يعملون فيها، وما الذي يمنعهم، وما الذي تم إنجازه)
- **الأولويات المفقودة**: ينسى الوكلاء المهام العاجلة (على سبيل المثال، إلغاء حظر قصص AG-UI)
- **تأخير إعادة التركيز**: يهدر الوكلاء الرموز المميزة لإعادة قراءة الخبرة والسياق بعد الضغط

وهذا أمر مثير للمشاكل بشكل خاصج ل:
- **ميزات طويلة الأمد**: تنفيذ لعدة أيام مع العشرات من عمليات التبادل
- **الوكلاء التابعون**: واجهة المستخدم في انتظار نقاط نهاية واجهة برمجة التطبيقات، وكلاهما يحتاج إلى تركيز مستمر
- **التنسيق النقدي**: يقوم المرشد بتنسيق عدة وكلاء في وقت واحد

## الحل: سياق مدمج

يحدد كل وكيل تكوين `compact_context` بثلاثة مكونات:

### 1. مستوى الأولوية

يحدد مدى قوة الحفاظ على سياق الوكيل أثناء الضغط:

__لا تترجم_0__

**مستويات الأولوية**:
- `critical` (2 وكيل): يتم الحفاظ عليه دائمًا حتى في حالة الضغط الشديد
  - معلمه، وكيل API
  - التعامل مع التنسيق والتنفيذ الأساسي
- `high` (8 عوامل): محفوظ في معظم عمليات الضغط
  - واجهة المستخدم، قاعدة البيانات، CI، DevOps، الاختبار، الأمان، التوثيق، الأداء
  - تشغيل العمل طويل الأمد بتركيز مستمر
- `medium` (15 وكيلًا): يتم الاحتفاظ بها عندما يكون ذلك ممكنًا
  - معظم الوكلاء المتخصصين (التحليلات والتكاملات والهواتف المحمولة وما إلى ذلك)
  - التعامل مع المجال المحددج المهام
- `low` (2 وكيل): أول من تتم إزالته
  - الوكلاء الاستشاريون، نادرًا ما يتم استخدامهم (مخطط ملحمي، منسق)
  - مشمول فقط إذا سمحت الغرفة بذلك

### 2. الحفاظ على القواعد

القواعد السلوكية الأساسية التي لا يجب فقدانها أبدًا:

__لا تترجم_1__

**قواعد جيدة للحفظ**:
- الهوية والدور (على سبيل المثال، "أنت AG-API")
- قيود السلامة الحرجة (على سبيل المثال، "عدم تشفير الأسرار مطلقًا")
- الإجراءات التي يجب اتباعها (على سبيل المثال، "تحميل الخبرة أولاً")
- بروتوكولات التنسيق (على سبيل المثال، "تحديث Status.json قبل وبعد العمل")
- متطلبات إدارة الحالة (على سبيل المثال، "التحقق من حالة الاختبار قبل المراجعة")
- الأولويات السلوكية (على سبيل المثال، "إعطاء الأولوية لإلغاء حظر AG-UI")

**قواعد سيئة** (لا تحتفظ بها):
- تعليمات سير العمل خطوة بخطوة (يمكن إعادة استخلاصها من الحالة)
- معلومات عامة متوفرة في ملفات الخبرة
- التفاصيل الخاصة بالسياق (تلك التي تدخل في حقول_الحالة بدلاً من ذلك)

### 3. حقول الدولة

الحالة الديناميكية التي تتغير أثناء العمل:

__لا تترجم_2__

** حقول الحالة تحافظ على العمل الحاليالسياق **:
- ما القصة التي يتم تنفيذها الآن
- ما هي نقاط النهاية تتم، والتي هي في انتظار
- أي القصص المحظورة على ماذا
- خط الأساس لحالة الاختبار (يجب اجتيازه قبل المراجعة)
- اكتشاف المشكلات المعروفة أو الديون الفنية

## مثال حقيقي: وكيل API

يوضح وكيل واجهة برمجة التطبيقات Compact_context أثناء العمل:

__لا تترجم_3__

**ما يحفظه هذا**:
- الأولويات الحاسمة (إلغاء حظر واجهة المستخدم أولاً)
- قواعد السلامة (التحقق من الاختبار، التعامل السري)
- الحالة الحالية (ما هي نقاط النهاية التي تم إنجازها، وما الذي يحظر واجهة المستخدم)
- اختبار خط الأساس (ضروري لتحديد متى يتم إنجاز العمل)

أثناء تنفيذ واجهة برمجة التطبيقات (API) لمدة يومين مع أكثر من 50 بورصة:
1. يحدث ضغط السياق بعد حوالي 30 عملية تبادل
2. قواعد المحافظة تذكر الوكيل بالتحقق من اجتياز الاختبارات (ليس اختياريًا)
3. تعرض حقول الحالة قصص واجهة المستخدم المحظورة (فحص الأولوية)
4. يستمر الوكيل دون فقدان الزخم أو إعادة التركيز

## جميع تكوينات الوكيل

### الأولوية الحاسمة (وكلاء 2)

**مرشد**
__لا تترجم_4__

**واجهة برمجة التطبيقات**
__لا تترجم_5__

###أولوية عالية (8 وكلاء)

** واجهة المستخدم **
__لا تترجم_6__

**قاعدة البيانات**
__لا تترجم_7__

**الاختبار**
__لا تترجم_8__

**ci، devops، الأمان، التوثيق، الأداء** يستخدم أيضًا `priority: high` مع القواعد الخاصة بالمجال وحقول الحالة.

### الأولوية المتوسطة (15 وكيلًا)

وكلاء متخصصون في التحليلات، وعمليات التكامل، والهواتف المحمولة، والامتثال، والتصميم، وترحيل البيانات، وضمان الجودة، وإمكانية الوصول، والمراقبة، وكاتب الإعلانات، والبحث، وإعادة البناء، ومحدث الملف التمهيدي.

تستخدم جميعها `priority: medium` مع قواعد الاحتفاظ وحقول الحالة الخاصة بالمجال.

## كيف يعمل السياق المضغوط عمليًا

### مثال: تنفيذ واجهة برمجة التطبيقات لمدة يومين

**اليوم الأول - الصباح**:
1. يقوم الوكيل بتحميل الخبرة (2 رمزًا)
2. يقرأ سياق قاعدة التعليمات البرمجية بحجم 30 كيلو بايت (8 رموز مميزة)
3. تنفيذ نقطة النهاية الأولى (5 عمليات تبادل، و15 رمزًا مميزًا)
4. **الإجمالي حتى الآن: 25 رمزًا بميزانية 200 ألف**

**اليوم الأول - بعد الظهر**:
1. يستمر مع نقطة النهاية التالية (8 تبادلات، 24 رمزًا)
2. الاختبارات والتحسين (6 عمليات تبادل، 18 رمزًا)
3. **الاقتراب من عتبة الضغط (~40 رمزًا مميزًا)**

** بيفضغط الخام** (بدون سياق_مضغوط):
- وكيل يعيد تحميل الخبرة (2 الرموز)
- يقوم الوكيل بإعادة قراءة قاعدة التعليمات البرمجية (8 رموز)
- يقوم الوكيل بإعادة مراجعة القصص غير المحظورة (3 رموز)
- **إهدار 13 رمزًا إضافيًا وفقدان الزخم**

**مع Compact_context** (أولوية بالغة الأهمية):
- تذكير بالحفاظ على القواعد: تحميل الخبرة، وفحص أدوات الحظر، والتحقق من الاختبارات
- تذكير حقول الحالة: العمل على US-0042، تم الانتهاء من 3 نقاط نهاية، وتم حظر قصتين لواجهة المستخدم
- تم ضغط سياق قاعدة التعليمات البرمجية مؤقتًا ولكن تم الحفاظ على المعرفة المهمة
- ** يستأنف الوكيل العمل فورًا دون الحاجة إلى إعادة القراءة **

**اليوم الثاني - الصباح**:
1. تتم إعادة ضغط السياق مرة أخرى
2. يقوم الوكيل بإعادة توسيع خبرته (رمز مميز واحد - تم تحميله بالفعل)
3. السيرة الذاتية مع معرفة السياق الكامل:
   - ما هي القصص المحظورة (المعرفة ذات الأولوية)
   - اختبار متطلبات خط الأساس (معرفة السلامة)
   - ما تم تنفيذه بالفعل (معرفة الدولة)
4. يستمر مع نقطة النهاية النهائية (5 تبادلات، 15 رمزًا مميزًا)
5. الاختبار النهائي والمراجعة (4 عمليات تبادل، 12 رمزًا)

**كسب الكفاءة**: ~20 رمزًا مميزًايتم حفظه، والحفاظ على التركيز المستمر، دون أي تأخير في إعادة التركيز.

## عندما يحدث الضغط

يقوم كلود كود بضغط السياق عندما:
- يقترب استخدام الرمز المميز من الحد الأقصى للنموذج (حوالي 180 ألفًا من ميزانية 200 ألفًا)
- المحادثة بها العديد من التبادلات (اتفاقيات للحفاظ على الأجزاء المهمة)
- فترات خمول طويلة (ضغط دوري لبداية جديدة)
- يقوم المستخدم بتشغيل الضغط يدويًا

## تنفيذ السياق المضغوط

### للوكلاء الحاليين

إضافة إلى المادة الأمامية للوكيل:

__لا تترجم_9__

### أفضل الممارسات

1. **حافظ على تركيز القواعد**: 5-7 قواعد كحد أقصى
2. **استخدم حقول الحالة للسياق**: لا تضع تفاصيل الحالة في قواعد الحفظ
3. **ملفات الخبرة المرجعية**: يجب أن تشير القواعد إلى الخبرة، وليس تكرارها
4. **تحديث الحالة أثناء العمل**: اذكر الحالة الحالية بانتظام في الردود
5. **مطابقة الأولوية بالتأثير**: التأثير الأعلى = أولوية أعلى
6. **المستند في النص الرئيسي**: اشرح Compact_context في وثائق الوكيل

### ما لا ينبغي الحفاظ عليه

- سير العمل الإجرائي الطويل (يمكن إعادة استخلاصه من stأكل)
- معلومات أساسية عامة (غنية بالخبرة)
- مقتطفات أو أمثلة من التعليمات البرمجية (محفوظة في الخبرة أو قاعدة التعليمات البرمجية)
- تفسيرات مطولة (استخدم قواعد موجزة بدلاً من ذلك)
- معلومات زائدة عن الحاجة (تجنب الازدواجية مع الحفاظ على القواعد)

## مصفوفة أولوية الوكيل

| الوكيل | الأولوية | الأثر إذا ضاع | قابلية الاسترداد |
|-------|----------|---|---|
| معلمه | حرجة | لا يمكن تنسيق التنفيذ | صعب - يحتاج إلى إعادة تحميل السياق بالكامل |
| واجهة برمجة التطبيقات | حرجة | لا يمكن إكمال نقاط النهاية، مما يؤدي إلى حظر واجهة المستخدم | صعب - يفقد تتبع مانع |
| واجهة المستخدم | عالية | يفقد حالة نظام التصميم | متوسط ​​- للخبرة أنماط |
| قاعدة بيانات | عالية | يفقد قرارات تصميم المخطط | معتدل - الهجرات في بوابة |
| اختبار | عالية | استراتيجية التغطية تفقد | متوسط ​​- توجد ملفات اختبار |
| سي | عالية | يفقد تكوين البناء | معتدل - البرامج النصية في بوابة |
| ديبوبس | عالية | يفقد استراتيجية النشر | معتدل - المستندات/الهندسة المعمارية موجودة |
| الأمن | عالية | يفقد نموذج التهديد | متوسط ​​- للخبرة أنماط |
| يفعلترقيم | عالية | يفقد تتبع التغطية | متوسط ​​- للخبرة أنماط |
| الأداء | عالية | يفقد أهداف التحسين | معتدل - المقاييس في الكود |
| بحث | متوسطة | يفقد مذكرات البحث | سهل - ملاحظات في المستندات/10-الأبحاث |
| تحليلات | متوسطة | يفقد أهداف الأجهزة | سهل - يمكن إعادة تحليل المتطلبات |
| التكامل | متوسطة | يفقد تفاصيل تكامل واجهة برمجة التطبيقات | سهل – الخبرة لها أنماط |
| الجوال | متوسطة | يخسر القرارات الخاصة بالمنصة | سهل – الخبرة لها أنماط |

## أنماط السياق المضغوط الشائعة

### النموذج 1: قواعد السلامة الحرجة

بالنسبة للوكلاء الذين يتعاملون مع العمليات الحساسة (واجهة برمجة التطبيقات، الأمان، قاعدة البيانات):

__لا تترجم_10__

### النمط 2: التنسيق – العمل الشاق

بالنسبة للوكلاء الذين يقومون بإلغاء حظر الآخرين (واجهة برمجة التطبيقات، واجهة المستخدم، قاعدة البيانات):

__لا تترجم_11__

### النموذج 3: عمل بوابة الجودة

بالنسبة للوكلاء الذين يقومون بالبوابة على حالة الاختبار (الاختبار، CI، الأداء):

__لا تترجم_12__

### النموذج 4: ميزات طويلة الأمد

بالنسبة للوكلاء الذين يعملون على ميزات متعددة الأيام (المرشد، API،واجهة المستخدم):

__لا تترجم_13__

## مراقبة فعالية السياق المضغوط

### علامات السياق المضغوط يعمل

- يحافظ الوكلاء على سلوك متسق بعد ضغط السياق
- لا حاجة لإعادة التركيز أو إعادة القراءة بعد الضغط
- تستمر الاختبارات في المرور دون إعادة التشغيل
- التنسيق بين الوكلاء يظل سلسًا
- مشاكل أقل في "السياق المفقود" في المحادثات الطويلة

### علامات أن السياق المضغوط يحتاج إلى تعديل

- ينسى الوكيل فحص الحاصرات بعد الضغط
- يفقد العميل تتبع حالة القصة في منتصف المحادثة
- يتم نسيان القواعد المهمة ولكن يتم الرجوع إليها في التبادلات المستقبلية
- يصبح تتبع الدولة غير متناسق
- يتغير سلوك الوكيل بشكل ملحوظ بعد الضغط

### تصحيح السياق المضغوط

1. **تأكد من الحفاظ على وضوح القواعد**: هل هي موجزة وقابلة للتنفيذ؟
2. **التحقق من حقول الحالة**: هل يتم تحديثها بالفعل أثناء العمل؟
3. **مراجعة ملاءمة الأولوية**: هل أولوية الوكيل مناسبة لتأثيرها؟
4. **الاختبار بعد الضغط**: التحقق يدويًا من السلوك بعد الضغط
5. **اقرأتعليقات الخبراء**: تحقق من ناقل الرسائل لمعرفة مشكلات التنسيق

## الميزات ذات الصلة

- **ملفات الخبرة**: قاعدة معرفية طويلة المدى تكمل Compact_context
- **التحكم في الأضرار**: يمنع تغييرات التعليمات البرمجية غير المقصودة من خلال التأكيد متعدد الخطوات
- **أداة الجلسة**: التحقق من صحة خط الأساس لحالة الاختبار (المشار إليه في النص المضغوط الخاص بمعظم الوكلاء)
- **نظام المهارات**: يتم تحميل قدرات الوكيل الديناميكية عند الطلب

## الخطوات التالية

- قم بمراجعة تكوين `compact_context` الخاص بوكيلك في `packages/cli/src/core/agents/`
- في حالة إنشاء وكلاء جدد، قم بتحديد Compact_context بمستوى الأولوية المناسب
- بالنسبة للميزات طويلة المدى، قم بمراقبة فعالية ضغط السياق
- تحديث قواعد الحفظ عند اكتشاف أنماط سلوكية حرجة جديدة