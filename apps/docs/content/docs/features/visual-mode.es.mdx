---
title: Modo visual
description: Sistema de verificación de capturas de pantalla para el desarrollo de UI con protocolo de prefijo verificado
---

# Modo visual

El modo visual es un sistema de verificación de capturas de pantalla para el desarrollo de la interfaz de usuario que garantiza que todos los resultados visuales se revisen y aprueben antes de que una historia se marque como completa.

## Descripción general

Al desarrollar componentes de interfaz de usuario, es posible que las pruebas por sí solas no detecten problemas visuales como:
- Problemas de diseño
- Inconsistencias de estilo
- Problemas de diseño responsivo
- Regresiones visuales

El modo visual soluciona esto al requerir que todas las capturas de pantalla sean **verified** (con el prefijo `verified-`) antes de continuar.

## Cómo funciona

### El protocolo de prefijo verificado

1. Durante el desarrollo de la interfaz de usuario, las capturas de pantalla se guardan en `screenshots/` directorio
2. Las nuevas capturas de pantalla se guardan sin prefijo (p. ej., `login-form.png`)
3. Después de la revisión visual, las capturas de pantalla aprobadas cambian de nombre con `verified-` prefijo
4. El modo visual comprueba que TODAS las capturas de pantalla tengan la `verified-` prefijo
5. Si existen capturas de pantalla no verificadas, el bucle se detiene para su revisión.

<imagen>
  <fuente media="(prefiere-color-esquema: oscuro)" srcset="/images/docs/features/visual-mode-protocol.dark.svg" />
  <img alt="Protocolo de prefijo verificado" src="/images/docs/features/visual-mode-protocol.light.svg" />
</imagen>

## Inicio rápido

Habilite el modo visual en modo bucle:

```bash
/agileflow:babysit EPIC=EP-0042 MODE=loop VISUAL=true
```

O ejecute el verificador directamente:

```bash
node .agileflow/scripts/screenshot-verifier.js
```

## Flujo de trabajo de captura de pantalla

### 1. Tome capturas de pantalla durante el desarrollo

Al implementar componentes de la interfaz de usuario, guarde capturas de pantalla:

```typescript
// In your test or component
await page.screenshot({ path: 'screenshots/user-profile.png' });
```

O manualmente con las herramientas de desarrollo del navegador.

### 2. Revisar capturas de pantalla

El modo visual se detiene cuando se encuentran capturas de pantalla no verificadas:

```
⚠️ Visual Mode: Unverified screenshots found

Unverified:
  - screenshots/user-profile.png
  - screenshots/settings-modal.png

Please review these screenshots and rename with 'verified-' prefix
when approved, or delete if issues found.
```

### 3. Verificar o arreglar

**If the screenshot looks correct:**
```bash
mv screenshots/user-profile.png screenshots/verified-user-profile.png
```

**If issues are found:**
- Corregir el código de la interfaz de usuario
- Vuelva a tomar la captura de pantalla
- Revisar nuevamente

### 4. Continuar

Una vez que se verifican todas las capturas de pantalla, el ciclo continúa automáticamente.

## Script de verificación

### Uso

```bash
# Check all screenshots
node .agileflow/scripts/screenshot-verifier.js

# Check specific directory
node .agileflow/scripts/screenshot-verifier.js --dir=tests/screenshots

# Verbose output
node .agileflow/scripts/screenshot-verifier.js --verbose
```

### Códigos de salida

| Code | Meaning |
|------|---------|
| 0 | All screenshots verified |
| 1 | Unverified screenshots found |
| 2 | Error during verification |

### Ejemplos de salida

**All Verified:**
```
✅ Visual Mode: All screenshots verified

Verified: 5
  - verified-login-form.png
  - verified-user-profile.png
  - verified-settings-modal.png
  - verified-dashboard.png
  - verified-error-state.png
```

**Unverified Found:**
```
❌ Visual Mode: 2 unverified screenshots

Verified: 3
Unverified: 2
  - new-feature.png
  - updated-header.png

Action required: Review and verify or delete unverified screenshots.
```

## Configuración

### En estado de sesión

Configuración del Modo Visual en `session-state.json`:

```json
{
  "ralph_loop": {
    "enabled": true,
    "mode": "visual",
    "visual_config": {
      "screenshots_dir": "screenshots",
      "verified_prefix": "verified-",
      "extensions": [".png", ".jpg", ".jpeg", ".webp"]
    }
  }
}
```

### En metadatos

Configuración predeterminada en `agileflow-metadata.json`:

```json
{
  "visual_mode": {
    "enabled": false,
    "screenshots_dir": "screenshots",
    "verified_prefix": "verified-",
    "auto_cleanup": true
  }
}
```

### Opciones

| Option | Default | Description |
|--------|---------|-------------|
| `screenshots_dir` | `screenshots` | Directory to scan for screenshots |
| `verified_prefix` | `verified-` | Prefix required for verified screenshots |
| `extensions` | `[".png", ".jpg", ".jpeg", ".webp"]` | Image file extensions to check |
| `auto_cleanup` | `true` | Remove verified screenshots after epic completion |

## Integración con el modo bucle

El modo visual funciona como un paso de verificación adicional en [Modo de bucle](/features/loop-mode):

<imagen>
  <source media="(prefiere-color-scheme: oscuro)" srcset="/images/docs/features/visual-mode-loop.dark.svg" />
  <img alt="Integración de bucle en modo visual" src="/images/docs/features/visual-mode-loop.light.svg" />
</imagen>

## Cuándo utilizar el modo visual

### Bueno para

- ✅ Desarrollo de componentes de interfaz de usuario
- ✅ Diseño de implementaciones de sistemas.
- ✅ Responsive layout work
- ✅ Prevención de regresión visual
- ✅ Controles visuales de accesibilidad
- ✅ Trabajos de tematización y estilismo.

### No es bueno para

- ❌ Desarrollo de backend/API
- ❌ Migraciones de bases de datos
- ❌ Configuración CI/CD
- ❌ Funciones no visuales
- ❌ Flujos de trabajo automatizados solo para pruebas

## Mejores prácticas

### 1. Nomenclatura coherente de capturas de pantalla

Utilice nombres descriptivos y coherentes:

```
✅ Good:
  - login-form-default.png
  - login-form-error.png
  - login-form-loading.png

❌ Bad:
  - screenshot1.png
  - test.png
  - final-final-v2.png
```

### 2. Capture varios estados

Captura de pantalla de todos los estados de los componentes:

```typescript
// Default state
await page.screenshot({ path: 'screenshots/button-default.png' });

// Hover state
await button.hover();
await page.screenshot({ path: 'screenshots/button-hover.png' });

// Disabled state
await page.setContent('<button disabled>Click</button>');
await page.screenshot({ path: 'screenshots/button-disabled.png' });
```

### 3. Incluir contexto

Captura de pantalla con suficiente contexto para comprender el componente:

```typescript
// Too narrow - just the button
await button.screenshot({ path: 'screenshots/button.png' });

// Better - button with surrounding context
await page.screenshot({
  path: 'screenshots/button-in-form.png',
  clip: { x: 0, y: 100, width: 400, height: 200 }
});
```

### 4. Limpieza después de la verificación

Elimina capturas de pantalla antiguas verificadas cuando se completen las historias:

```bash
# Manual cleanup
rm screenshots/verified-*.png

# Or enable auto_cleanup in config
```

### 5. Apariencia esperada del documento

Agregue notas sobre lo que debería mostrar la captura de pantalla:

```markdown
## Screenshots

### verified-login-form.png
- Form with email and password fields
- Blue submit button
- "Forgot password?" link below
- No error states visible
```

## Solución de problemas

### Capturas de pantalla no detectadas

1. Verifique la ruta del directorio:
   ```bash
   ls screenshots/
   ```

2. Verifique que las extensiones de archivo sean correctas:
   ```bash
   file screenshots/*.png
   ```

3. Verifique la ruta de configuración en session-state.json

### La verificación no se está ejecutando

1. Asegúrese de que el modo visual esté habilitado:
   ```bash
   cat docs/09-agents/session-state.json | grep visual
   ```

2. Check Loop Mode is active:
   ```bash
   node .agileflow/scripts/ralph-loop.js --status
   ```

### Falsos positivos

Si las capturas de pantalla se marcan incorrectamente:

1. Revisa la ortografía del prefijo: `verified-` (tenga en cuenta el guión)
2. Compruebe si hay caracteres ocultos en el nombre del archivo
3. Verificar que el archivo sea en realidad una imagen

## Flujo de trabajo de ejemplo

### Historia de UI: agregar componente de avatar de usuario

**1. Story starts, Claude implements component:**
```typescript
// src/components/Avatar.tsx
export function Avatar({ src, name, size = 'md' }) {
  return (
    <img
      src={src}
      alt={name}
      className={`avatar avatar-${size}`}
    />
  );
}
```

**2. Claude takes screenshots:**
```bash
screenshots/
  avatar-small.png
  avatar-medium.png
  avatar-large.png
  avatar-fallback.png
```

**3. Visual Mode pauses:**
```
⚠️ Visual Mode: 4 unverified screenshots

Please review and verify:
  - avatar-small.png
  - avatar-medium.png
  - avatar-large.png
  - avatar-fallback.png
```

**4. You review and verify:**
```bash
# All look good
for f in screenshots/avatar-*.png; do
  mv "$f" "screenshots/verified-$(basename $f)"
done
```

**5. Loop continues to next story**

## Funciones relacionadas

- [Modo de bucle](/features/loop-mode) - Procesamiento autónomo de historias.
- [Control de daños](/features/damage-control) - Protección contra operaciones destructivas
- [`/agileflow:verificar`](/commands/verify) - Comando de verificación manual

## Arquitectura

| Component | Purpose |
|-----------|---------|
| `screenshot-verifier.js` | Main verification script |
| `ralph-loop.js` | Orchestrates Visual Mode checks |
| `session-state.json` | Stores Visual Mode configuration |
| `screenshots/` | Default screenshot directory |

Visual Mode se integra con el gancho de parada de Loop Mode para proporcionar verificación visual junto con pruebas automatizadas.
