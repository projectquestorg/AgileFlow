---
title: Configura√ß√£o
description: Guia completo para o sistema de configura√ß√£o do AgileFlow ‚Äì 9 agentes para personalizar seu fluxo de trabalho de desenvolvimento
---

# Sistema de configura√ß√£o

O sistema de configura√ß√£o do AgileFlow fornece 9 agentes especializados que configuram, personalizam e verificam todos os aspectos do seu fluxo de trabalho de desenvolvimento. Acesse-os atrav√©s `/agileflow:configure`.

## In√≠cio r√°pido

```bash
# Interactive wizard - guides you through all options
/agileflow:configure

# Detect current configuration
/agileflow:configure --detect

# Enable specific features
/agileflow:configure --enable=damage-control,status-line,archival

# Upgrade to latest versions
/agileflow:configure --upgrade
```

## Os 9 Agentes de Configura√ß√£o

| Agent | Purpose | Key Feature |
|-------|---------|-------------|
| **git-config** | Initialize git and remote repos | SSH/HTTPS support |
| **hooks** | Event-driven automation | SessionStart, PreCompact, Stop |
| **precompact** | Context preservation | Survives conversation compression |
| **status-line** | Custom status bar | Story, WIP, context display |
| **archival** | Auto-manage status.json | Threshold-based cleanup |
| **attribution** | Git commit policy | Control AI disclosure |
| **ci** | CI/CD workflows | GitHub Actions, GitLab, CircleCI |
| **damage-control** | Destructive command protection | Pattern-based blocking |
| **verify** | Test configurations | Token management |

## Ordem de configura√ß√£o recomendada

```
Phase 1: Foundation (10-15 min)
‚îú‚îÄ 1. git-config      ‚Üí Enable version control
‚îú‚îÄ 2. hooks           ‚Üí Enable automation
‚îî‚îÄ 3. attribution     ‚Üí Establish commit policy

Phase 2: Safety (5-10 min)
‚îú‚îÄ 4. damage-control  ‚Üí Protect codebase
‚îî‚îÄ 5. verify          ‚Üí Validate setup

Phase 3: Productivity (15-20 min)
‚îú‚îÄ 6. archival        ‚Üí Manage status.json size
‚îú‚îÄ 7. status-line     ‚Üí Real-time visibility
‚îú‚îÄ 8. ci              ‚Üí Automated testing
‚îî‚îÄ 9. precompact      ‚Üí Long conversation support
```

---

## Detalhes do agente

### 1. Configura√ß√£o do Git

**Purpose:** Inicialize o reposit√≥rio git e conecte-se ao remoto (GitHub, GitLab, etc.)

**What it does:**
- Inicializa o reposit√≥rio git, se necess√°rio
- Configura URL remota (SSH ou HTTPS)
- Verifica a conex√£o remota
- Armazena configura√ß√£o em metadados

**Options:**
```
Initialize git:      Yes / No
Remote protocol:     SSH / HTTPS
Private repo:        Yes / No (for auth)
Verify connection:   Yes / No
```

**Files modified:**
- `.git/` - Reposit√≥rio Git
- `docs/00-meta/agileflow-metadata.json` - Configura√ß√£o do Git armazenada
- `.claude/settings.local.json` - Tokens (se necess√°rio)

---

### 2. Sistema de ganchos

**Purpose:** Habilite a automa√ß√£o orientada a eventos por meio dos ganchos de Claude Code

**Available hooks:**
- **SessionStart** - Informa√ß√µes de boas-vindas quando o Claude Code for iniciado
- **PreCompact** - Preservar o contexto antes da compacta√ß√£o
- **Stop** - Resumo da sess√£o quando Claude para
- **UserPromptSubmit** - Registro de atividades

**Options:**
```
SessionStart:        Enable / Disable
PreCompact:          Enable / Disable
Stop:                Enable / Disable
UserPromptSubmit:    Enable / Disable
```

**Files created:**
- `.claude/settings.json` - Configura√ß√£o de gancho
- `scripts/agileflow-welcome.js` - Script SessionStart
- `scripts/precompact-context.sh` - Script pr√©-compacto
- `scripts/agileflow-stop.sh` - Parar script de gancho

**Important:** Requer a reinicializa√ß√£o do Claude Code para que os ganchos tenham efeito.

---

### 3. Configura√ß√£o pr√©-compactada

**Purpose:** Preserve o contexto cr√≠tico do projeto quando Claude Code compacta as conversas

**Benefits:**
- As conven√ß√µes do projeto sobrevivem √† compress√£o
- Regras de comando ativas preservadas
- Hist√≥ria atual e status de WIP mantidos
- As conven√ß√µes de equipe n√£o se perdem

**Example output during compact:**
```
Project: MyProject v2.40.0 | Branch: main

Active Stories:
- US-0042 (in-progress): Login API
- US-0043 (blocked): Payment Integration

WIP Count: 2/3
Context Preservation: ENABLED
```

**Requires:** Sistema de ganchos configurado primeiro

---

### 4. Configura√ß√£o da linha de status

**Purpose:** Configure uma barra de status personalizada no Claude Code

**Available components:**
- ID e t√≠tulo da hist√≥ria atual
- Progresso √©pico (hist√≥rias X/Y)
- Contagem de WIP versus limite de WIP
- Porcentagem de uso de contexto
- Custo da sess√£o em USD
- Nome da ramifica√ß√£o Git

**Example status lines:**
```
[Opus] US-0042: Login API | WIP 2/3 | 45% ctx | main
agileflow v2.40.0 | US-0003 | main
```

**Options:**
```
Display components:  story, epic, wip, context, cost, git (multiselect)
Show git branch:     Yes / No
```

**Important:** Requer reinicializa√ß√£o do Claude Code.

---

### 5. Configura√ß√£o de arquivamento

**Purpose:** Gerenciar automaticamente o tamanho do arquivo status.json

**Why it matters:**
- status.json pode exceder o limite de 25 mil tokens
- Quando muito grande, os agentes n√£o conseguem l√™-lo
- O arquivamento autom√°tico evita isso silenciosamente

**Threshold options:**
- **30 days** (recomendado) - Equil√≠brio entre contexto e hist√≥ria
- **14 days** - Projetos em r√°pida evolu√ß√£o
- **7 days** - Equipes grandes com muitas hist√≥rias
- **3 days** - Muito agressivo, status.json m√≠nimo

**Archive structure:**
```
docs/09-agents/
‚îú‚îÄ‚îÄ status.json           # Active work
‚îú‚îÄ‚îÄ status-archive.json   # Historical
‚îî‚îÄ‚îÄ archive/
    ‚îú‚îÄ‚îÄ 2025-01.json      # Monthly archives
    ‚îî‚îÄ‚îÄ 2025-02.json
```

**Manual commands:**
```bash
# Archive with default threshold
bash scripts/archive-completed-stories.sh

# Archive with custom threshold (days)
bash scripts/archive-completed-stories.sh 7

# Compress status.json (removes verbose fields)
bash scripts/compress-status.sh
```

---

### 6. Configura√ß√£o de atribui√ß√£o

**Purpose:** Configurar prefer√™ncias de atribui√ß√£o do git commit

**Options:**
- **No attribution** (recomendado): commits limpos sem men√ß√µes de IA
- **Keep attribution** (padr√£o): Incluir rodap√© do C√≥digo Claude

**Example CLAUDE.md with disabled attribution:**
```markdown
## CRITICAL: NO AI Attribution in Git Commits

‚ùå FORBIDDEN:
- ü§ñ Generated with Claude Code
- Co-Authored-By: Claude

‚úÖ REQUIRED:
- Clean, professional commit messages
- Conventional commit format
```

---

### 7. Configura√ß√£o CI/CD

**Purpose:** Configure fluxos de trabalho de integra√ß√£o cont√≠nua

**Supported providers:**
- A√ß√µes do GitHub (`.github/workflows/ci.yml`)
- CI do GitLab (`.gitlab-ci.yml`)
- C√≠rculoCI (`.circleci/config.yml`)

**Configurable commands:**
- Instalar depend√™ncias
- Execute testes
- Execute o linter
- Execute o verificador de tipo
- Construir projeto

**Options:**
```
CI provider:         GitHub Actions / GitLab CI / CircleCI
Commands to run:     install, test, lint, type-check, build (multiselect)
Test locally:        Yes / No
Trigger remote CI:   Yes / No
```

---

### 8. Configura√ß√£o de controle de danos

**Purpose:** Proteja sua base de c√≥digo contra comandos destrutivos

Ver [Controle de Danos](/docs/features/damage-control) para documenta√ß√£o completa.

**Protection levels:**
- **Standard** - Correspond√™ncia r√°pida de padr√µes, mais de 40 padr√µes
- **Enhanced** - Avalia√ß√£o padr√£o + IA
- **Minimal** - Somente prote√ß√£o de caminho

**Options:**
```
Protection level:    Standard / Enhanced / Minimal
Custom protections:  Prod DB / Cloud CLI / Env files (multiselect)
```

---

### 9. Agente de verifica√ß√£o

**Purpose:** Testar e validar configura√ß√µes funcionam corretamente

**What it validates:**
- Sintaxe do arquivo JSON (configura√ß√µes, metadados)
- Execu√ß√£o de script de gancho
- Sintaxe do fluxo de trabalho YAML
- Comandos CI (teste local)
- Conex√µes remotas

**Token management:**
- Armazena tokens em `.claude/settings.local.json` (gitignorado)
- Suporta tokens GitHub, GitLab, CircleCI
- Nunca ecoa tokens para consolar

---

## Organiza√ß√£o de arquivos

```
project/
‚îú‚îÄ‚îÄ .github/workflows/ci.yml          # GitHub Actions
‚îú‚îÄ‚îÄ .claude/
‚îÇ   ‚îú‚îÄ‚îÄ settings.json                 # Hooks & status line (committed)
‚îÇ   ‚îú‚îÄ‚îÄ settings.local.json           # User overrides (gitignored)
‚îÇ   ‚îî‚îÄ‚îÄ settings.local.example.json   # Template for team
‚îú‚îÄ‚îÄ .agileflow/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ damage-control-patterns.yaml
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ agileflow-welcome.js
‚îÇ   ‚îú‚îÄ‚îÄ agileflow-statusline.sh
‚îÇ   ‚îî‚îÄ‚îÄ precompact-context.sh
‚îú‚îÄ‚îÄ CLAUDE.md                         # Project guidelines
‚îî‚îÄ‚îÄ docs/00-meta/
    ‚îî‚îÄ‚îÄ agileflow-metadata.json       # Configuration metadata
```

## Regras do Gitignore

**Committed (team configuration):**
- `.claude/settings.json`
- `.claude/settings.local.example.json`
- `.github/workflows/`
- `CLAUDE.md`
- `scripts/`
- `.agileflow/`

**Gitignored (user-specific):**
- `.claude/settings.local.json`
- `.claude/prompt-log.txt`
- `.claude/*.log`

## Refer√™ncia de token

### Token GitHub (ghp_xxx)
- **Location:** `.claude/settings.local.json`
- **Scopes needed:** `repo`, `workflow`
- **Create at:** https://github.com/settings/tokens/new

### Token GitLab (glpat_xxx)
- **Location:** `.claude/settings.local.json`
- **Scopes needed:** `api`, `read_repository`, `write_repository`
- **Create at:** https://gitlab.com/-/profile/personal_access_tokens

### Token CircleCI
- **Location:** `.claude/settings.local.json`
- **Create at:** https://app.circleci.com/settings/user/tokens

## Solu√ß√£o de problemas

| Problem | Cause | Solution |
|---------|-------|----------|
| Config not taking effect | Claude Code not restarted | Quit (Cmd+Q) and restart |
| Token auth fails | Expired/invalid token | Regenerate at provider |
| YAML syntax error | Invalid workflow file | Validate with yamllint |
| status.json too large | Exceeds token limit | Enable archival (3-7 days) |
| Hooks don't run | settings.json invalid | Check JSON with `jq` |
| Status line missing | Script not executable | `chmod +x scripts/*.sh` |

### Requisito de reinicializa√ß√£o

Esses agentes exigem **Claude Code restart**:
- ganchos
- pr√©-compactado
- linha de status
- controle de danos

```bash
# Complete quit (not just closing window)
Cmd+Q (Mac) or Ctrl+Q (Windows/Linux)
# Wait 5 seconds, then reopen
```

### Reverter

```bash
# Restore from git
git checkout .claude/settings.json

# Remove problematic hook
jq 'del(.hooks.HookName)' .claude/settings.json > tmp.json && mv tmp.json .claude/settings.json

# Disable all hooks
jq 'del(.hooks)' .claude/settings.json > tmp.json && mv tmp.json .claude/settings.json
```

## Cen√°rios Comuns

### Nova configura√ß√£o do projeto
```bash
/agileflow:configure  # Select: Git Repository
/agileflow:configure  # Select: Hooks System
/agileflow:configure  # Select: Damage Control
/agileflow:configure  # Select: Verification
```

### Adicionar CI/CD
```bash
/agileflow:configure  # Select: CI/CD Workflow
# Choose provider, commands, test locally
git add .github/workflows/ci.yml
git commit -m "ci: add GitHub Actions workflow"
```

### Otimize para grandes projetos
```bash
/agileflow:configure  # Select: Archival (7-14 days)
/agileflow:configure  # Select: Status Line
/agileflow:configure  # Select: PreCompact
```
