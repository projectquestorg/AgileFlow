---
title: WebSocket API
description: WebSocket message protocol reference for the dashboard
---

# WebSocket API Reference

The dashboard communicates with the CLI server using a JSON-based WebSocket protocol.

## Connection

```
ws://localhost:8765
```

All messages are JSON-encoded strings sent over the WebSocket connection.

## Message Envelope

Every message includes a `type` field and a `timestamp`:

```json
{
  "type": "message_type",
  "timestamp": "2026-01-15T10:30:00.000Z",
  "...": "additional fields"
}
```

## Outbound Messages (Server to Dashboard)

| Type | Description | Key Fields |
|------|-------------|------------|
| `session_state` | Session connected/state change | `sessionId`, `state`, `resumed` |
| `session_error` | Session error | `message` |
| `text` | Complete text response | `content`, `done` |
| `text_delta` | Streaming text chunk | `delta`, `done` |
| `tool_start` | Tool call started | `id`, `tool`, `input` |
| `tool_result` | Tool call completed | `id`, `output`, `error`, `success` |
| `git_status` | Git status update | `branch`, `staged[]`, `unstaged[]` |
| `git_diff` | Diff content | `path`, `diff`, `additions`, `deletions`, `staged` |
| `status_update` | Project status | `total`, `done`, `inProgress`, `ready`, `blocked`, `epics[]` |
| `task_created` | Task created | `task` |
| `task_updated` | Task status changed | `task` |
| `task_list` | Full task list | `tasks[]` |
| `terminal_output` | Terminal output | `terminalId`, `data` |
| `terminal_exit` | Terminal exited | `terminalId`, `exitCode` |
| `automation_list` | All automations | `automations[]` |
| `automation_status` | Automation state change | `automationId`, `status` |
| `inbox_list` | All inbox items | `items[]` |
| `inbox_item` | Single inbox item | `id`, `title`, `summary`, `status` |
| `ask_user_question` | User question prompt | `toolId`, `questions[]` |
| `notification` | General notification | `level`, `title`, `message` |
| `team_metrics` | Team metrics update | `trace_id`, `per_agent`, `per_gate` |
| `error` | Error | `code`, `message` |
| `session_list` | Session list with sync status | `sessions[]` |

## Inbound Messages (Dashboard to Server)

| Type | Description | Key Fields |
|------|-------------|------------|
| `message` | User message | `content` |
| `cancel` | Cancel operation | - |
| `refresh` | Request refresh | `what` (git, tasks, status, automations, inbox, team_metrics, all) |
| `session_init` | Initialize session | `sessionId`, `apiKey` |
| `session_close` | Close session | - |
| `git_stage` | Stage files | `files[]` |
| `git_unstage` | Unstage files | `files[]` |
| `git_revert` | Revert files | `files[]` |
| `git_commit` | Create commit | `message`, `push` |
| `git_diff_request` | Request file diff | `path`, `staged` |
| `open_file` | Open file in editor | `path`, `line` |
| `terminal_spawn` | Spawn terminal | `cols`, `rows` |
| `terminal_input` | Terminal stdin | `terminalId`, `data` |
| `terminal_resize` | Resize terminal | `terminalId`, `cols`, `rows` |
| `terminal_close` | Close terminal | `terminalId` |
| `automation_run` | Run automation | `id` |
| `automation_stop` | Stop automation | `id` |
| `automation_list_request` | List automations | - |
| `inbox_list_request` | List inbox | - |
| `inbox_action` | Inbox action | `id`, `action` (read, accept, dismiss) |
| `user_answer` | Answer to question | `toolId`, `answers` |

## Example: Git Status Response

```json
{
  "type": "git_status",
  "branch": "main",
  "staged": [
    { "path": "src/app.ts", "status": "modified" }
  ],
  "unstaged": [
    { "path": "README.md", "status": "modified", "additions": 5, "deletions": 2 }
  ],
  "timestamp": "2026-01-15T10:30:00.000Z"
}
```

## Example: Status Update

```json
{
  "type": "status_update",
  "total": 66,
  "done": 55,
  "inProgress": 2,
  "ready": 9,
  "blocked": 0,
  "epics": [
    {
      "id": "EP-0031",
      "title": "Dashboard",
      "status": "in-progress",
      "storyCount": 66,
      "doneCount": 55
    }
  ],
  "timestamp": "2026-01-15T10:30:00.000Z"
}
```

## Example: Text Streaming

```json
// First chunk
{ "type": "text_delta", "delta": "Here is ", "done": false, "timestamp": "..." }

// More chunks
{ "type": "text_delta", "delta": "my response.", "done": false, "timestamp": "..." }

// Final chunk
{ "type": "text_delta", "delta": "", "done": true, "timestamp": "..." }
```

## Example: Team Metrics

```json
{
  "type": "team_metrics",
  "trace_id": "trace-abc123",
  "per_agent": {
    "AG-PLANNING": {
      "status": "completed",
      "tokens_in": 45000,
      "tokens_out": 12000,
      "duration_ms": 3400
    },
    "AG-IMPLEMENTATION": {
      "status": "in-progress",
      "tokens_in": 28000,
      "tokens_out": 8500,
      "duration_ms": 2100
    }
  },
  "per_gate": {
    "context_gathering": {
      "status": "completed",
      "agents": ["AG-PLANNING"],
      "duration_ms": 1200
    },
    "implementation": {
      "status": "in-progress",
      "agents": ["AG-IMPLEMENTATION"],
      "duration_ms": 2100
    }
  },
  "timestamp": "2026-02-15T14:30:00.000Z"
}
```

Team metrics are sent:
- When a session connects (if metrics exist)
- When the client requests a refresh
- When metrics are updated in `docs/09-agents/session-state.json`

Each `trace_id` represents a unique execution context. Per-agent metrics show performance per agent, while per-gate metrics show performance per quality gate.
