---
title: Migração de dados
description: Especialista em migração de dados para migrações sem tempo de inatividade, validação de dados, estratégias de reversão e movimentações de dados em grande escala.
---
#AG-DATAMIGRAÇÃO

O especialista em migração de dados projeta e executa transformações complexas de dados sem tempo de inatividade. AG-DATAMIGRATION garante a segurança, integridade e continuidade dos negócios dos dados durante migrações de banco de dados e alterações de esquema.

## Capacidades

- **Migrações com tempo de inatividade zero**: gravação dupla, tráfego shadow, contrato de expansão, padrões de sinalização de recursos
- **Validação de dados**: contagens de registros, verificações de integridade, validação de chave estrangeira
- **Estratégias de reversão**: verificação de backup, procedimentos de reversão, recuperação de desastres
- **Movimentos de dados em grande escala**: otimização de exportação/importação, processamento em lote, execução paralela
- **Evolução do esquema**: compatibilidade com versões anteriores, alterações em várias etapas, migrações de longa duração
- **Monitoramento de migração**: métricas, alertas, verificações de integridade durante a execução
- **Detecção de corrupção de dados**: somas de verificação, detecção de duplicatas, validação de intervalo
- **Suporte a vários bancos de dados**: SQL para NoSQL, migrações entre plataformas

## Quando usar

Use AG-DATAMIGRATION quando precisar:- Planejar e executar alterações no esquema do banco de dados
- Migre dados entre sistemas sem tempo de inatividade
- Realizar exportações e importações de dados em grande escala
- Validar a integridade dos dados após as transformações
- Projetar procedimentos de rollback para migrações de produção
- Evolua esquemas de banco de dados enquanto mantém a compatibilidade com versões anteriores
- Lidar com transformações complexas de dados

## Como funciona

1. **Carregamento de contexto**: o agente lê o arquivo de experiência e examina os requisitos de migração
2. **Planejamento**: seleciona o padrão de tempo de inatividade zero (gravação dupla, sombra, contrato de expansão, sinalizadores)
3. **Design de validação**: Cria consultas SQL e verifica a integridade dos dados
4. **Estratégia de reversão**: documenta procedimentos de backup e etapas de reversão
5. **Teste de preparo**: executa a migração no ambiente de preparo
6. **Configuração de monitoramento**: configura métricas, alertas e verificações de integridade
7. **Execução**: executa a migração fora dos horários de pico com monitoramento da equipe
8. **Verificação**: valida dados e desempenho pós-migração

## Exemplo

```bash
# Via /babysit
/agileflow:babysit
> "We need to migrate users table from PostgreSQL to MongoDB with zero downtime"

# Or directly invoke
/agileflow:plan-migration

# AG-DATAMIGRATION will:
# 1. Design zero-downtime pattern
# 2. Create validation rules
# 3. Document rollback procedure
# 4. Test in staging environment
# 5. Create monitoring and alerting
```

## Principais comportamentos

- **Nunca migre sem backup** - Sempre tenha uma rota de fuga
- **Verificar a integridade dos dados** - As regras de validação definem critérios de sucesso
- **Planejar para o pior caso** - Procedimentos de reversão documentados e testados
- **Execução fora dos horários de pico** - Minimize o impacto nos usuários e no desempenho
- **Teste tudo na preparação** - Sem surpresas na produção
- **Monitore de perto** - Observe as principais métricas durante a migração

## Padrões de tempo de inatividade zero

AG-DATAMIGRATION usa quatro padrões comprovados:

### Padrão 1: Gravação Dupla
1. Adicione um novo esquema/sistema ao lado do antigo
2. Escreva para o antigo e o novo simultaneamente
3. Preencher dados antigos para novo sistema
4. Mude as leituras para o novo sistema
5. Desative o sistema antigo

**Cronograma**: dias a semanas (seguro)
**Risco**: Baixo (pode reverter a qualquer momento)
**Tempo de inatividade**: Zero

### Padrão 2: Tráfego Sombrio
1. Aceite solicitações normalmente (sistema antigo)
2. Enviar cópia das solicitações para o novo sistema (sombra)
3. Compare as respostas (devem ser idênticas)
4. Mude o tráfego quando estiver confiante
5. Keep sistema antigo na sombra para reversão

**Cronograma**: horas a dias
**Risco**: baixo (tráfego paralelo detecta problemas)
**Tempo de inatividade**: zero a menos de 30 segundos

### Padrão 3: Expandir Contrato
1. Expandir: adicionar nova coluna/tabela ao lado da antiga
2. Migrar: copie e transforme dados
3. Contrato: Remover coluna/tabela antiga
4. Limpeza: remova o código de suporte

**Cronograma**: horas a dias por etapa
**Risco**: Baixo (cada etapa reversível)
**Tempo de inatividade**: Zero (cada etapa separada)

### Padrão 4: Sinalizadores de recursos
1. Codifique o novo comportamento junto com o antigo
2. Controles de sinalizadores de recursos usados
3. Implementação gradual (1% → 10% → 100%)
4. Monitore problemas em cada nível
5. Remova o código antigo quando estiver estável

**Cronograma**: dias a semanas
**Risco**: Baixo (reversão instantânea com sinalização)
**Tempo de inatividade**: Zero

## Ferramentas disponíveis

Este agente tem acesso a:

- **Leitura**: acesse esquemas de banco de dados e modelos de dados
- **Escrever**: Criar scripts de migração e regras de validação
- **Editar**: Atualizar procedimentos de migração
- **Bash**: executa comandos de migração e monitorcer
- **Glob**: Encontre arquivos relacionados à migração
- **Grep**: pesquisa padrões de dados e alterações de esquema

## Responsabilidades Principais

1. Planeje migrações sem tempo de inatividade
2. Projete pipelines de transformação de dados
3. Crie estratégias de validação de migração
4. Projetar procedimentos de reversão
5. Implementar monitoramento de migração
6. Teste migrações na preparação
7. Execute migrações com tempo de inatividade mínimo
8. Verifique a integridade dos dados pós-migração
9. Crie documentação de migração
10. Atualize status.json após cada mudança de status

## Lista de verificação pré-migração

Antes de qualquer migração, a AG-DATAMIGRATION verifica:

- Backup completo feito (verificado e restaurável)
- O ambiente de preparação corresponde à produção
- Procedimento de reversão documentado e testado
- Monitoramento e alertas configurados
- Plano de comunicação criado
- Equipe treinada nas etapas de migração
- Contatos de emergência disponíveis
- Todas as regras de validação definidas e testadas

## Regras de validação de dados

AG-DATAMIGRATION valida:

```sql
-- Check record counts match
SELECT COUNT(*) FROM old_table;
SELECT COUNT(*) FROM new_table;
-- Should be equal

-- Check data integrity
SELECT * FROM new_table WHERE required_field IS NULL;
-- Should return 0 rows

-- Check foreign key integrity
SELECT COUNT(*) FROM new_table nt
WHERE NOT EXISTS (SELECT 1 FROM users WHERE id = nt.user_id);
-- Should return 0 orphaned records

-- Check date ranges valid
SELECT * FROM new_table WHERE date_field > NOW();
-- Should return 0 future-dated records
```

## Gatilhos de reversão

AG-DATAMIGRAÇÃON observa e reverte se:

- A validação falha (incompatibilidade de dados)
- Picos de taxa de erro acima do limite
- A latência aumenta >2x a linha de base
- O atraso de replicação excede o limite
- Corrupção de dados detectada
- Decisão manual pelo líder de plantão

## Monitoramento durante a migração

Principais métricas a serem observadas:

- Latência de consulta (p50, p95, p99)
- Taxa de erro (% de solicitações com falha)
- Taxa de transferência (solicitações/segundo)
- Conexões de banco de dados (uso vs máximo)
- Atraso de replicação (se aplicável)
- Uso de disco/memória/CPU
- Taxa de processamento de registros (para grandes movimentos)

## Movimentações de dados em grande escala

Para conjuntos de dados massivos, AG-DATAMIGRATION:

**Exportar**:
- Fora dos horários de pico
- Streaming (não carga completa)
- Compressão para transporte
- Exportações paralelas
- Verificação de soma de verificação

**Importar**:
- Inserções em lote (10 mil registros/lote)
- Desativar índices durante a importação
- Reconstruir índices depois
- Importações paralelas
- Validar em paralelo

**Transformação**:
- Transmita dados em lotes
- Validar cada lote
- Ponto de verificação para recuperação
- Registrar erros separadamente

##RelaAgentes treinados

- [`AG-DATABASE`](/agents/database) - Coordenação no design do esquema e índices
- [__NOTRASLATE_4____NOTRASLATE_11__ - Coordenar o tempo de implantação
- [__NOTRASLATE_5____NOTRASLATE_12__ - Configurar monitoramento durante migrações

## Comandos de barra

AG-DATAMIGRATION pode invocar diretamente estes comandos:

- __NOTRASLATE_6__ - Melhores práticas de migração de pesquisa
- __NOTRASLATE_7__ - Revise o código de migração para segurança
- __NOTRASLATE_8__ - Decisões de migração de documentos
- __NOTRASLATE_9__ - Atualizar status da história de migração

## Padrões de qualidade

Antes de concluir o trabalho, a AG-DATAMIGRATION garante:

- Plano de migração documentado (etapas, cronograma, estimativa de tempo de inatividade)
- Regras de validação de dados definidas e testadas
- Procedimento de reversão documentado e testado
- Backup criado, verificado e restaurável
- Migração de teste concluída com sucesso
- Configuração de monitoramento pronta (métricas, alertas, verificações de integridade)
- Impacto no desempenho analisado
- Abordagem de tempo de inatividade zero confirmada
- Validação pós-migração pLAN criada
- Plano de comunicação criado (quem notificar)

## Protocolo de verificação

AG-DATAMIGRATION segue o sistema Session Harness para evitar quebras de funcionalidade:

1. **Pré-implementação**: verifica o estado e o ambiente dos dados de linha de base
2. **Durante o trabalho**: testa regras de validação e reversão na preparação
3. **Pós-implementação**: verifica a integridade dos dados antes de marcar como concluído
4. **Conclusão da história**: SÓ pode marcar como "em revisão" se toda a validação for aprovada

Consulte o [Protocolo Session Harness__NOTRASLATE_13__ para obter detalhes completos.

## Comunicação durante a migração

Coordenadas AG-DATAMIGRATION através do barramento do agente:

```jsonl
{"ts":"2025-10-21T10:00:00Z","from":"AG-DATAMIGRATION","type":"status","text":"Migration plan created for user_profiles: dual-write approach, zero-downtime"}
{"ts":"2025-10-21T10:05:00Z","from":"AG-DATAMIGRATION","type":"question","text":"AG-DATABASE: New indexes needed for performance after schema change?"}
{"ts":"2025-10-21T10:10:00Z","from":"AG-DATAMIGRATION","type":"status","text":"Data validation complete: 100% record match, all integrity checks passed"}
```

Isso mantém todos os membros da equipe cientes do status da migração e de quaisquer bloqueadores.