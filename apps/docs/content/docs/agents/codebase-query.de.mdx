---
title: Codebasisabfrage
description: Intelligente Codebasissuche mit programmatischen Abfragen anstelle von RAG. Übersetzt natürliche Sprache in strukturierte Abfragen für eine schnelle, gezielte Code-Exploration.
---
# Codebase-Abfrageagent

Der Codebase Query Agent ist Ihr Spezialist für die schnelle, gezielte Codebasis-Exploration mithilfe der programmatischen Suche (RLM-Muster). Dieser Agent übersetzt Fragen in natürlicher Sprache in strukturierte Abfragen und ermöglicht so eine effiziente Codeerkennung, ohne ganze Dateien in den Kontext zu laden.

## Fähigkeiten

- **Übersetzung in natürlicher Sprache**: Konvertieren Sie Fragen wie „Wo wird die Authentifizierung gehandhabt?“ in strukturierte Abfragen umwandeln
- **Dateimustersuche**: Suchen Sie Dateien nach globalen Mustern und Namenskonventionen
- **Inhaltssuche**: Sucht im Grep-Stil nach Codemustern, Funktionsnamen und Text
- **Tag-basierte Suche**: Dateien nach semantischen Tags suchen (API, UI, Auth, Datenbank, Test)
- **Erkennung exportieren**: Lokalisieren Sie, wo Symbole exportiert und verwendet werden
- **Abhängigkeitszuordnung**: Zeigt an, welche Dateien von einer bestimmten Datei importiert/importiert werden
- **Token-Budgetverwaltung**: Beachten Sie Kontextbeschränkungen, indem Sie große Ergebnisse abschneiden

## Wann zu verwenden

Verwenden Sie diesen Agenten, wenn Sie Folgendes benötigen:

- Suchen Sie nach Dateien, die sich auf eine Funktion beziehen (authentifiziert).on, API, Datenbank usw.)
- Suchen Sie Funktionsdefinitionen oder Exporte
- Entdecken Sie Dateiabhängigkeiten und Importketten
- Durchsuchen Sie Codeinhalte, ohne ganze Dateien zu lesen
- Erkunden Sie schnell eine unbekannte Codebasis
- Erstellen Sie einen Kontext für die Implementierung einer Funktion

## Wie es funktioniert

### Abfrageübersetzung

Der Agent übersetzt natürliche Sprache in strukturierte Abfragen:

| Benutzer sagt | Abfragetyp | Übersetzung |
|-----------|------------|-------------|
| „Wo erfolgt die Authentifizierung?“ | Tag + Abfrage | `--tag="auth"` + `--query="auth"` |
| „Welche Dateien nutzen die Login-Funktion?“ | exportieren | `--export="login"` |
| „Dateien mit Fehlerbehandlung finden“ | Inhalt | `--content="try.*catch"` |
| „Zeige mir API-Routen“ | Tag | `--tag="api"` |
| „Wovon hängt user.ts ab?“ | deps | `--deps="src/user.ts"` |
| „Datenbankschemadateien“ | Tag + Abfrage | `--tag="database"` + `--query="schema"` |
| „Komponenten mithilfe von Hooks reagieren“ | Inhalt | `--content="use(State\|Effect\|Ref)"` |
| „Alle Testdateien“ | Tag | `--tag="test"` |

### Verfügbares Tags

| Tag | Übereinstimmungen |
|-----|---------|
| API | `/api/`, `/routes/`, `/controllers/` |
| ui | `/components/`, `/views/`, `/pages/` |
| Authentifizierung | `/auth/`, `/login/`, `/jwt/` |
| Datenbank | `/db/`, `/models/`, `/migrations/` |
| testen | `/test/`, `/__tests__/`, `/spec/` |
| config | `/config/`, `/settings/` |
| lib | `/lib/`, `/utils/`, `/helpers/` |

### Arbeitsablauf

1. **Abfrage analysieren**: Verstehen Sie, wonach der Benutzer sucht
2. **Übersetzen**: Konvertieren Sie natürliche Sprache in strukturierte Abfragetypen
3. **Index prüfen**: Stellen Sie sicher, dass der Codebasisindex verfügbar ist (bei Bedarf erstellen)
4. **Abfrage ausführen**: Abfrage mit entsprechenden Flags ausführen
5. **Ergebnisse formatieren**: Dateipfade mit Kontext zurückgeben
6. **Bei Bedarf abschneiden**: Beachten Sie die Token-Budgetgrenzen

## Beispiel

```bash
# Via /babysit
/agileflow:babysit
> "Where is authentication handled in this codebase?"
```

Der Codebase Query Agent würde:
1. Übersetzen in: `--tag="auth"` + `--query="auth"`
2. Index prüfen/erstellen
3. Suchen Sie nach Dateien, die den Authentifizierungsmustern entsprechen
4. Strukturierte Ergebnisse zurückgeben:
```
Query: "authentication files"
Translation: --tag="auth" + --query="auth"
Found: 8 files

Files:
- src/api/auth.ts (api, auth)
- src/middleware/auth.ts (auth)
- src/lib/jwt.ts (auth, lib)
- src/hooks/useAuth.ts (ui, auth)
...

[Context: Searched for files tagged 'auth' and matching 'auth' pattern]
```

## Schlüsselverhalten

- **NUR LESEN**: Dieser Agent kann keine Dateien schreiben, bearbeiten oder ändern
- **Index-First**: Prüft/erstellt immer den Codebasisindex vor der Abfrage
- **Token-Aware**: Ergebnisse werden gekürzt, um innerhalb des Budgets zu bleiben (Standard: 15.000 Zeichen)
- **Strukturierte Ausgabe**: Gibt ein konsistentes Format mit Abfrage, Übersetzung und Ergebnissen zurück
- **Fallback-Strategie**: Verwendet Glob/Grep direkt, wenn der Index nicht verfügbar ist

## Werkzeuge verfügbar

Dieser Agent hat Zugriff auf:
- **Lesen**: Durchsuchen Sie Dateien, um den Kontext zu verstehen
- **Glob**: Musterbasierte Dateierkennung
- **Grep**: Inhaltsbasierte Suche

**Auffälliges Fehlen** (schreibgeschützter Agent):
- Kein Schreibtool
- Kein Bearbeitungstool
- Kein Bash-Tool (außer zum Ausführen eines Abfrageskripts)

## Abfragetypen

### Muster-/Schlüsselwortabfrage
```bash
--query="auth"
```
Intelligente Suche, die Glob-Muster, Tag-Abgleich und Exportsuche kombiniert.

### Inhaltssuche
```bash
--content="validateToken"
```
Suche nach Text im Grep-Stilinnerhalb von Dateien.

### Tag-Suche
```bash
--tag="api"
```
Finden Sie Dateien, die semantischen Tag-Mustern entsprechen.

### Suche exportieren
```bash
--export="login"
```
Suchen Sie nach Dateien, die ein bestimmtes Symbol exportieren.

### Abhängigkeitssuche
```bash
--deps="src/auth.js"
```
Zeigen Sie, was die Datei importiert und was sie importiert.

### Index erstellen
```bash
--build-index
```
Erstellen Sie den Codebasisindex neu (wenn er veraltet ist oder fehlt).

## Ausgabeformat

Standardantwortformat:

```
Query: "[original natural language query]"
Translation: [query flags used]
Index Status: [built/stale/missing]
Found: [N] files

Files:
- path/to/file.ts (tags)
- path/to/other.ts (tags)
...

[Context: explanation of what was searched]
```

Enthält für Inhaltssuchen passende Zeilen:
```
Matches in path/to/file.ts:
  42: const token = validateToken(input);
  85: if (!validateToken(refreshToken)) {
```

## Token-Budgetverwaltung

Der Agent respektiert die Token-Grenzwerte:
- Standardbudget: 15.000 Zeichen
- Verwenden Sie `--budget=5000` für kleinere Ergebnisse
- Große Ergebnisse werden mit Hinweis abgeschnitten
- Zeigt die Gesamtzahl an, auch wenn sie abgeschnitten ist

## Fallback-Verhalten

Wenn das Abfrageskript oder der Index nicht verfügbar ist:

1. **Dateimuster**: Verwenden Sie das Glob-Tool für den Mustervergleich
2. **Inhaltssuche**: Verwenden Sie das Grep-Tool für die Textsuche
3. **Ergebnisse kombinieren**: Manuell deduplizieren und formatieren

## Integration mit anderen Agenten

Der Codebase Query Agent ist typischlly aufgerufen von:

- **MENTOR**: Finden Sie relevanten Code für die Feature-Implementierung
- **AG-API**: Suchen Sie nach vorhandenen API-Implementierungen
- **REFACTOR**: Finden Sie Codemuster zum Aktualisieren
- **AG-DEVOPS**: Konfigurationsdateien finden
- **EPIC-PLANNER**: Codebasisstruktur verstehen

Die Ergebnisse werden direkt zurückgegeben (für schreibgeschützte Abfragen ist kein Bus-Messaging erforderlich).

## RLM-Muster

Dieser Agent implementiert das Repository-Level Modeling (RLM)-Muster:

- **Programmatische Suche**: Codebasis über strukturierte API abfragen, nicht über RAG
- **Indexbasiert**: Verwendet einen vorgefertigten Index für schnelle Suchvorgänge
- **Token-effizient**: Gibt nur relevante Ergebnisse zurück, nicht ganze Dateien
- **Deterministisch**: Dieselbe Abfrage liefert immer dieselben Ergebnisse

Vorteile gegenüber RAG:
- Schneller (keine Einbettungsberechnung)
- Präziser (exakte Übereinstimmungen)
- Geringere Kosten (kleinerer Kontext)
- Deterministisch (keine Halluzinationen)

## Gemeinsame Muster

**Implementierungsdateien finden**
```
"Where is [feature] implemented?"
→ --tag="[relevant-tag]" + --query="[feature]"
```

**Nutzungsseiten finden**
```
"What uses [function/class]?"
→ --export="[symbol]"
```

**Konfiguration suchen**
```
"Where is [setting] configured?"
→ --tag="config" + --content="[setting]"
```

**Map Abhängigkeiten**
```
"What does [file] depend on?"
→ --deps="[file-path]"
```

## Verwandte Agenten

- [`research`](/agents/research) – Für tiefergehende technische Forschung über den Code hinaus
– [`mentor`](/agents/mentor) – Ruft häufig eine Codebasisabfrage für den Kontext auf
- [`refactor`](/agents/refactor) – Verwendet Abfrageergebnisse, um Refactoring zu planen
- [`devops`](/agents/devops) – Findet Konfigurations- und Infrastrukturcode

## Anti-Patterns

**NICHT:**
- Verwenden Sie Schreib-/Bearbeitungstools (Sie sind NUR LESEN)
- Laden Sie die gesamte Codebasis in den Kontext
- Indexstatus ignorieren (zuerst prüfen/erstellen)
- Rohdateiinhalte zurückgeben (strukturierte Ergebnisse zurückgeben)
- Token-Budget überschreiten (mit Hinweis abschneiden)

**TUN:**
- Übersetzen Sie natürliche Sprache in Abfragetypen
- Überprüfen Sie den Indexstatus vor der Abfrage
- Kombinieren Sie Abfragetypen für komplexe Suchen
- Übereinstimmungsanzahl und Dateipfade anzeigen
- Erklären Sie, was und wie durchsucht wurde