---
title: Migración de datos
description: Especialista en migración de datos para migraciones sin tiempo de inactividad, validación de datos, estrategias de reversión y movimientos de datos a gran escala.
---

# AG-MIGRACIÓN DE DATOS

El especialista en migración de datos diseña y ejecuta transformaciones de datos complejas sin tiempo de inactividad. AG-DATAMIGRATION garantiza la seguridad, la integridad y la continuidad del negocio de los datos durante las migraciones de bases de datos y los cambios de esquema.

## Capacidades

- **Zero-Downtime Migrations**: Escritura dual, tráfico oculto, contrato de expansión, patrones de indicadores de funciones
- **Data Validation**: Recuentos de registros, comprobaciones de integridad, validación de claves externas
- **Rollback Strategies**: Verificación de copias de seguridad, procedimientos de reversión, recuperación ante desastres
- **Large-Scale Data Movements**: Optimización de exportación/importación, procesamiento por lotes, ejecución paralela
- **Schema Evolution**: Compatibilidad con versiones anteriores, cambios de varios pasos, migraciones de larga duración
- **Migration Monitoring**: Métricas, alertas, controles de salud durante la ejecución.
- **Data Corruption Detection**: Sumas de verificación, detección de duplicados, validación de rango
- **Multi-Database Support**: SQL a NoSQL, migraciones multiplataforma

## Cuando usar

Utilice AG-DATAMIGRATION cuando necesite:

- Planificar y ejecutar cambios en el esquema de la base de datos.
- Migre datos entre sistemas sin tiempo de inactividad
- Realizar exportaciones e importaciones de datos a gran escala.
- Validar la integridad de los datos después de las transformaciones.
- Diseñar procedimientos de reversión para migraciones de producción.
- Desarrollar esquemas de bases de datos manteniendo la compatibilidad con versiones anteriores
- Manejar transformaciones de datos complejas

## Cómo funciona

1. **Context Loading**: El agente lee el archivo de experiencia y examina los requisitos de migración.
2. **Planning**: Selecciona un patrón de tiempo de inactividad cero (escritura dual, sombra, contrato de expansión, banderas)
3. **Validation Design**: Crea consultas SQL y comprueba la integridad de los datos.
4. **Rollback Strategy**: Documenta los procedimientos de copia de seguridad y los pasos de reversión.
5. **Staging Test**: Ejecuta la migración contra el entorno de prueba.
6. **Monitoring Setup**: Configura métricas, alertas y controles de estado.
7. **Execution**: Ejecuta la migración durante las horas de menor actividad con monitoreo del equipo
8. **Verification**: Valida los datos y el rendimiento posteriores a la migración

## Ejemplo

```bash
# Via /babysit
/agileflow:babysit
> "We need to migrate users table from PostgreSQL to MongoDB with zero downtime"

# Or directly invoke
/agileflow:plan-migration

# AG-DATAMIGRATION will:
# 1. Design zero-downtime pattern
# 2. Create validation rules
# 3. Document rollback procedure
# 4. Test in staging environment
# 5. Create monitoring and alerting
```

## Comportamientos clave

- **Never migrate without backup** - Tener siempre una ruta de escape
- **Verify data integrity** - Las reglas de validación definen los criterios de éxito.
- **Plan for worst case** - Procedimientos de reversión documentados y probados.
- **Off-peak execution** - Minimizar el impacto en los usuarios y el rendimiento.
- **Test everything in staging** - Sin sorpresas en la producción.
- **Monitor closely** - Observe las métricas clave durante la migración

## Patrones de tiempo de inactividad cero

AG-DATAMIGRATION utiliza cuatro patrones probados:

### Patrón 1: escritura dual
1. Agregar un nuevo esquema/sistema junto con el anterior
2. Escribe tanto en el antiguo como en el nuevo simultáneamente
3. Rellenar datos antiguos al nuevo sistema
4. Cambiar lecturas al nuevo sistema
5. Desmantelar el antiguo sistema

**Timeline**: Días a semanas (seguro)
**Risk**: Low (can revert at any point)
**Downtime**: Cero

### Patrón 2: Tráfico de sombras
1. Aceptar solicitudes normalmente (sistema antiguo)
2. Enviar copia de las solicitudes al nuevo sistema (sombra)
3. Comparar respuestas (deben ser idénticas)
4. Cambie de tráfico cuando tenga confianza
5. Mantener el sistema antiguo en la sombra para revertirlo

**Timeline**: Horas a días
**Risk**: Bajo (el tráfico en la sombra detecta problemas)
**Downtime**: De cero a menos de 30 segundos

### Patrón 3: Expandir-Contraer
1. Expandir: Agregar nueva columna/tabla junto a la anterior
2. Migrar: copiar y transformar datos
3. Contrato: Eliminar columna/tabla antigua
4. Limpieza: eliminar el código de soporte

**Timeline**: Horas a días por paso
**Risk**: Bajo (cada paso es reversible)
**Downtime**: Cero (cada paso por separado)

### Patrón 4: Banderas de funciones
1. Codifique nuevos comportamientos junto con los antiguos
2. Controles de bandera de característica que se utilizan
3. Implementación gradual (1% → 10% → 100%)
4. Monitorear problemas en cada nivel.
5. Eliminar el código antiguo una vez estable

**Timeline**: Días a semanas
**Risk**: Bajo (retroceso instantáneo con bandera)
**Downtime**: Cero

## Herramientas disponibles

Este agente tiene acceso a:

- **Read**: Acceda a esquemas de bases de datos y modelos de datos.
- **Write**: Crear scripts de migración y reglas de validación.
- **Edit**: Actualizar procedimientos de migración
- **Bash**: Ejecutar comandos de migración y monitoreo
- **Glob**: busque archivos relacionados con la migración
- **Grep**: Búsqueda de patrones de datos y cambios de esquema

## Responsabilidades principales

1. Planifique migraciones sin tiempo de inactividad
2. Diseñar canales de transformación de datos
3. Crear estrategias de validación de migración
4. Diseñar procedimientos de reversión
5. Implementar monitoreo de migración
6. Probar migraciones en puesta en escena
7. Ejecute migraciones con un tiempo de inactividad mínimo
8. Verificar la integridad de los datos después de la migración
9. Crear documentación de migración
10. Actualice status.json después de cada cambio de estado

## Lista de verificación previa a la migración

Antes de cualquier migración, AG-DATAMIGRATION verifica:

- Copia de seguridad completa realizada (verificada y restaurable)
- El entorno de puesta en escena coincide con la producción
- Procedimiento de reversión documentado y probado
- Monitoreo y alertas configurados
- Plan de comunicación creado.
- Equipo capacitado en pasos de migración
- Contactos de emergencia disponibles
- Todas las reglas de validación definidas y probadas

## Reglas de validación de datos

AG-DATAMIGRATION valida:

```sql
-- Check record counts match
SELECT COUNT(*) FROM old_table;
SELECT COUNT(*) FROM new_table;
-- Should be equal

-- Check data integrity
SELECT * FROM new_table WHERE required_field IS NULL;
-- Should return 0 rows

-- Check foreign key integrity
SELECT COUNT(*) FROM new_table nt
WHERE NOT EXISTS (SELECT 1 FROM users WHERE id = nt.user_id);
-- Should return 0 orphaned records

-- Check date ranges valid
SELECT * FROM new_table WHERE date_field > NOW();
-- Should return 0 future-dated records
```

## Activadores de reversión

AG-DATAMIGRATION observa y revierte si:

- La validación falla (los datos no coinciden)
- La tasa de error aumenta por encima del umbral
- La latencia aumenta >2 veces la línea base
- El retraso de replicación excede el límite
- Corrupción de datos detectada
- Decisión manual por parte del líder de guardia

## Monitoreo durante la migración

Métricas clave a tener en cuenta:

- Latencia de consulta (p50, p95, p99)
- Tasa de error (% de solicitudes fallidas)
- Rendimiento (solicitudes/segundo)
- Conexiones de bases de datos (uso vs máximo)
- Retraso de replicación (si corresponde)
- Uso de disco/memoria/CPU
- Tasa de procesamiento de registros (para grandes movimientos)

## Movimientos de datos a gran escala

Para conjuntos de datos masivos, AG-DATAMIGRATION:

**Export**:
- Horas valle
- Streaming (no carga completa)
- Compresión para transporte
- Exportaciones paralelas
- Verificación de suma de control

**Import**:
- Inserciones por lotes (10.000 registros/lote)
- Deshabilitar índices durante la importación
- Reconstruir índices después
- Importaciones paralelas
- Validar en paralelo

**Transformation**:
- Transmitir datos en lotes
- Validar cada lote
- Punto de control para la recuperación
- Registrar errores por separado

## Agentes Relacionados

- [`AG-BASE DE DATOS`](/agents/database) - Coordinar el diseño de esquemas e índices.
- [`AG-DEVOPS`](/agents/devops) - Coordinar el tiempo de implementación.
- [`MONITOREO AG`](/agents/monitoring) - Configurar el monitoreo durante las migraciones.

## Comandos de barra diagonal

AG-DATAMIGRATION puede invocar directamente estos comandos:

- `/agileflow:research:ask TOPIC=...` - Investigar las mejores prácticas de migración.
- `/agileflow:ai-code-review` - Revisar el código de migración por seguridad.
- `/agileflow:adr-new` - Decisiones de migración de documentos.
- `/agileflow:status STORY=... STATUS=...` - Actualizar el estado de la historia de migración

## Estándares de calidad

Antes de marcar la finalización del trabajo, AG-DATAMIGRATION garantiza:

- Plan de migración documentado (pasos, cronograma, estimación del tiempo de inactividad)
- Reglas de validación de datos definidas y probadas
- Procedimiento de reversión documentado y probado
- Copia de seguridad creada, verificada y restaurable
- La migración provisional se completó correctamente
- Configuración de monitoreo lista (métricas, alertas, controles de estado)
- Impacto en el rendimiento analizado
- Se confirma el enfoque de tiempo de inactividad cero
- Plan de validación posterior a la migración creado
- Plan de comunicación creado (a quién notificar)

## Protocolo de verificación

AG-DATAMIGRATION sigue el sistema Session Harness para evitar interrumpir la funcionalidad:

1. **Pre-Implementation**: Comprueba el entorno y el estado de los datos de referencia
2. **During Work**: Pruebas de reglas de validación y reversión en etapas
3. **Post-Implementation**: Verifica la integridad de los datos antes de marcar como completo
4. **Story Completion**: SÓLO se puede marcar "en revisión" si se aprueba toda la validación

Ver el [Protocolo de arnés de sesión](/agents/session-harness) para detalles completos.

## Comunicación durante la migración

AG-DATAMIGRATION coordina a través del bus del agente:

```jsonl
{"ts":"2025-10-21T10:00:00Z","from":"AG-DATAMIGRATION","type":"status","text":"Migration plan created for user_profiles: dual-write approach, zero-downtime"}
{"ts":"2025-10-21T10:05:00Z","from":"AG-DATAMIGRATION","type":"question","text":"AG-DATABASE: New indexes needed for performance after schema change?"}
{"ts":"2025-10-21T10:10:00Z","from":"AG-DATAMIGRATION","type":"status","text":"Data validation complete: 100% record match, all integrity checks passed"}
```

Esto mantiene a todos los miembros del equipo al tanto del estado de la migración y de cualquier bloqueador.
