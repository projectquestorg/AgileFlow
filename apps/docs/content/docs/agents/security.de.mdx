---
title: Sicherheit
description: Sicherheitsspezialist für Schwachstellenanalyse, Authentifizierungsmuster, Autorisierung, Compliance und Sicherheitsüberprüfungen vor der Veröffentlichung.
---
# Sicherheitsagent

Der Security Agent (AG-SECURITY) ist ein Sicherheits- und Schwachstellenspezialist, der dafür sorgt, dass Anwendungen von Natur aus sicher sind. Dieser Agent führt Bedrohungsmodellierung und Schwachstellenanalyse durch, implementiert sichere Muster und führt obligatorische Sicherheitsüberprüfungen vor der Veröffentlichung durch.

## Fähigkeiten

- **Schwachstellenanalyse**: Identifizieren Sie Sicherheitsprobleme in Anforderungen und Code
- **Bedrohungsmodellierung**: Modellieren Sie Bedrohungen und entwerfen Sie Verteidigungsstrategien
- **Authentifizierungsmuster**: Sichere Authentifizierung implementieren (JWT, OAuth, Sitzungsverwaltung)
- **Autorisierung**: Erzwingen Sie eine rollenbasierte und attributbasierte Zugriffskontrolle
- **Eingabevalidierung**: Verhindern Sie XSS-, SQL-Injection- und Command-Injection-Angriffe
- **Geheimnisverwaltung**: Stellen Sie sicher, dass Geheimnisse niemals fest codiert oder offengelegt werden
- **Sicherheitstests**: Schreiben Sie Tests für Authentifizierungsfehler, Injektionsversuche und Rechteausweitung
- **Abhängigkeitsscan**: Identifizieren Sie anfällige Abhängigkeiten
- **Compliance**: Überprüfen Sie OWASP Top 10, CWE und Industriestandards
- **Vorabversion AAudits**: Obligatorische Sicherheitsüberprüfung vor jeder Veröffentlichung

## Wann zu verwenden

Verwenden Sie den Security Agent, wenn:

- Implementierung von Authentifizierungs- oder Autorisierungsfunktionen
- Umgang mit sensiblen Benutzerdaten (PII, Zahlungsinformationen)
- Verarbeitung von Benutzereingaben (Formulare, APIs)
- Integration mit externen Diensten
- Implementierung von Verschlüsselung oder Geheimnisverwaltung
– Vor der Zusammenführung ist eine Überprüfung des Sicherheitscodes erforderlich
- Planung einer Veröffentlichung (obligatorisches Pre-Release-Audit)
- Notwendigkeit, Sicherheitsentscheidungen über ADR zu dokumentieren
- Sicherheitslücke entdeckt und muss behoben werden

## Wie es funktioniert

1. **Wissen laden**: Der Agent liest Fachwissen und Sicherheitsrecherchen
2. **Story-Überprüfung**: Der Agent analysiert die Story auf Sicherheitsauswirkungen
3. **Bedrohungsmodellierung**: Agent modelliert Bedrohungen für sicherheitskritische Funktionen
4. **Schwachstellenanalyse**: Der Agent identifiziert Angriffsvektoren und Gegenmaßnahmen
5. **Sicherheitstests**: Agent schreibt Sicherheitstests (Authentifizierungsfehler, Injektionen, Eskalation)
6. **Verifizierung**: Der Agent führt `/agileflow:verify` aus, um sicherzustellen, dass die Tests erfolgreich sind
7. **Dokumentation**: Agent erstellt ADRs für Sicherheitsentscheidungen
8. **Freigabeentscheidung**: Agentenberichte GENEHMIGT / GENEHMIGT MIT MITIGATIONEN / ABGELEHNT
9. **Koordination**: Agent aktualisiert status.json und kommuniziert Ergebnisse

## Beispiel

```bash
# Via babysit - security review of authentication feature
/agileflow:babysit
> "We're implementing JWT-based authentication. Need security review."

# Agent output:
# Security Review: US-0042 - JWT Authentication
#
# Vulnerabilities Found:
# - HIGH: Tokens stored in localStorage (XSS exposure)
# - MEDIUM: No token refresh mechanism (long-lived tokens)
# - MEDIUM: Missing CSRF protection
#
# Recommendations:
# 1. Move tokens to httpOnly cookies (not accessible to JS)
# 2. Implement token refresh with short-lived access tokens
# 3. Add CSRF tokens for state-changing requests
# 4. Validate tokens on every protected endpoint
#
# Security Tests Required:
# - Test invalid token rejection
# - Test expired token handling
# - Test CSRF token validation
# - Test privilege escalation prevention
#
# Clearance: APPROVED WITH MITIGATIONS
# - Implement recommendations above
# - Re-run security tests
# - ADR documenting JWT strategy required
```

## Schlüsselverhalten

- **Sicherheit geht vor**: Überspringen Sie niemals Sicherheitskontrollen, um Fristen einzuhalten
- **Tiefenverteidigung**: Mehrere Sicherheitsebenen, kein Single Point of Failure
- **Fail Secure**: Standardmäßig verweigern, explizit zulassen
- **Bedrohungsmodellierung**: Denken Sie wie ein Angreifer
- **Zero Trust**: Vertrauen Sie niemals Benutzereingaben oder externen Daten
- **Prinzip der geringsten Rechte**: Benutzer verfügen über die minimal erforderlichen Berechtigungen
- **Transparenz**: Dokumentieren Sie alle Sicherheitsentscheidungen und Abhilfemaßnahmen
- **Kontexterhaltung**: Verwendet „compact_context“ (Priorität: hoch), um den Sicherheitsfokus bei langen Gesprächen beizubehalten und Bedrohungsmodelle und Sicherheitsanforderungen durch Kontextkomprimierung beizubehalten

## Kompakte Kontextkonfiguration

Der Sicherheitsagent verwendet Compact_c mit **hoher Priorität**ontext sorgt dafür, dass die Sicherheitsüberwachung im Fokus bleibt:

```yaml
compact_context:
  priority: high
  preserve_rules:
    - "LOAD EXPERTISE FIRST: Always read packages/cli/src/core/experts/security/expertise.yaml"
    - "SECURITY FIRST: Never skip security checks to meet deadlines"
    - "DEFENSE IN DEPTH: Multiple layers, not single point of failure"
    - "FAIL SECURE: Default deny, explicit allow (principle of least privilege)"
    - "THREAT MODELING: Think like an attacker, anticipate exploits"
    - "ZERO TRUST: Never trust user input or external data"
    - "NO SECRETS: No hardcoded API keys, credentials, or sensitive data"
  state_fields:
    - current_story
    - threat_model
    - security_requirements
    - vulnerability_findings
    - mitigation_progress
```

Dadurch wird sichergestellt, dass sicherheitskritische Regeln (Bedrohungsmodellierung, Zero Trust, Geheimschutz, Tiefenverteidigung) und der aktuelle Status (bekannte Schwachstellen, Bedrohungsmodelle, Mitigationsstatus) durch Kontextkomprimierung im Fokus bleiben.

## Werkzeuge verfügbar

- Lesen, Schreiben, Bearbeiten (Dateioperationen)
- Bash (Sicherheitsscans ausführen)
- Glob (sicherheitsrelevante Dateien finden)
- Grep (Suche nach Geheimnissen oder Schwachstellen)

## Sicherheitscheckliste (vor der Veröffentlichung obligatorisch)

Bevor Sie eine Veröffentlichung genehmigen:

- [ ] Keine fest codierten Geheimnisse, API-Schlüssel oder Anmeldeinformationen
- [ ] Alle Benutzereingaben validiert (Typ, Länge, Format, Bereich)
- [ ] Alle Ausgaben codiert/escaped (verhindert XSS, Injektion)
- [ ] Authentifizierung wird auf geschützten Endpunkten erzwungen
- [ ] Autorisierungsprüfungen überprüfen Berechtigungen
- [ ] Ratenbegrenzung verhindert Brute Force und DoS
- [ ] HTTPS erzwungen (kein HTTP in der Produktion)
- [ ] CORS ordnungsgemäß konfiguriert (nicht `*` für Anmeldeinformationen)
- [ ] CSRF-TokenWird für Statusänderungsanfragen benötigt
- [ ] Abhängigkeiten auf Schwachstellen überprüft
- [ ] Fehlermeldungen geben keine Systemdetails preis
- [ ] Bei der Protokollierung werden keine Passwörter/Tokens/PII erfasst
- [ ] SQL verwendet parametrisierte Anweisungen
- [ ] Sicherheitstests umfassen Authentifizierungsfehler, Rechteausweitung und Injektionen
- [ ] Compliance-Anforderungen dokumentiert

## Gemeinsame Sicherheitsmuster

**Authentifizierung (JWT)**:
```javascript
// Good: Secure JWT with expiration
const token = jwt.sign(
  { userId: user.id },
  process.env.JWT_SECRET,
  { algorithm: 'RS256', expiresIn: '1h' }
);

// Bad: No expiration, weak algorithm
const token = jwt.sign(
  { userId: user.id, password: user.password },
  'hardcoded-secret',
  { algorithm: 'HS256' }
);
```

**Autorisierung (rollenbasiert)**:
```javascript
// Good: Check permissions on backend
function protectedRoute(req, res) {
  if (!req.user || req.user.role !== 'admin') {
    return res.status(403).json({ error: 'Forbidden' });
  }
  // ... handle request
}

// Bad: Trust frontend role
if (user.role === 'admin') {
  // ... always true on frontend
}
```

**Eingabevalidierung**:
```javascript
// Good: Whitelist valid inputs
const email = req.body.email;
if (!/^[^@]+@[^@]+\.[^@]+$/.test(email)) {
  return res.status(400).json({ error: 'Invalid email' });
}

// Bad: No validation, vulnerable to injection
const query = `SELECT * FROM users WHERE email = '${email}'`;
```

**Geheimnisverwaltung**:
```javascript
// Good: Load from environment variables
const dbPassword = process.env.DB_PASSWORD;

// Bad: Hardcoded credentials
const dbPassword = 'supersecretpassword123';
```

## Häufige Sicherheitslücken, die es zu verhindern gilt

| Sicherheitslücke | Risiko | Prävention |
|---------------|------|-----------|
| SQL-Injection | Datenschutzverletzung | Parametrisierte Abfragen |
| XSS (Cross-Site Scripting) | Session-Hijacking | Eingabebereinigung, Ausgabekodierung |
| CSRF (Cross-Site Request Forgery) | Unerlaubte Aktionen | CSRF-Tokens, SameSite-Cookies |
| Schwache Authentifizierung | Kontoübernahme | Starke Passwörter, MFA, JWT |
| Hartcodierte Geheimnisse | CreZahnexposition | Umgebungsvariablen |
| Fehlendes HTTPS | Mann-in-der-Mitte | Erzwingen Sie HTTPS, HSTS |
| Privilegieneskalation | Unbefugter Zugriff | Berechtigungsprüfungen |
| Abhängigkeitsschwachstellen | Angriffe auf die Lieferkette | Regelmäßiges Scannen, Updates |

## Fehlerschweregrade

| Schweregrad | Beschreibung | Beispiel |
|----------|-------------|---------|
| Kritisch | Sicherheitsverletzung, Datenverlust | Nicht authentifizierter API-Zugriff |
| Hoch | Erhebliche Sicherheitslücke | Richtlinie für schwache Passwörter |
| Mittel | Bemerkenswerte Schwäche | Fehlende CSRF-Tokens |
| Niedrig | Kleines Problem | Ausführliche Fehlermeldungen |

## Threat Modeling Framework

Fragen Sie nach den wichtigsten Funktionen:

1. **Welche Vermögenswerte schützen wir?** (Benutzerdaten, Zahlungsinformationen, IP)
2. **Wer sind die Bedrohungen?** (Hacker, böswillige Benutzer, Insider)
3. **Welche Angriffe sind möglich?** (SQL-Injection, XSS, Credential Stuffing)
4. **Wie verhindern wir jeden Angriff?** (Validierung, Verschlüsselung, Ratenbegrenzung)
5. **Wie hoch ist unsere Verteidigungstiefe?** (Sicherheitsebenen)
6. **Können wir erkennenAngriffe?** (Protokollierung, Überwachung, Warnungen)

## Abhängigkeitsscan

Führen Sie vor jeder Veröffentlichung Folgendes aus:

```bash
npm audit              # Find vulnerable packages
npm audit fix         # Update vulnerable packages
npm update            # Update all packages
```

Dokumentergebnisse:
- Welche Pakete sind anfällig?
- Wie hoch ist der Schweregrad?
- Können wir ein Update durchführen oder gibt es einen Workaround?
- Wann wurde dies zuletzt überprüft?

## Verwandte Agenten

- [`testing`](/agents/testing) – Implementierung des Sicherheitstests
- [`api`](/agents/api) – API-Sicherheit und Validierung
- [`database`](/agents/database) – Datenbanksicherheit und Zugriffskontrolle
- [`devops`](/agents/devops) – Infrastruktursicherheit
– [`ci`](/agents/ci) – Sicherheitsscan in der CI-Pipeline

## Koordination

Der Sicherheitsagent koordiniert sich mit:

- **AG-API**: Authentifizierung/Validierung auf Endpunkten sicherstellen
- **AG-UI**: XSS und CSRF im Frontend verhindern
- **AG-DATABASE**: Abfragesicherheit und Zugriffskontrolle überprüfen
- **AG-DEVOPS**: Infrastruktursicherheit, Geheimnisverwaltung
- **AG-TESTING**: Koordinieren Sie die Abdeckung von Sicherheitstests
- **Alle Agenten**: Markieren Sie Securit proaktivy Implikationen

## Slash-Befehle

- `/agileflow:research:ask TOPIC=...` – Recherchieren Sie Sicherheitsmuster
– `/agileflow:ai-code-review` – Überprüfen Sie den Code auf Sicherheitsprobleme
- `/agileflow:adr-new` – Sicherheitsentscheidungen dokumentieren
- `/agileflow:tech-debt` - Sicherheitsschuld dokumentieren
- `/agileflow:impact-analysis` – Sicherheitsauswirkungen von Änderungen analysieren
- `/agileflow:status STORY=... STATUS=...` – Story-Status aktualisieren

## Sicherheitsprinzipien

- **Überspringen Sie niemals die Sicherheit** für Fristen
- **Messen Sie, bevor Sie beheben** – verstehen Sie die Schwachstelle
- **Tiefenverteidigung** – mehrere Ebenen, kein einzelner Fehlerpunkt
- **Zero Trust** – Vertraue niemals Benutzereingaben oder externen Daten
- **Geringeste Berechtigung** – Gewähren Sie die minimal erforderlichen Berechtigungen
- **Transparent** – Dokumentieren Sie alle Sicherheitsentscheidungen
- **Gehen Sie auf der sicheren Seite** – seien Sie im Zweifelsfall restriktiver