---
title: واجهة برمجة التطبيقات
description: متخصص في الخدمات وطبقات البيانات لتنفيذ واجهات برمجة التطبيقات الخلفية ومنطق الأعمال ونماذج البيانات.
---
# وكيل API

وكيل واجهة برمجة التطبيقات (AG-API) هو متخصص في خدمات الواجهة الخلفية لديك. وهو ينفذ واجهات برمجة تطبيقات REST/GraphQL ومنطق الأعمال ونماذج البيانات والوصول إلى قاعدة البيانات وتكامل الخدمات الخارجية وإدارة الحالة. فهو يضمن أن طبقة البيانات الخاصة بك آمنة وفعالة ومختبرة جيدًا.

## القدرات

- تنفيذ نقاط نهاية REST/GraphQL/tRPC API
- كتابة منطق العمل وقواعد التحقق من الصحة
– تصميم وصيانة نماذج البيانات والمخططات
- تحسين استعلامات قاعدة البيانات ومنع مشاكل N+1
- دمج الخدمات الخارجية (Stripe، SendGrid، التحليلات، وما إلى ذلك)
- تنفيذ المصادقة والترخيص
- كتابة اختبارات API الشاملة (الوحدة، التكامل، العقد)
- نقاط نهاية API للوثيقة ومعالجة الأخطاء
- التنسيق مع AG-UI بشأن تبعيات نقطة نهاية API
- مراقبة وتسجيل طلبات API مع السياق

## متى يستخدم

استخدم وكيل API عندما:

- أنت بحاجة إلى تنفيذ نقطة نهاية API جديدة
- تحتاج إلى إضافة منطق الأعمال للتعامل مع الميزة
- تحتاج إلى دمج خدمة خارجية (الدفع، البريد الإلكتروني، الخ)
-تحتاج إلى تحسين استعلامات قاعدة البيانات أو إصلاح مشكلات N+1
- تحتاج إلى تنفيذ المصادقة أو الترخيص
- أنت تقوم بتصميم نماذج بيانات لميزة جديدة
- أنت بحاجة إلى كتابة اختبارات API شاملة
- تريد التأكد من عدم حظر قصص AG-UI في انتظار نقاط النهاية

## كيف يعمل

1. **تحميل السياق**: يقرأ الوكيل الخبرة وCLAUDE.md ومستندات الهندسة المعمارية
2. **التحقق من الحالة**: يعثر الوكيل على قصص جاهزة ويتحقق من أدوات حظر AG-UI
3. **تعريف الجاهزية**: يقوم الوكيل بالتحقق من صحة معايير القبول وقواعد الاختبار
4. **وضع الخطة**: بالنسبة للعمل المعقد، يقوم الوكيل بتصميم التصاميم قبل التنفيذ
5. **التنفيذ**: يكتب الوكيل التحقق من الصحة ومعالجة الأخطاء ومنطق الأعمال
6. **الاختبار**: يكتب الوكيل اختبارات الوحدة والتكامل والعقد
7. **التنسيق**: يقوم الوكيل بإلغاء حظر قصص AG-UI عندما تكون نقاط النهاية جاهزة
8. **التحقق**: يجري الوكيل اختبارات للتأكد من اجتياز خط الأساس
9. **الوثائق**: يقوم الوكيل بتحديث CLAUDE.md وإضافة رسائل الناقل

## مثال

__لا تترجم_0__

سيقوم وكيل واجهة برمجة التطبيقات بما يلي:
1. تحقق من docs/06-stories/ للولايات المتحدة مع المالك==AG-API
2. ابحث عن أي قصص AG-UI محظورة في انتظار نقطة النهاية هذه
3. تنفيذ نقطة نهاية POST /api/users:
   - التحقق من صحة الإدخال (الحقول المطلوبة، التحقق من النوع)
   - منطق الأعمال (تجزئة كلمة المرور، تعيين الإعدادات الافتراضية)
   - الوصول إلى قاعدة البيانات (أدخل في جدول المستخدمين)
   - معالجة الأخطاء (تكرار البريد الإلكتروني، أخطاء التحقق من الصحة)
   - التسجيل بمعرفات الطلب
4. كتابة الاختبارات الشاملة:
   - مسار سعيد (البيانات الصالحة تنشئ المستخدم)
   - أخطاء التحقق (البريد الإلكتروني المفقود)
   - حالات الحافة (بريد إلكتروني طويل جدًا)
5. تحديث مستندات واجهة برمجة التطبيقات (OpenAPI/Swagger)
6. أرسل رسالة إلغاء الحظر إلى AG-UI: "احصل على /api/users/:id جاهز"
7. ضع علامة في المراجعة عند اجتياز الاختبارات

أو تفرخ مباشرة:

__لا تترجم_1__

## السلوكيات الرئيسية

- **تحميل الخبرة أولاً**: يقرأ Expertise.yaml قبل أي عمل
- **إعطاء الأولوية لإلغاء حظر AG-UI**: عمليات التحقق من قصص AG-UI المحظورة على نقاط نهاية واجهة برمجة التطبيقات - وهي ذات أولوية قصوى
- **التنسيق الاستباقي**: يرسل رسائل إلغاء الحظر إلى AG-UI عند نقطة النهايةإن تي إس جاهزة
- **التحقق من صحة الإدخال**: يتحقق دائمًا من صحة الأنواع والتنسيقات والنطاقات والتفويض
- **معالجة الأخطاء**: مخطط خطأ متسق مع رموز حالة HTTP
- **معتمد على الاختبار**: يكتب الاختبارات قبل التنفيذ، ويضمن اجتياز الاختبارات قبل المراجعة
- **تحديثات CLAUDE.md**: توثيق أنماط واجهة برمجة التطبيقات الجديدة التي تم اكتشافها أثناء التنفيذ
- **تكامل أدوات الجلسة**: التحقق من حالة الاختبار قبل البدء، ويتطلب اجتياز الاختبارات قبل المراجعة
- **الأوامر المستقلة**: تستدعي مباشرةً /agileflow:ai-code-review، و/agileflow:adr-new، وما إلى ذلك.
- **تنسيق الحافلة**: يرسل رسائل الحالة، ورسائل الحظر، وإلغاء الحظر، والأسئلة إلى bus/log.jsonl
- **الحفاظ على السياق**: يستخدم السياق المضغوط (الأولوية: حرجة) للحفاظ على التركيز أثناء المحادثات الطويلة، والحفاظ على قواعد تحميل الخبرة وتتبع أدوات الحظر من خلال ضغط السياق

## تكوين السياق المضغوط

يستخدم وكيل واجهة برمجة التطبيقات **أولوية حرجة** Compact_context لضمان الحفاظ على التركيز أثناء المحادثات الموسعة:

```yaml
compact_context:
  priority: critical
  preserve_rules:
    - "LOAD EXPERTISE FIRST: Always read packages/cli/src/core/experts/api/expertise.yaml"
    - "CHECK FOR AG-UI BLOCKERS: Search bus/log.jsonl for UI stories waiting on API endpoints"
    - "VERIFY TEST BASELINE: Session harness required - check test_status before starting"
    - "DIFF-FIRST FOR FILE CHANGES: Show all edits with YES/NO confirmation"
    - "NEVER hardcode secrets - use environment variables only"
  state_fields:
    - current_story
    - endpoints_implemented
    - blocked_ui_stories
    - test_status_baseline
```

وهذا يضمن الحفاظ على القواعد المهمة (تحميل الخبرة، وتحديد أولويات أداة الحظر، والتحقق من الاختبار) والحالة الحالية (أي نقاط النهاية التي تم إنجازها، وما هي قصص واجهة المستخدم المحظورة) حتى بعد ضغط السياق.

## الأدوات المتاحة

هذا الوكيل لديه حق الوصول إلى: القراءة، الكتابة، التحرير، Bash، Glob، Grep

## أنماط نقطة النهاية لواجهة برمجة التطبيقات

** اتفاقيات الراحة **:

__لا تترجم_3__

**تنسيق الطلب/الاستجابة**:

__لا تترجم_4__

## التحقق من صحة الإدخال

يجب على كل نقطة نهاية التحقق من صحة المدخلات:

__لا تترجم_5__

## معالجة الأخطاء

مخطط خطأ متسق عبر جميع نقاط النهاية:

__لا تترجم_6__

## معايير الاختبار

تحتاج كل نقطة نهاية لواجهة برمجة التطبيقات (API) إلى اختبارات شاملة:

__لا تترجم_7__

## الملفات الرئيسية

- **الخبرة**: `packages/cli/src/core/experts/api/expertise.yaml` (ذاكرة الوكيل)
- **سير العمل**: `packages/cli/src/core/experts/api/workflow.md` (الخطة → البناء → التحسين الذاتي)
- **الحالة**: `docs/09-agents/status.json` (تتبع القصة)
- **الحافلة**: `docs/09-agents/bus/log.jsonl` (رسائل التنسيق)
- **CLAUDE.md**: بنية API، ORM، نهج التحقق من الصحة
- **البحث**: __غير مترجم_12__ (تحقق من أنماط واجهة برمجة التطبيقات)
- **ADRs**: `docs/03-decisions/` (قرارات بنية واجهة برمجة التطبيقات)

## خطوات سير العمل

1. **تحميل الخبرة**: اقرأ Expert.yaml
2. **التحقق من الحالة**: ابحث عن القصص الجاهزة حيث المالك==AG-API
3. **إعطاء الأولوية لأدوات حظر AG-UI**: تحقق من الناقل بحثًا عن قصص AG-UI المحظورة على نقاط النهاية
4. **التحقق من صحة تعريف الجاهزية**: التيار المتردد موجود، كعب اختبار في docs/07-testing/test-cases/
5. **التحقق من أدوات الجلسة**: تحقق من اجتياز test_status==قبل البدء
6. **إنشاء فرع**: `feature/<US_ID>-<slug>`
7. **حالة التحديث**: ضع علامة "قيد التقدم"، وألحق رسالة الناقل
8. **التنفيذ**: التحقق من الصحة ومعالجة الأخطاء ومنطق الأعمال والاختبارات
9. **تشغيل التحقق**: /agileflow:تحقق لضمان اجتياز الاختبارات
10. **تحديث CLAUDE.md**: في حالة إنشاء أنماط جديدة (توثيقها)
11. **وضع علامة قيد المراجعة**: فقط في حالة اجتياز اختبار test_status==
12. **إرسال رسائل إلغاء الحظر**: إذا كان AG-UI ينتظر عند نقطة النهاية هذه
13. **إنشاء علاقات عامة**: استخدم /agileflow:pr-template
14. **التحسين الذاتي**: قم بتشغيل self-improve.md بعد الانتهاء

## كواقائمة مراجعة لايت

قبل وضع علامة في المراجعة:

- [ ] تم التحقق من صحة المدخلات (النوع، التنسيق، النطاق، المصادقة)
- [ ] استجابات الأخطاء متسقة (رموز HTTP، مخطط الأخطاء)
- [ ] يتم فرض المصادقة/التفويض على المسارات المحمية
- [ ] لا توجد استعلامات N+1 (الوصول الأمثل إلى قاعدة البيانات)
- [ ] أسرار في env vars (لم يتم ترميزها أبدًا)
- [ ] التسجيل باستخدام معرفات الطلب والسياق
- [ ] تم تحديث مستندات API (OpenAPI/Swagger/README)
- [ ] تغطي الاختبارات: المسار السعيد، وأخطاء التحقق من الصحة، وفشل المصادقة، وحالات الحافة
- [ ] حالة الاختبار: ناجح (تم التحقق منه عبر /agileflow:verify)
- [ ] تم إلغاء حظر قصص AG-UI (تم إرسال رسالة إلغاء الحظر إن أمكن)

## التنسيق مع الوكلاء الآخرين

**AG-UI (الواجهة الأمامية)**:
- تحقق من docs/09-agents/bus/log.jsonl لمعرفة قصص واجهة المستخدم المحظورة في انتظار نقاط النهاية
- عندما تكون نقطة النهاية جاهزة، أرسل رسالة إلغاء الحظر مع الطريقة والمسار وتنسيق الطلب/الاستجابة
- مثال: `"API endpoint GET /api/users/:id ready (200 OK, user object), unblocking US-0042"`

**قاعدة بيانات AG (طبقة البيانات)**:
- التنسيق على تصميم المخطط قبل تنفيذ الاستعلامات
- مراجعة عمليات الترحيل قبل استخدامها في التعليمات البرمجية
- حصة بات الاستعلامrns للتحسين

**AG-CI (الاختبار)**:
- التنسيق على إعداد قاعدة بيانات الاختبار
- طلب البنية التحتية لاختبار العقد (Pact، MSW)
- التأكد من اختبارات API في CI

** المرشد (التنسيق) **:
- طلب توضيح بشأن منطق العمل غير الواضح
- تقرير إذا كانت القصة مفقودة تعريف جاهز

## الوكلاء ذوو الصلة

- [`ui`](/agents/ui) - مكونات الواجهة الأمامية التي تستهلك نقاط نهاية واجهة برمجة التطبيقات
- [`database`](/agents/database) - تصميم طبقة البيانات والمخطط
- [`mentor`](/agents/mentor) - ينسق عمل واجهة برمجة التطبيقات (API) كجزء من تنفيذ الميزة