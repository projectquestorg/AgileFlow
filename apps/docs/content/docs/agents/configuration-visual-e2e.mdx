---
title: Configuration - Visual E2E Testing
description: Configure Visual E2E testing infrastructure with Playwright and screenshot verification
---

# Configuration - Visual E2E Testing

This configuration agent sets up Visual E2E testing infrastructure with Playwright for reliable UI verification.

## What This Does

Visual E2E testing catches issues that functional tests miss:

1. **Playwright Setup** - Install test runner and chromium browser
2. **Screenshot Capture** - E2E tests capture screenshots during runs
3. **Visual Verification** - Claude reviews screenshots before marking UI work complete
4. **Auto-Start Dev Server** - webServer config auto-starts dev server for tests

## When to Use

- When setting up a web development project
- When you want to verify UI looks correct, not just functions
- When you need automated visual regression detection
- When you want to catch layout and styling issues

## Configuration Process

### Step 1: Check Prerequisites
Verifies that `package.json` exists in the project.

### Step 2: Ask User to Proceed
Confirms user wants to install ~300MB for chromium browser and create testing infrastructure.

### Step 3: Ask Dev Server Configuration
Determines how to start the dev server:
- `npm run dev` (Next.js/Vite default)
- `npm start` (Create React App default)
- `yarn dev` (Yarn)

### Step 4: Install Playwright
```bash
npm install --save-dev @playwright/test
npx playwright install --with-deps chromium
```

### Step 5: Create playwright.config.ts
Creates configuration with:
- Test directory: `tests/e2e`
- Base URL: `http://localhost:3000`
- Screenshot: On for all tests
- Trace: On failure for debugging
- webServer: Auto-starts your dev server

### Step 6: Create Directory Structure
```bash
mkdir -p tests/e2e
mkdir -p screenshots
```

### Step 7: Create Example Test
Creates `tests/e2e/visual-example.spec.ts` with:
- Full-page screenshot example
- Component screenshot example
- Basic assertions

### Step 8: Add npm Scripts
Adds to package.json:
- `npm run test:e2e` - Run all tests
- `npm run test:e2e:ui` - Run with Playwright UI
- `npm run test:e2e:headed` - Run with visible browser

### Step 9: Run Verification Test
Runs the example test to verify setup works.

### Step 10: Update Metadata
Registers Visual E2E in `docs/00-meta/agileflow-metadata.json` so agents know it's available.

### Step 11: Completion Summary
Shows what's been installed and how to use Visual E2E.

## Visual Verification Workflow

After running tests:

1. **Review screenshots** - Look at each screenshot in `screenshots/`
2. **Verify visually** - Check that UI looks correct
3. **Rename verified** - `mv screenshots/file.png screenshots/verified-file.png`
4. **Run verifier** - `node scripts/screenshot-verifier.js --path ./screenshots`

This ensures Claude actually looked at each screenshot before declaring completion.

## Tools Available

This agent has access to: Read, Write, Edit, Bash, Glob, Grep

## Example Test

```typescript
import { test, expect } from '@playwright/test';

test.describe('Visual Verification Examples', () => {
  test('homepage loads correctly', async ({ page }) => {
    await page.goto('/');

    // Capture full-page screenshot for visual verification
    await page.screenshot({
      path: 'screenshots/homepage-full.png',
      fullPage: true,
    });

    // Basic assertions
    await expect(page).toHaveTitle(/./);
  });

  test('component renders correctly', async ({ page }) => {
    await page.goto('/');

    // Capture specific element screenshot
    const header = page.locator('header').first();
    if (await header.isVisible()) {
      await header.screenshot({
        path: 'screenshots/header-component.png',
      });
    }

    // Verify element is visible
    await expect(header).toBeVisible();
  });
});
```

## Why Visual Testing Matters

Tests passing doesn't mean UI looks correct. A button can:
- "Work" (functional test passes) but be the wrong color
- Fire the right event but be misaligned
- Have the correct text but be invisible
- Be present in DOM but have wrong position

Visual verification catches all these issues.

## Integration with Ralph Loop

When using Visual Mode in Ralph Loop:
```bash
node scripts/ralph-loop.js --init --epic=EP-XXXX --visual
```

Loop checks:
1. npm test passes
2. All screenshots have `verified-` prefix
3. Minimum 2 iterations completed

Visual Mode prevents premature completion for UI work.

## Example Usage

```text
Task(
  description: "Set up Visual E2E testing",
  prompt: "Configure Visual E2E testing with Playwright for a Next.js project. Install dependencies, create playwright.config.ts, add example tests, and set up screenshot verification workflow.",
  subagent_type: "agileflow-configuration-visual-e2e"
)
```

## Troubleshooting

**Tests fail with "No server running":**
- Ensure webServer command matches your dev server command
- Check port number in baseURL matches your app

**Screenshots directory empty:**
- Tests must include `await page.screenshot({path: 'screenshots/...'})` calls
- Check test output for errors

**Browser not installed:**
- Run `npx playwright install --with-deps chromium`

## Best Practices

- Capture full-page screenshots for key pages
- Capture component screenshots for critical UI
- Review all screenshots before marking complete
- Use verified- prefix to track reviewed screenshots
- Run tests before committing UI changes
- Keep screenshot artifacts clean (delete old runs)

## Related

- [Playwright Docs](https://playwright.dev/docs/intro)
- [webServer Configuration](https://playwright.dev/docs/test-webserver)
