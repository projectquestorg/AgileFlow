---
title: حماية
description: متخصص أمني لتحليل الثغرات الأمنية وأنماط المصادقة والترخيص والامتثال ومراجعات الأمان قبل الإصدار.
---
#عميل أمن

وكيل الأمان (AG-SECURITY) هو متخصص في الأمان والثغرات الأمنية ويضمن أمان التطبيقات حسب التصميم. يقوم هذا الوكيل بتنفيذ نماذج التهديدات، وتحليل الثغرات الأمنية، وتنفيذ أنماط آمنة، وإجراء عمليات تدقيق أمنية إلزامية قبل الإصدار.

## القدرات

- **تحليل الثغرات الأمنية**: تحديد المشكلات الأمنية في المتطلبات والتعليمات البرمجية
- **نمذجة التهديدات**: نماذج التهديدات وتصميم استراتيجيات الدفاع
- **أنماط المصادقة**: تنفيذ المصادقة الآمنة (JWT، OAuth، إدارة الجلسة)
- **التفويض**: فرض التحكم في الوصول على أساس الدور وعلى أساس السمة
- **التحقق من صحة الإدخال**: منع هجمات XSS وحقن SQL وحقن الأوامر
- **إدارة الأسرار**: تأكد من عدم تشفير الأسرار أو كشفها مطلقًا
- **اختبار الأمان**: كتابة اختبارات لفشل المصادقة، ومحاولات الحقن، وتصعيد الامتيازات
- **فحص التبعيات**: تحديد التبعيات الضعيفة
- **الامتثال**: تحقق من أعلى 10 معايير OWASP وCWE ومعايير الصناعة
- **الإصدار المسبق أعمليات التدقيق**: مراجعة أمنية إلزامية قبل كل إصدار

## متى يستخدم

استخدم وكيل الأمان عندما:

- تنفيذ ميزات المصادقة أو الترخيص
- التعامل مع بيانات المستخدم الحساسة (معلومات تحديد الهوية الشخصية، معلومات الدفع)
- معالجة مدخلات المستخدم (النماذج، واجهات برمجة التطبيقات)
- التكامل مع الخدمات الخارجية
- تنفيذ التشفير أو إدارة الأسرار
- تحتاج إلى مراجعة رمز الأمان قبل الدمج
- التخطيط للإصدار (تدقيق إلزامي قبل الإصدار)
- الحاجة إلى توثيق القرارات الأمنية عبر ADR
- تم اكتشاف الثغرات الأمنية وتحتاج إلى علاج

## كيف يعمل

1. **تحميل المعرفة**: يقرأ الوكيل الخبرة والأبحاث الأمنية
2. **مراجعة القصة**: يقوم العميل بتحليل القصة بحثًا عن الآثار الأمنية
3. **نمذجة التهديدات**: يقوم الوكيل بإعداد نماذج للتهديدات المتعلقة بالميزات الأمنية المهمة
4. **تحليل الثغرات الأمنية**: يحدد الوكيل نواقل الهجوم ووسائل التخفيف منه
5. **اختبار الأمان**: يكتب الوكيل اختبارات الأمان (حالات فشل المصادقة، والحقن، والتصعيد)
6. **التحقق**: يقوم الوكيل بتشغيل `/agileflow:verify` لضمان اجتياز الاختبارات
7. **التوثيق**: يقوم الوكيل بإنشاء ADRs للقرارات الأمنية
8. **قرار التخليص**: تمت الموافقة على تقارير الوكيل / الموافقة عليها مع إجراءات التخفيف / الرفض
9. **التنسيق**: يقوم الوكيل بتحديث Status.json وإبلاغ النتائج

## مثال

__لا تترجم_0__

## السلوكيات الرئيسية

- **الأمان أولاً**: لا تتخطى أبدًا عمليات التحقق الأمني للوفاء بالمواعيد النهائية
- **الدفاع في العمق**: طبقات متعددة من الأمان، وليس نقطة فشل واحدة
- **تأمين الفشل**: الرفض الافتراضي، السماح الصريح
- **نمذجة التهديدات**: فكر كمهاجم
- **الثقة المعدومة**: لا تثق أبدًا في مدخلات المستخدم أو البيانات الخارجية
- **مبدأ الامتياز الأقل**: يتمتع المستخدمون بالحد الأدنى من الأذونات اللازمة
- **الشفافية**: توثيق جميع القرارات وعمليات التخفيف المتعلقة بالأمان
- **الحفاظ على السياق**: يستخدم Compact_context (الأولوية: عالية) للحفاظ على التركيز الأمني أثناء المحادثات الطويلة، والحفاظ على نماذج التهديد ومتطلبات الأمان من خلال ضغط السياق

## تكوين السياق المضغوط

يستخدم وكيل الأمان ** أولوية عالية ** Compact_context لضمان بقاء اليقظة الأمنية موضع التركيز:

__لا تترجم_1__

وهذا يضمن بقاء القواعد الأمنية الحرجة (نمذجة التهديدات، الثقة المعدومة، الحماية السرية، الدفاع المتعمق) والحالة الحالية (نقاط الضعف المعروفة، نماذج التهديد، حالة التخفيف) موضع التركيز من خلال ضغط السياق.

## الأدوات المتاحة

- القراءة والكتابة والتحرير (عمليات الملف)
- باش (تشغيل عمليات الفحص الأمني)
- Glob (البحث عن الملفات المتعلقة بالأمان)
- Grep (البحث عن الأسرار أو نقاط الضعف)

## قائمة التحقق من الأمان (الإصدار المسبق إلزامي)

قبل الموافقة على أي إصدار:

- [ ] لا توجد أسرار مضمنة أو مفاتيح API أو بيانات الاعتماد
- [ ] تم التحقق من صحة جميع مدخلات المستخدم (النوع، الطول، التنسيق، النطاق)
- [ ] جميع المخرجات المشفرة/المفلترة (تمنع XSS، والحقن)
- [ ] يتم فرض المصادقة على نقاط النهاية المحمية
- [ ] التحقق من التفويض للتحقق من الأذونات
- [ ] تحديد المعدل يمنع القوة الغاشمة وDoS
- [ ] فرض HTTPS (لا يوجد HTTP في الإنتاج)
- [ ] تم تكوين CORS بشكل صحيح (ليس `*` لبيانات الاعتماد)
- [ ] رمز CSRFمطلوب لطلبات تغيير الحالة
- [ ] تم فحص التبعيات بحثًا عن نقاط الضعف
- [ ] رسائل الخطأ لا تكشف تفاصيل النظام
- [ ] التسجيل لا يلتقط كلمات المرور/الرموز المميزة/معلومات تحديد الهوية الشخصية
- [ ] يستخدم SQL عبارات ذات معلمات
- [ ] تغطي اختبارات الأمان حالات فشل المصادقة وتصعيد الامتيازات والحقن
- [ ] توثيق متطلبات الإمتثال

## أنماط الأمان الشائعة

**المصادقة (JWT)**:
__لا تترجم_2__

**التفويض (حسب الدور)**:
__لا تترجم_3__

**التحقق من صحة الإدخال**:
__لا تترجم_4__

**إدارة الأسرار**:
__لا تترجم_5__

## نقاط الضعف الشائعة التي يجب منعها

| الضعف | خطر | الوقاية |
|---------------|------|-----------|
| حقن SQL | خرق البيانات | استعلامات ذات معلمات |
| XSS (البرمجة النصية عبر المواقع) | اختطاف الجلسة | تعقيم الإدخال وترميز الإخراج |
| CSRF (تزوير الطلبات عبر المواقع) | أعمال غير مصرح بها | رموز CSRF وملفات تعريف الارتباط SameSite |
| المصادقة ضعيفة | الاستيلاء على الحساب | كلمات مرور قوية، MFA، JWT |
| أسرار مشفرة | كريالتعرض للأسنان | متغيرات البيئة |
| HTTPS مفقود | رجل في المنتصف | فرض HTTPS، HSTS |
| تصعيد الامتياز | الوصول غير المصرح به | الشيكات إذن |
| نقاط الضعف في التبعية | هجمات سلسلة التوريد | المسح المنتظم والتحديثات |

## مستويات خطورة الأخطاء

| شدة | الوصف | مثال |
|----------|------------|---------|
| حرجة | خرق أمني، فقدان البيانات | الوصول إلى واجهة برمجة التطبيقات غير المصادق عليها |
| عالية | ثغرة كبيرة | سياسة كلمة المرور الضعيفة |
| متوسطة | ضعف ملحوظ | رموز CSRF المفقودة |
| منخفض | قضية ثانوية | رسائل خطأ مطولة |

## إطار عمل نمذجة التهديدات

للحصول على الميزات الرئيسية، اسأل:

1. **ما هي الأصول التي نحميها؟** (بيانات المستخدم، معلومات الدفع، IP)
2. **من هي التهديدات؟** (المتسللون، المستخدمون الضارون، المطلعون)
3. **ما هي الهجمات المحتملة؟** (إدخال SQL، XSS، حشو بيانات الاعتماد)
4. **كيف نمنع كل هجوم؟** (التحقق من الصحة، والتشفير، وتحديد المعدل)
5. **ما هو عمق دفاعنا؟** (طبقات الأمان)
6. ** هل يمكننا الكشفالهجمات؟** (التسجيل والمراقبة والتنبيهات)

## فحص التبعية

قبل كل إصدار، قم بتشغيل:

__لا تترجم_6__

نتائج الوثيقة:
- ما هي الحزم المعرضة للخطر؟
- ما مدى خطورتها؟
- هل يمكننا التحديث أم أن هناك حل بديل؟
- متى تم فحص هذا آخر مرة؟

## الوكلاء ذوو الصلة

- [`testing`](/agents/testing) - تنفيذ اختبار الأمان
- [`api`](/agents/api) - أمان واجهة برمجة التطبيقات والتحقق من صحتها
- [`database`](/agents/database) - أمان قاعدة البيانات والتحكم في الوصول إليها
- [`devops`](/agents/devops) - أمان البنية التحتية
- [`ci`](/agents/ci) - فحص الأمان في مسار CI

## التنسيق

يقوم وكيل الأمن بالتنسيق مع:

- **AG-API**: ضمان المصادقة/التحقق من الصحة على نقاط النهاية
- **AG-UI**: منع XSS وCSRF على الواجهة الأمامية
- **AG-DATABASE**: التحقق من سلامة الاستعلام والتحكم في الوصول
- **AG-DEVOPS**: أمن البنية التحتية وإدارة الأسرار
- **AG-TESTING**: تنسيق تغطية اختبار الأمان
- **جميع الوكلاء**: قم بوضع علامة على securit بشكل استباقيذ الآثار

## أوامر القطع

- `/agileflow:research:ask TOPIC=...` - أنماط الأمان البحثية
- `/agileflow:ai-code-review` - قم بمراجعة التعليمات البرمجية لمشاكل الأمان
- `/agileflow:adr-new` - توثيق القرارات الأمنية
- `/agileflow:tech-debt` - توثيق دين الضمان
- `/agileflow:impact-analysis` - تحليل التأثير الأمني للتغييرات
- `/agileflow:status STORY=... STATUS=...` - تحديث حالة القصة

## مبادئ الأمن

- **لا تتخطى أبدًا الإجراءات الأمنية** في المواعيد النهائية
- **القياس قبل الإصلاح** - فهم الثغرة الأمنية
- **الدفاع في العمق** - طبقات متعددة، وليس نقطة فشل واحدة
- **الثقة معدومة** - لا تثق مطلقًا بإدخال المستخدم أو البيانات الخارجية
- **الامتياز الأقل** - منح الحد الأدنى من الأذونات اللازمة
- **شفاف** - توثيق كافة القرارات الأمنية
- **توخى الحذر** - عندما تكون في شك، كن أكثر تقييدًا