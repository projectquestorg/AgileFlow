---
title: Agents de configuration
description: Agents spécialisés pour l'installation et la configuration des fonctionnalités AgileFlow
---
# Agents de configuration

Les agents de configuration sont des agents spécialisés qui aident à installer et configurer diverses fonctionnalités AgileFlow. Ils sont invoqués via la commande `/agileflow:configure`.

## Aperçu

Lorsque vous exécutez `/agileflow:configure`, un menu d'options de configuration s'affiche. Chaque option génère un agent de configuration dédié qui vous guide tout au long de la configuration.

```bash
/agileflow:configure
```

## Agents de configuration disponibles

### Système de crochets

**Agent** : `configuration-hooks`

Configure le système de hooks de Claude Code pour l'automatisation basée sur les événements.

**Ce qu'il configure :**
- Hook SessionStart - Affichage de bienvenue, statut du projet
- Hook PreCompact - Préservation du contexte
- Stop hook - Conclusion de la session, avertissement de modifications non validées
- Hook UserPromptSubmit - Journalisation des activités

**Fichiers créés :**
- `.claude/settings.json` - Configuration des crochets
- `scripts/agileflow-welcome.js` - Affichage de bienvenue
- `scripts/precompact-context.sh` - Préservation du contexte
- `scripts/agileflow-stop.sh` - Récapitulatif de la session
- `scripts/get-env.js` - Assistant de variable d'environnement

---

### Contexte précompact

**Agent** : `configuration-precompact`

Configure le hook PreCompact pour préserver le contexte critique lorsque les conversations sont compactées.

**Ce qu'il préserve :**
- Version du projet, branche git, histoires actives
- Règles de commande actives (par exemple, l'exigence AskUserQuestion de babysit)
- Conventions clés de CLAUDE.md
- Progrès récents de bus/log.jsonl

**Prise en charge multi-commandes (v2.40.0+) :**
Plusieurs commandes peuvent être actives simultanément. Le hook PreCompact lit toutes les commandes actives de `session-state.json` et préserve leurs règles de comportement.

---

### Archivage automatique

**Agent** : `configuration-archival`

Configure l'archivage automatique des anciennes histoires terminées pour garder `status.json` petit.

**Pourquoi c'est important :**
À mesure que les projets se développent, `status.json` peut dépasser la limite de 25 000 jetons de Claude Code, entraînant l'échec des agents. L'archivage automatique déplace les anciennes histoires terminées vers `status-archive.json`.

**Options de configuration :**
- 30 jours (recommandé)
- 14 jours
- 7 jours
- 3 jours (agressif)

**Fichiers créés:**
- `docs/00-meta/agileflow-metadata.json` - Configuration du seuil
- `scripts/archive-completed-stories.sh` - Script d'archivage
- Entrée de hook SessionStart - Exécute automatiquement l'archivage

---

### Attribution Git

**Agent** : `configuration-attribution`

Configure si Claude Code ajoute l'attribution d'IA aux commits git.

**Options :**
- **Désactiver l'attribution** - Valider les commits, pas de pieds de page IA (usage professionnel)
- **Conserver l'attribution** - Inclure le pied de page "Généré avec Claude Code"

**Ce qu'il fait :**
- Crée ou met à jour `CLAUDE.md` avec la politique d'attribution
- Ajoute une section CRITIQUE que Claude suit

---

### Ligne d'état

**Agent** : `configuration-status-line`

Configure la barre d'état personnalisée affichée dans Claude Code.

**Ce que cela montre :**
- Branche Git (codée couleur par type)
- ID et titre de l'histoire actuelle
- Nombre d'encours (jaune si >1, rouge si >3)
- Pourcentage d'achèvement

**Exemple de résultat :**
```
[main] US-0007: Status Line | WIP: 2 | Done: 85%
```

---

### Pipeline CI

**Agent** : `configuration-ci`

Configure le flux de travail CI/CD pour les tests automatisés et les contrôles de qualité.

**Ce que cela crée :**
-Fichier de flux de travail GitHub Actions
- Tester les commandes
- Configuration du peluchage
- Seuils de couverture

---

### Configuration de Git

**Agent** : `configuration-git-config`

Configure l'initialisation du référentiel git et la configuration à distance.

**Ce qu'il fait :**
- Initialise le dépôt git si nécessaire
- Configure l'origine distante
- Configure la branche par défaut
- Configure .gitignore

---

### Contrôle des dégâts

**Agent** : `configuration-damage-control`

Configure le système Damage Control pour se protéger contre les commandes destructrices.

**Niveaux de protection :**
- **Standard** - Bloque les schémas destructeurs courants
- **Strict** - Blocage plus agressif
- **Permissif** - Blocage minimal

**Ce qu'il bloque :**
- `rm -rf /` et variantes
- Force pousse vers les branches protégées
- La base de données disparaît sans confirmation
- Suppressions de fichiers en masse

Voir [Damage Control](/features/damage-control) pour une documentation complète.

---

### Vérifier la configuration

**Agent** : `configuration-verify`

Vérifie que toute la configuration AgileFlow est correcte et fonctionne.

**Ce qu'il vérifie :**
- Crochets system properly configured
- Required directories exist
- Scripts are executable
- JSON files are valid
- Git hooks are installed

## Usage

### Interactive Configuration

```bash
/agileflow:configure
```

You'll see options like:
```
Which feature would you like to configure?

1. Hooks System (Recommended)
2. Auto-Archival
3. Git Attribution
4. Status Line
5. CI Pipeline
6. Damage Control
7. Verify Configuration
```

### Direct Agent Invocation

You can also invoke configuration agents directly through the Task tool:

```javascript
Task(
  description: "Configure hooks system",
  prompt: "Set up the hooks system with SessionStart and PreCompact",
  subagent_type: "configuration-hooks"
)
```

## Configuration Files

### .claude/settings.json

Main hooks configuration file. Committed to git.

```json
{
  "hooks": {
    "SessionStart": [{
      "matcher": "",
      "hooks": [{
        "type": "command",
        "command": "node scripts/agileflow-welcome.js"
      }]
    }],
    "PreCompact": [{
      "matcher": "",
      "hooks": [{
        "type": "command",
        "command": "bash scripts/precompact-context.sh"
      }]
    }]
  }
}
```

### docs/00-meta/agileflow-metadata.json

Feature configuration and version tracking.

```json
{
  "version": "2.78.0",
  "created": "2025-01-01T00:00:00Z",
  "updated": "2025-01-09T00:00:00Z",
  "archival": {
    "threshold_days": 30,
    "enabled": true
  },
  "features": {
    "hooks": {
      "enabled": true,
      "configured_version": "2.41.0"
    },
    "precompact": {
      "enabled": true,
      "configured_version": "2.40.0"
    }
  }
}
```

### .claude/settings.local.json

User-specific overrides. Gitignored.

```json
{
  "env": {
    "USER_NAME": "Your Name"
  }
}
```

## Best Practices

### 1. Start with Hooks System

The hooks system is foundational. Configure it first, then add other features.

```bash
/agileflow:configure
# Select: Hooks System
```

### 2. Enable Auto-Archival Early

For projects with many stories, enable auto-archival to prevent status.json from growing too large.

### 3. Restart After Configuration

MosLes changements de configuration nécessitent le redémarrage de Claude Code :

```
RESTART CLAUDE CODE NOW!
Quit completely (Cmd+Q), wait 5 seconds, restart
Hooks ONLY load on startup!
```

### 4. Vérifier la configuration

Après avoir apporté les modifications, exécutez la vérification :

```bash
/agileflow:configure
# Select: Verify Configuration
```

### 5. Tester les scripts manuellement

Avant de vous fier aux hooks, testez les scripts manuellement :

```bash
# Test welcome display
node scripts/agileflow-welcome.js

# Test context preservation
bash scripts/precompact-context.sh

# Test session wrap-up
bash scripts/agileflow-stop.sh
```

## Dépannage

### Hooks Not Running

1. Vérifiez que `.claude/settings.json` existe et est un JSON valide
2. Vérifiez le format du tableau de hooks (vous devez utiliser le format `matcher` + `hooks`)
3. Redémarrez complètement Claude Code

### Old Format Detected

Si vous voyez « Ancien format de hooks détecté », votre settings.json utilise le format obsolète. Exécutez `/agileflow:configure` → Hooks System pour migrer.

### Scripts Not Found

Assurez-vous que les scripts sont au bon emplacement :
- `scripts/agileflow-welcome.js`
- `scripts/precompact-context.sh`
- `scripts/get-env.js`

### Permission Denied

Make scripts executable:
```bash
chmod +x scripts/*.js scripts/*.sh
```

## Related Documentation

- [Architecture du système Hooks](/features/hooks-system) - Documentation détaillée des hooks
- [Contexte compact](/features/compact-context) - Contextepréservation
- [Contrôle des dommages](/features/damage-control) - Système de protection
- [`/agileflow:configure`](/commands/configure) - Commande de configuration