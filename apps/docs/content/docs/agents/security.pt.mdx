---
title: Segurança
description: Especialista em segurança para análise de vulnerabilidades, padrões de autenticação, autorização, conformidade e análises de segurança antes do lançamento.
---
# Agente de segurança

O Agente de Segurança (AG-SECURITY) é um especialista em segurança e vulnerabilidade que garante que os aplicativos sejam seguros desde o design. Este agente realiza modelagem de ameaças, análise de vulnerabilidades, implementa padrões seguros e conduz auditorias de segurança obrigatórias de pré-lançamento.

## Capacidades

- **Análise de vulnerabilidade**: identifique problemas de segurança em requisitos e código
- **Modelagem de ameaças**: modele ameaças e projete estratégias de defesa
- **Padrões de autenticação**: implementar autenticação segura (JWT, OAuth, gerenciamento de sessão)
- **Autorização**: aplique controle de acesso baseado em função e em atributos
- **Validação de entrada**: evita ataques de XSS, injeção de SQL e injeção de comando
- **Gerenciamento de segredos**: garanta que os segredos nunca sejam codificados ou expostos
- **Testes de segurança**: escreva testes para falhas de autenticação, tentativas de injeção, escalonamento de privilégios
- **Verificação de dependências**: identifique dependências vulneráveis
- **Conformidade**: Verifique o OWASP Top 10, CWE e os padrões do setor
- **Pré-lançamento Aauditorias**: revisão de segurança obrigatória antes de cada lançamento

## Quando usar

Use o Security Agent quando:

- Implementação de recursos de autenticação ou autorização
- Tratamento de dados confidenciais do usuário (PII, informações de pagamento)
- Processamento de entrada do usuário (formulários, APIs)
- Integração com serviços externos
- Implementação de criptografia ou gerenciamento de segredos
- Precisa de revisão do código de segurança antes da fusão
- Planejando um lançamento (auditoria de pré-lançamento obrigatória)
- Necessidade de documentar decisões de segurança via ADR
- Vulnerabilidade descoberta e precisa de correção

## Como funciona

1. **Carregamento de conhecimento**: o agente lê pesquisas especializadas e de segurança
2. **Revisão da história**: o agente analisa a história em busca de implicações de segurança
3. **Modelagem de ameaças**: o agente modela ameaças para recursos críticos de segurança
4. **Análise de vulnerabilidade**: Agente identifica vetores de ataque e mitigações
5. **Testes de segurança**: o agente escreve testes de segurança (falhas de autenticação, injeções, escalonamento)
6. **Verificação**: o agente executa __NOTRASLATE_7__ para garantir a aprovação nos testes
7. **Documentação**: Agente cria ADRs para decisões de segurança
8. **Decisão de liberação**: Relatórios do agente APROVADOS/APROVADOS COM MITIGAÇÕES/REJEITADOS
9. **Coordenação**: o agente atualiza o status.json e comunica as descobertas

## Exemplo

```bash
# Via babysit - security review of authentication feature
/agileflow:babysit
> "We're implementing JWT-based authentication. Need security review."

# Agent output:
# Security Review: US-0042 - JWT Authentication
#
# Vulnerabilities Found:
# - HIGH: Tokens stored in localStorage (XSS exposure)
# - MEDIUM: No token refresh mechanism (long-lived tokens)
# - MEDIUM: Missing CSRF protection
#
# Recommendations:
# 1. Move tokens to httpOnly cookies (not accessible to JS)
# 2. Implement token refresh with short-lived access tokens
# 3. Add CSRF tokens for state-changing requests
# 4. Validate tokens on every protected endpoint
#
# Security Tests Required:
# - Test invalid token rejection
# - Test expired token handling
# - Test CSRF token validation
# - Test privilege escalation prevention
#
# Clearance: APPROVED WITH MITIGATIONS
# - Implement recommendations above
# - Re-run security tests
# - ADR documenting JWT strategy required
```

## Principais comportamentos

- **Segurança em primeiro lugar**: nunca pule as verificações de segurança para cumprir prazos
- **Defesa em profundidade**: múltiplas camadas de segurança, não um único ponto de falha
- **Fail Secure**: negação padrão, permissão explícita
- **Modelagem de ameaças**: pense como um invasor
- **Confiança Zero**: nunca confie na entrada do usuário ou em dados externos
- **Princípio do menor privilégio**: os usuários têm as permissões mínimas necessárias
- **Transparência**: documente todas as decisões e mitigações de segurança
- **Preservação de contexto**: usa compact_context (prioridade: alta) para manter o foco na segurança durante longas conversas, preservando modelos de ameaças e requisitos de segurança por meio da compactação de contexto

## Configuração de contexto compacto

O agente de segurança usa **alta prioridade** compact_context para garantir que a vigilância de segurança permaneça em foco:

```yaml
compact_context:
  priority: high
  preserve_rules:
    - "LOAD EXPERTISE FIRST: Always read packages/cli/src/core/experts/security/expertise.yaml"
    - "SECURITY FIRST: Never skip security checks to meet deadlines"
    - "DEFENSE IN DEPTH: Multiple layers, not single point of failure"
    - "FAIL SECURE: Default deny, explicit allow (principle of least privilege)"
    - "THREAT MODELING: Think like an attacker, anticipate exploits"
    - "ZERO TRUST: Never trust user input or external data"
    - "NO SECRETS: No hardcoded API keys, credentials, or sensitive data"
  state_fields:
    - current_story
    - threat_model
    - security_requirements
    - vulnerability_findings
    - mitigation_progress
```

Isso garante que regras críticas de segurança (modelagem de ameaças, confiança zero, proteção secreta, defesa em profundidade) e o estado atual (vulnerabilidades conhecidas, modelos de ameaças, status de mitigação) permaneçam em foco por meio da compactação de contexto.

## Ferramentas disponíveis

- Ler, escrever, editar (operações de arquivo)
- Bash (executa verificações de segurança)
- Glob (encontre arquivos relacionados à segurança)
- Grep (pesquisa de segredos ou vulnerabilidades)

## Lista de verificação de segurança (pré-lançamento obrigatório)

Antes de aprovar QUALQUER versão:

- [] Sem segredos codificados, chaves de API ou credenciais
- [] Todas as entradas do usuário validadas (tipo, comprimento, formato, intervalo)
- [] Todas as saídas codificadas/escapadas (evitar XSS, injeção)
- [] Autenticação aplicada em endpoints protegidos
- [] Verificações de autorização verificam permissões
- [] A limitação de taxa evita força bruta e DoS
- [] HTTPS aplicado (sem HTTP em produção)
- [] CORS configurado corretamente (não __NOTRASLATE_8__ para credenciais)
- [] token CSRFé necessário para solicitações de mudança de estado
- [] Dependências verificadas em busca de vulnerabilidades
- [] Mensagens de erro não expõem detalhes do sistema
- [] O registro não captura senhas/tokens/PII
- [] SQL usa instruções parametrizadas
- [] Os testes de segurança cobrem falhas de autenticação, escalonamento de privilégios, injeções
- [] Requisitos de conformidade documentados

## Padrões de segurança comuns

**Autenticação (JWT)**:
```javascript
// Good: Secure JWT with expiration
const token = jwt.sign(
  { userId: user.id },
  process.env.JWT_SECRET,
  { algorithm: 'RS256', expiresIn: '1h' }
);

// Bad: No expiration, weak algorithm
const token = jwt.sign(
  { userId: user.id, password: user.password },
  'hardcoded-secret',
  { algorithm: 'HS256' }
);
```

**Autorização (com base na função)**:
__NOTRADUZIR_3__

**Validação de entrada**:
__NÃOTRADUZIR_4__

**Gerenciamento de segredos**:
__NOTRADUZIR_5__

## Vulnerabilidades comuns a serem evitadas

| Vulnerabilidade | Risco | Prevenção |
|---------------|------|-----------|
| Injeção SQL | Violação de dados | Consultas parametrizadas |
| XSS (Cross Site Scripting) | Sequestro de sessão | Sanitização de entrada, codificação de saída |
| CSRF (falsificação de solicitação entre sites) | Ações não autorizadas | Tokens CSRF, cookies SameSite |
| Autenticação fraca | Aquisição de conta | Senhas fortes, MFA, JWT |
| Segredos codificados | Creexposição dentária | Variáveis ​​de ambiente |
| HTTPS ausente | Homem do meio | Aplicar HTTPS, HSTS |
| Escalação de privilégios | Acesso não autorizado | Verificações de autorização |
| Vulnerabilidades de Dependência | Ataques à cadeia de abastecimento | Verificação regular, atualizações |

## Níveis de gravidade de bugs

| Gravidade | Descrição | Exemplo |
|----------|------------|---------|
| Crítico | Violação de segurança, perda de dados | Acesso API não autenticado |
| Alto | Vulnerabilidade significativa | Política de senha fraca |
| Médio | Fraqueza notável | Tokens CSRF ausentes |
| Baixo | Problema menor | Mensagens de erro detalhadas |

## Estrutura de modelagem de ameaças

Para os principais recursos, pergunte:

1. **Quais ativos estamos protegendo?** (dados do usuário, informações de pagamento, IP)
2. **Quem são as ameaças?** (hackers, usuários mal-intencionados, internos)
3. **Quais ataques são possíveis?** (injeção de SQL, XSS, preenchimento de credenciais)
4. **Como evitamos cada ataque?** (validação, criptografia, limitação de taxa)
5. **Qual é a nossa profundidade de defesa?** (camadas de segurança)
6. **Podemos detectarataques?** (registro, monitoramento, alertas)

## Verificação de Dependências

Antes de cada lançamento, execute:

__NOTRADUZIR_6__

Descobertas do documento:
- Quais pacotes são vulneráveis?
- Qual é a gravidade?
- Podemos atualizar ou há uma solução alternativa?
- Quando foi verificado pela última vez?

## Agentes Relacionados

- [__NOTRASLATE_9____NOTRASLATE_20__ - Implementação de teste de segurança
- [`api`__NOTRASLATE_21__ - Segurança e validação da API
- [`database`__NOTRASLATE_22__ - Segurança de banco de dados e controle de acesso
- [__NOTRASLATE_12____NOTRASLATE_23__ - Segurança de infraestrutura
- [__NOTRASLATE_13____NOTRASLATE_24__ - Verificação de segurança no pipeline de CI

## Coordenação

O Agente de Segurança coordena com:

- **AG-API**: Garanta autenticação/validação em endpoints
- **AG-UI**: Impedir XSS, CSRF no frontend
- **AG-DATABASE**: Verifique a segurança da consulta, controle de acesso
- **AG-DEVOPS**: Segurança de infraestrutura, gerenciamento de segredos
- **AG-TESTING**: Coordenar a cobertura dos testes de segurança
- **Todos os agentes**: sinalizam segurança proativamenteimplicações

## Comandos de barra

- __NOTRASLATE_14__ - Pesquise padrões de segurança
- __NOTRASLATE_15__ - Revise o código em busca de problemas de segurança
- __NOTRASLATE_16__ - Documentar decisões de segurança
- __NOTRASLATE_17__ - Documento de dívida de segurança
- __NOTRASLATE_18__ - Analisar o impacto das mudanças na segurança
- __NOTRASLATE_19__ - Atualizar status da história

## Princípios de Segurança

- **Nunca pule a segurança** para prazos
- **Meça antes de corrigir** – entenda a vulnerabilidade
- **Defesa em profundidade** - múltiplas camadas, não um único ponto de falha
- **Confiança zero** - nunca confie na entrada do usuário ou em dados externos
- **Privilégio mínimo** – conceda permissões mínimas necessárias
- **Transparente** - documente todas as decisões de segurança
- **Erre por precaução** - em caso de dúvida, seja mais restritivo